<<<<<<< fce3d2cf9700b9c7a2d888ae018256f9a8a8f7b2
{"version":3,"sources":["infragram.js"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","module","urlHash","getUrlHashParameter","param","params","getUrlHashParameters","sPageURL","window","location","hash","split","pairs","object","forEach","pair","setUrlHashParameters","keys","Object","values","key","push","join","setUrlHashParameter","value","Infragram","options","uploader","processor","camera","colorized","mode","video_live","webGlSupported","processors","file","logger","Interface","console","log","type","colorize","map","run","save_log","video","initialize","interval","setInterval","image","getSnapshot","download","downloadImage","Camera","segmented_colormap","segments","x","l","len","m","ref","result","x0","x1","xstart","y0","y1","Colormaps","colormapFunctionGenerator","colormaps","fn","colormapRanges","JsImage","colorify","jsImage","colormap","b","data","g","j","$","addClass","width","height","Uint8ClampedArray","colormap1","colormap2","greyscale_colormap","Converters","hsv2rgb","h","s","v","q","rgb","Math","floor","rgb2hsv","d","max","min","FileUpload","socket","serverFilename","isLoadedFromFile","getFilename","setFilename","name","uploadThumbnail","src","callback","img","Image","onload","onImageLoad","canvas","ctx","dataUrl","document","createElement","getContext","drawImage","toString","toDataURL","emit","fromFile","files","upload","reader","prop","FileReader","onReaderLoad","event","size","target","uploaded","readAsDataURL","duplicate","fromBase64","rememberTransport","transports","io","connect","protocol","host","on","newFile","txt","html","round","slice","alert","eval","getUserMedia","webRtcOptions","success","deviceError","videoEl","setAttribute","webcam","getElementById","show","el","extern","append","debug","onCapture","onWebRtcCapture","save","onSave","onSaveGetUserMedia","onLoad","onLoadGetUserMedia","col","tmp","w","pos","parseInt","putImageData","stream","context","navigator","mozGetUserMedia","mozSrcObject","srcObject","onerror","stop","error","getElementsByTagName","updateImage","hide","capture","File","format","lnk","href","getCurrentImage","match","Date","toISOString","replace","createEvent","initMouseEvent","dispatchEvent","fireEvent","fetchImage","filename","substring","val","change","button","click","save_infragrammar_expressions","run_infragrammar","run_colorize","Logger","log_mono","logEntry","log_hsv","log_rgb","javascriptProcessor","b_exp","g_exp","get_channels","converters","ndvi","r_exp","set_mode","update_colorbar","mkImage","Float32Array","nirJsImg","visJsImg","Float64Array","infragrammar","removeClass","infragrammar_mono","render","getImageData","copyToImageData","imageData","k","ref1","style","display","textContent","toFixed","update","ndvi_jsImg","normalize","resultJsImage","save_expressions","save_expressions_hsv","getJsImage","new_mode","imgCanvas","videoWidth","videoHeight","webglProcessor","imgContext","mapContext","inputImage","vertices","waitForShadersToLoad","webglUtils","default","stretched","grey","itemSize","shaderVertPath","shaderFragPath","shadersLoadedCallback","createContext","decolorize","load","glShaderLoaded","selColormap","createBuffer","buffer","gl","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","createTexture","textureUnit","texture","activeTexture","bindTexture","TEXTURE_2D","pixelStorei","UNPACK_FLIP_Y_WEBGL","texImage2D","RGBA","UNSIGNED_BYTE","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","TEXTURE_MAG_FILTER","NEAREST","TEXTURE_MIN_FILTER","slider","canvasName","expression","updateShader","addEventListener","preventDefault","glRestoreContext","getWebGLContext","getExtension","vertexBuffer","framebuffer","createFramebuffer","imageTexture","TEXTURE0","drawScene","returnImage","pColormap","pHsvUniform","pColorizedUniform","pSampler","pSelColormapUniform","pSliderUniform","pVertexPosition","requestAnimationFrame","shaderProgram","generateShader","viewport","useProgram","getAttribLocation","enableVertexAttribArray","vertexAttribPointer","FLOAT","getUniformLocation","uniform1i","uniform1f","drawArrays","TRIANGLE_STRIP","toLowerCase","includes","createProgramFromScripts","setMode","newMode","getInputImage","imageToBase64","dataURL","saveExpression","Analysis","save_infragrammar_inputs","submit","Colorize","css","Fullscreen","fullscreen","innerWidth","imageSelector","fileSelector","Presets","Saving","args","ready","uploadable","idNameMap","localStorage","getItem","parametersObject","search","fetch_image","modal","toggle","toggleClass","scale","ratio","setItem","delay","fadeOut","tooltip","popover","saveImage","sendThumbnail","JSON","stringify","data1","width1","height1","channels","imgData","set","maxs","mins","results","lastError","msg","loggingOff","isInIFrame","top","glEnumToString","makeFailHTML","GET_A_WEBGL_BROWSER","OTHER_PROBLEM","setupWebGL","opt_attribs","showLink","str","container","parentNode","innerHTML","WebGLRenderingContext","create3DContext","names","ii","updateCSSIfInIFrame","body","className","clientWidth","clientHeight","loadShader","shaderSource","shaderType","opt_errorCallback","errFn","shader","createShader","compileShader","compiled","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","deleteShader","loadProgram","shaders","opt_locations","program","createProgram","attachShader","bindAttribLocation","linkProgram","linked","getProgramParameter","LINK_STATUS","getProgramInfoLog","deleteProgram","createShaderFromScript","scriptId","opt_shaderType","shaderScript","text","VERTEX_SHADER","FRAGMENT_SHADER","defaultShaderType","shaderScriptIds","browserPrefixes","getExtensionWithKnownPrefixes","prefixedName","ext","resizeCanvasToDisplaySize","requestAnimFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","element","setTimeout","cancelRequestAnimFrame","cancelCancelRequestAnimationFrame","webkitCancelRequestAnimationFrame","mozCancelRequestAnimationFrame","oCancelRequestAnimationFrame","msCancelRequestAnimationFrame","clearTimeout","createShaderFromScriptElement"],"mappings":";;;;;;;;;;;;AAAA,CAAC,YAAU;AAAC,WAASA,CAAT,CAAWC,CAAX,EAAaC,CAAb,EAAeC,CAAf,EAAiB;AAAC,aAASC,CAAT,CAAWC,CAAX,EAAaC,CAAb,EAAe;AAAC,UAAG,CAACJ,EAAEG,CAAF,CAAJ,EAAS;AAAC,YAAG,CAACJ,EAAEI,CAAF,CAAJ,EAAS;AAAC,cAAIE,IAAE,cAAY,OAAOC,OAAnB,IAA4BA,OAAlC;AAA0C,cAAG,CAACF,CAAD,IAAIC,CAAP,EAAS,OAAOA,EAAEF,CAAF,EAAI,CAAC,CAAL,CAAP;AAAe,cAAGI,CAAH,EAAK,OAAOA,EAAEJ,CAAF,EAAI,CAAC,CAAL,CAAP;AAAe,cAAIK,IAAE,IAAIC,KAAJ,CAAU,yBAAuBN,CAAvB,GAAyB,GAAnC,CAAN;AAA8C,gBAAMK,EAAEE,IAAF,GAAO,kBAAP,EAA0BF,CAAhC;AAAkC;;AAAA,YAAIG,IAAEX,EAAEG,CAAF,IAAK;AAACS,mBAAQ;AAAT,SAAX;AAAwBb,UAAEI,CAAF,EAAK,CAAL,EAAQU,IAAR,CAAaF,EAAEC,OAAf,EAAuB,UAASd,CAAT,EAAW;AAAC,cAAIE,IAAED,EAAEI,CAAF,EAAK,CAAL,EAAQL,CAAR,CAAN;AAAiB,iBAAOI,EAAEF,KAAGF,CAAL,CAAP;AAAe,SAAnE,EAAoEa,CAApE,EAAsEA,EAAEC,OAAxE,EAAgFd,CAAhF,EAAkFC,CAAlF,EAAoFC,CAApF,EAAsFC,CAAtF;AAAyF;;AAAA,aAAOD,EAAEG,CAAF,EAAKS,OAAZ;AAAoB;;AAAA,SAAI,IAAIL,IAAE,cAAY,OAAOD,OAAnB,IAA4BA,OAAlC,EAA0CH,IAAE,CAAhD,EAAkDA,IAAEF,EAAEa,MAAtD,EAA6DX,GAA7D;AAAiED,QAAED,EAAEE,CAAF,CAAF;AAAjE;;AAAyE,WAAOD,CAAP;AAAS;;AAAA,SAAOJ,CAAP;AAAS,CAAxc,IAA4c;AAAC,KAAE,CAAC,UAASQ,OAAT,EAAiBS,MAAjB,EAAwBH,OAAxB,EAAgC;AAChf,aAASI,OAAT,GAAmB;AAEnB,eAASC,mBAAT,CAA6BC,KAA7B,EAAoC;AAElC,YAAIC,SAASC,sBAAb;AACA,eAAOD,OAAOD,KAAP,CAAP;AAED;;AAED,eAASE,oBAAT,GAAgC;AAE9B,YAAIC,WAAWC,OAAOC,QAAP,CAAgBC,IAA/B;AACA,YAAIH,QAAJ,EAAcA,WAAWA,SAASI,KAAT,CAAe,GAAf,EAAoB,CAApB,CAAX;AACd,YAAIC,QAAQL,SAASI,KAAT,CAAe,GAAf,CAAZ;AACA,YAAIE,SAAS,EAAb;AACAD,cAAME,OAAN,CAAc,UAASC,IAAT,EAAe1B,CAAf,EAAkB;AAC9B0B,iBAAOA,KAAKJ,KAAL,CAAW,GAAX,CAAP;AACA,cAAII,KAAK,CAAL,KAAW,EAAf,EAAmBF,OAAOE,KAAK,CAAL,CAAP,IAAkBA,KAAK,CAAL,CAAlB;AACpB,SAHD;AAIA,eAAOF,MAAP;AACD,OApBkB,CAsBnB;AACA;;;AACA,eAASG,oBAAT,CAA8BX,MAA9B,EAAsC;AAEpC,YAAIY,OAAOC,OAAOD,IAAP,CAAYZ,MAAZ,CAAX;AACA,YAAIc,SAASD,OAAOC,MAAP,CAAcd,MAAd,CAAb;AACA,YAAIO,QAAQ,EAAZ;AACAK,aAAKH,OAAL,CAAa,UAASM,GAAT,EAAc/B,CAAd,EAAiB;AAC5B,cAAI+B,OAAO,EAAX,EAAeR,MAAMS,IAAN,CAAWJ,KAAK5B,CAAL,IAAU,GAAV,GAAgB8B,OAAO9B,CAAP,CAA3B;AAChB,SAFD;AAGA,YAAIqB,OAAOE,MAAMU,IAAN,CAAW,GAAX,CAAX;AACAd,eAAOC,QAAP,CAAgBC,IAAhB,GAAuBA,IAAvB;AAED;;AAED,eAASa,mBAAT,CAA6BnB,KAA7B,EAAoCoB,KAApC,EAA2C;AAEzC,YAAInB,SAASC,sBAAb;AACAD,eAAOD,KAAP,IAAgBoB,KAAhB;AACAR,6BAAqBX,MAArB;AAED;;AAED,aAAO;AACLF,6BAAuBA,mBADlB;AAELG,8BAAuBA,oBAFlB;AAGLiB,6BAAuBA,mBAHlB;AAILP,8BAAuBA;AAJlB,OAAP;AAOC;;AAEDf,WAAOH,OAAP,GAAiBI,OAAjB;AAEC,GAzD8c,EAyD7c,EAzD6c,CAAH;AAyDtc,KAAE,CAAC,UAASV,OAAT,EAAiBS,MAAjB,EAAwBH,OAAxB,EAAgC;AACzCU,WAAOiB,SAAP,GAAmB,SAASA,SAAT,CAAmBC,OAAnB,EAA4B;AAC7CA,gBAAUA,WAAW,EAArB;AACAA,cAAQC,QAAR,GAAmBD,QAAQC,QAAR,IAAoB,KAAvC;AACAD,cAAQE,SAAR,GAAoBF,QAAQE,SAAR,IAAqB,YAAzC;AACAF,cAAQG,MAAR,GAAiBrC,QAAQ,aAAR,EAAuBkC,OAAvB,CAAjB;AACAA,cAAQI,SAAR,GAAyBJ,QAAQI,SAAR,IAA0B,KAAnD;AACAJ,cAAQK,IAAR,GAAyBL,QAAQK,IAAR,IAA0B,KAAnD,EACAL,QAAQM,UAAR,GAAyBN,QAAQM,UAAR,IAA0B,KADnD,EAEAN,QAAQO,cAAR,GAAyBP,QAAQO,cAAR,IAA0B,KAFnD,CAN6C,CAQa;;AAE1DP,cAAQQ,UAAR,GAAqB;AACnB,iBAAmB1C,QAAQ,oBAAR,CADA;AAEnB,sBAAmBA,QAAQ,yBAAR;AAFA,OAArB;AAKAkC,cAAQE,SAAR,GAAoBF,QAAQQ,UAAR,CAAmBR,QAAQE,SAA3B,EAAsCF,OAAtC,CAApB;AACAA,cAAQS,IAAR,GAAe3C,QAAQ,WAAR,EAAqBkC,OAArB,EAA8BA,QAAQE,SAAtC,CAAf;AACAF,cAAQU,MAAR,GAAiB5C,QAAQ,UAAR,EAAoBkC,OAApB,CAAjB;;AAEA,UAAIW,YAAY7C,QAAQ,gBAAR,EAA0BkC,OAA1B,CAAhB,CAnB6C,CAmBO;AACpD;;;AACAY,cAAQC,GAAR,CAAY,YAAZ,EAA0Bb,QAAQE,SAAR,CAAkBY,IAA5C;;AAEAd,cAAQe,QAAR,GAAmB,SAASA,QAAT,CAAkBC,GAAlB,EAAuB;AACxChB,gBAAQE,SAAR,CAAkBa,QAAlB,CAA2BC,GAA3B;AACD,OAFD,CAvB6C,CA2B7C;;;AACAhB,cAAQiB,GAAR,GAAc,SAASA,GAAT,CAAaZ,IAAb,EAAmB;AAC/BL,gBAAQU,MAAR,CAAeQ,QAAf;AACA,eAAOlB,QAAQE,SAAR,CAAkBe,GAAlB,CAAsBZ,IAAtB,CAAP;AACD,OAHD,CA5B6C,CAiC7C;;;AACAL,cAAQmB,KAAR,GAAgB,SAASA,KAAT,GAAiB;AAC/BnB,gBAAQG,MAAR,CAAeiB,UAAf;AACA,YAAIC,QAAJ;AACA,YAAIrB,QAAQE,SAAR,CAAkBY,IAAlB,IAA0B,OAA9B,EAAuCO,WAAW,EAAX,CAAvC,KACKA,WAAW,GAAX;AACLC,oBAAY,YAAW;AACrB,cAAIC,KAAJ,EAAWvB,QAAQiB,GAAR,CAAYjB,QAAQK,IAApB;AACXL,kBAAQG,MAAR,CAAeqB,WAAf,GAFqB,CAGrB;AACD,SAJD,EAIGH,QAJH;AAKD,OAVD,CAlC6C,CA8C7C;AACA;;;AACA,eAASI,QAAT,GAAoB;AAClB;AACA;AACAzB,gBAAQS,IAAR,CAAaiB,aAAb;AACD;;AAED,aAAO;AACLC,gBAAQ3B,QAAQG,MADX;AAELQ,mBAAWA,SAFN;AAGLD,gBAAQV,QAAQU,MAHX;AAILO,aAAKjB,QAAQiB,GAJR;AAKLF,kBAAUf,QAAQe,QALb;AAMLP,oBAAYR,QAAQQ,UANf;AAOLiB,kBAAUA,QAPL;AAQLzB,iBAASA;AARJ,OAAP;AAUD,KAhED;;AAiEAzB,WAAOH,OAAP,GAAiB2B,SAAjB;AAEC,GApEO,EAoEN;AAAC,mBAAc,CAAf;AAAiB,iBAAY,CAA7B;AAA+B,gBAAW,EAA1C;AAA6C,+BAA0B,EAAvE;AAA0E,0BAAqB,EAA/F;AAAkG,sBAAiB;AAAnH,GApEM,CAzDoc;AA6HlV,KAAE,CAAC,UAASjC,OAAT,EAAiBS,MAAjB,EAAwBH,OAAxB,EAAgC;AAC7JG,WAAOH,OAAP,GAAiB,SAASwD,kBAAT,CAA4BC,QAA5B,EAAsC;AACrD,aAAO,UAASC,CAAT,EAAY;AACjB,YAAInE,CAAJ,EAAOoE,CAAP,EAAUC,GAAV,EAAeC,CAAf,EAAkBC,GAAlB,EAAuBC,MAAvB,EAA+BC,EAA/B,EAAmCC,EAAnC,EAAuCC,MAAvC,EAA+CC,EAA/C,EAAmDC,EAAnD;AACCD,UAFgB,GAEL,CAFK;AAEZC,UAFY,GAEF,CAFE;AAAA,mBAGN,CAACX,SAAS,CAAT,EAAY,CAAZ,CAAD,EAAiB,CAAjB,CAHM;AAGhBO,UAHgB;AAGZC,UAHY;;AAIjB,YAAIP,IAAIM,EAAR,EAAY;AACV,iBAAOG,EAAP;AACD;;AACD,aAAK5E,IAAIoE,IAAI,CAAR,EAAWC,MAAMH,SAASvD,MAA/B,EAAuCyD,IAAIC,GAA3C,EAAgDrE,IAAI,EAAEoE,CAAtD,EAAyD;AAAA,2CACpCF,SAASlE,CAAT,CADoC;;AACtD2E,gBADsD;AAC9CC,YAD8C;AAC1CC,YAD0C;AAEvDJ,eAAKE,MAAL;;AACA,cAAI3E,MAAMkE,SAASvD,MAAT,GAAkB,CAA5B,EAA+B;AAC7B+D,iBAAK,CAAL;AACA;AACD;;AACDA,eAAKR,SAASlE,IAAI,CAAb,EAAgB,CAAhB,CAAL;;AACA,cAAK2E,UAAUR,CAAV,IAAeA,IAAIO,EAAxB,EAA6B;AAC3B;AACD;AACF;;AACDF,iBAAS,EAAT;;AACA,aAAKxE,IAAIsE,IAAI,CAAR,EAAWC,MAAMK,GAAGjE,MAAzB,EAAiC,KAAK4D,GAAL,GAAWD,IAAIC,GAAf,GAAqBD,IAAIC,GAA1D,EAA+DvE,IAAI,KAAKuE,GAAL,GAAW,EAAED,CAAb,GAAiB,EAAEA,CAAtF,EAAyF;AACvFE,iBAAOxE,CAAP,IAAY,CAACmE,IAAIM,EAAL,KAAYC,KAAKD,EAAjB,KAAwBI,GAAG7E,CAAH,IAAQ4E,GAAG5E,CAAH,CAAhC,IAAyC4E,GAAG5E,CAAH,CAArD;AACD;;AACD,eAAOwE,MAAP;AACD,OAxBD;AAyBD,KA1BD;AA4BC,GA7B2H,EA6B1H,EA7B0H,CA7HgV;AA0Jtc,KAAE,CAAC,UAASrE,OAAT,EAAiBS,MAAjB,EAAwBH,OAAxB,EAAgC;AACzCG,WAAOH,OAAP,GAAe;AACb,mBAAa;AACX,kBAAU,WADC;AAEX,uBAAe,qDAFJ;AAGX,eAAO,2CAHI;AAIX,0BAAkB,CAChB,CAAC,CAAD,EAAQ,CAAC,CAAD,EAAM,CAAN,EAAW,CAAX,CAAR,EAAyB,CAAC,GAAD,EAAM,GAAN,EAAW,GAAX,CAAzB,CADgB,EAEhB,CAAC,CAAD,EAAQ,CAAC,GAAD,EAAM,GAAN,EAAW,GAAX,CAAR,EAAyB,CAAC,GAAD,EAAM,GAAN,EAAW,GAAX,CAAzB,CAFgB;AAJP,OADA;AAWb,iBAAW;AACT,kBAAU,WADD;AAET,uBAAe,kEAFN;AAGT,eAAO,yCAHE;AAIT,0BAAkB,CAChB,CAAC,CAAD,EAAU,CAAC,EAAD,EAAI,CAAJ,EAAM,GAAN,CAAV,EAA0B,CAAC,EAAD,EAAI,CAAJ,EAAM,GAAN,CAA1B,CADgB,EAEhB,CAAC,KAAD,EAAU,CAAC,EAAD,EAAI,CAAJ,EAAM,GAAN,CAAV,EAA0B,CAAC,CAAD,EAAG,CAAH,EAAK,GAAL,CAA1B,CAFgB,EAGhB,CAAC,MAAD,EAAU,CAAC,CAAD,EAAG,CAAH,EAAK,GAAL,CAAV,EAA0B,CAAC,CAAD,EAAG,EAAH,EAAM,GAAN,CAA1B,CAHgB,EAIhB,CAAC,IAAD,EAAU,CAAC,CAAD,EAAG,EAAH,EAAM,GAAN,CAAV,EAA0B,CAAC,EAAD,EAAI,EAAJ,EAAO,GAAP,CAA1B,CAJgB,EAKhB,CAAC,MAAD,EAAU,CAAC,EAAD,EAAI,EAAJ,EAAO,GAAP,CAAV,EAA0B,CAAC,EAAD,EAAI,GAAJ,EAAQ,GAAR,CAA1B,CALgB,EAMhB,CAAC,KAAD,EAAU,CAAC,EAAD,EAAI,GAAJ,EAAQ,GAAR,CAAV,EAA0B,CAAC,EAAD,EAAI,GAAJ,EAAQ,GAAR,CAA1B,CANgB,EAOhB,CAAC,MAAD,EAAU,CAAC,EAAD,EAAI,GAAJ,EAAQ,GAAR,CAAV,EAA0B,CAAC,EAAD,EAAI,GAAJ,EAAQ,GAAR,CAA1B,CAPgB,EAQhB,CAAC,IAAD,EAAU,CAAC,EAAD,EAAI,GAAJ,EAAQ,GAAR,CAAV,EAA0B,CAAC,EAAD,EAAK,GAAL,EAAS,GAAT,CAA1B,CARgB,EAShB,CAAC,IAAD,EAAU,CAAC,EAAD,EAAK,GAAL,EAAS,GAAT,CAAV,EAA0B,CAAC,EAAD,EAAI,GAAJ,EAAQ,EAAR,CAA1B,CATgB,EAUhB,CAAC,MAAD,EAAU,CAAC,EAAD,EAAI,GAAJ,EAAQ,EAAR,CAAV,EAA0B,CAAC,GAAD,EAAK,GAAL,EAAS,EAAT,CAA1B,CAVgB,EAWhB,CAAC,KAAD,EAAU,CAAC,GAAD,EAAK,GAAL,EAAS,EAAT,CAAV,EAA0B,CAAC,GAAD,EAAK,GAAL,EAAS,EAAT,CAA1B,CAXgB,EAYhB,CAAC,MAAD,EAAU,CAAC,GAAD,EAAK,GAAL,EAAS,EAAT,CAAV,EAA0B,CAAC,GAAD,EAAK,GAAL,EAAS,EAAT,CAA1B,CAZgB,EAahB,CAAC,IAAD,EAAU,CAAC,GAAD,EAAK,GAAL,EAAS,EAAT,CAAV,EAA0B,CAAC,GAAD,EAAK,GAAL,EAAS,EAAT,CAA1B,CAbgB,EAchB,CAAC,MAAD,EAAU,CAAC,GAAD,EAAK,GAAL,EAAS,EAAT,CAAV,EAA0B,CAAC,GAAD,EAAM,GAAN,EAAW,EAAX,CAA1B,CAdgB,EAehB,CAAC,MAAD,EAAU,CAAC,GAAD,EAAM,GAAN,EAAW,EAAX,CAAV,EAA0B,CAAC,GAAD,EAAK,GAAL,EAAS,EAAT,CAA1B,CAfgB,EAgBhB,CAAC,KAAD,EAAU,CAAC,GAAD,EAAK,GAAL,EAAS,EAAT,CAAV,EAA0B,CAAC,GAAD,EAAK,EAAL,EAAQ,EAAR,CAA1B,CAhBgB,EAiBhB,CAAC,MAAD,EAAU,CAAC,GAAD,EAAK,EAAL,EAAQ,EAAR,CAAV,EAA0B,CAAC,GAAD,EAAK,EAAL,EAAQ,EAAR,CAA1B,CAjBgB;AAJT,OAXE;AAoCb,mBAAa;AACX,kBAAU,WADC;AAEX,uBAAe,6DAFJ;AAGX,eAAO,2CAHI;AAIX,0BAAkB,CAChB,CAAC,CAAD,EAAQ,CAAC,CAAD,EAAM,CAAN,EAAW,GAAX,CAAR,EAAyB,CAAC,CAAD,EAAM,CAAN,EAAW,GAAX,CAAzB,CADgB,EAEhB,CAAC,GAAD,EAAQ,CAAC,CAAD,EAAM,CAAN,EAAW,GAAX,CAAR,EAAyB,CAAC,EAAD,EAAM,GAAN,EAAW,GAAX,CAAzB,CAFgB,EAGhB,CAAC,GAAD,EAAQ,CAAC,CAAD,EAAM,GAAN,EAAW,CAAX,CAAR,EAAyB,CAAC,GAAD,EAAM,GAAN,EAAW,CAAX,CAAzB,CAHgB,EAIhB,CAAC,GAAD,EAAQ,CAAC,GAAD,EAAM,GAAN,EAAW,CAAX,CAAR,EAAyB,CAAC,GAAD,EAAM,EAAN,EAAW,EAAX,CAAzB,CAJgB,EAKhB,CAAC,GAAD,EAAQ,CAAC,GAAD,EAAM,EAAN,EAAW,EAAX,CAAR,EAAyB,CAAC,GAAD,EAAM,EAAN,EAAW,EAAX,CAAzB,CALgB;AAJP,OApCA;AAiDd,sBAAgB;AACd,kBAAU,QADI;AAEd,uBAAe,+CAFD;AAGd,eAAO,8CAHO;AAId,0BAAkB,CAChB,CAAC,CAAD,EAAS,CAAC,CAAD,EAAG,EAAH,EAAM,EAAN,CAAT,EAAuB,CAAC,CAAD,EAAG,EAAH,EAAO,EAAP,CAAvB,CADgB,EAEhB,CAAC,MAAD,EAAS,CAAC,CAAD,EAAG,EAAH,EAAM,EAAN,CAAT,EAAuB,CAAC,CAAD,EAAG,EAAH,EAAO,EAAP,CAAvB,CAFgB,EAGhB,CAAC,KAAD,EAAS,CAAC,CAAD,EAAG,EAAH,EAAM,EAAN,CAAT,EAAuB,CAAC,CAAD,EAAG,EAAH,EAAO,EAAP,CAAvB,CAHgB,EAIhB,CAAC,MAAD,EAAS,CAAC,CAAD,EAAG,EAAH,EAAM,EAAN,CAAT,EAAuB,CAAC,CAAD,EAAG,EAAH,EAAO,EAAP,CAAvB,CAJgB,EAKhB,CAAC,IAAD,EAAS,CAAC,CAAD,EAAG,EAAH,EAAM,EAAN,CAAT,EAAuB,CAAC,CAAD,EAAG,EAAH,EAAM,EAAN,CAAvB,CALgB,EAMhB,CAAC,MAAD,EAAS,CAAC,CAAD,EAAG,EAAH,EAAM,EAAN,CAAT,EAAuB,CAAC,CAAD,EAAG,EAAH,EAAO,EAAP,CAAvB,CANgB,EAOhB,CAAC,MAAD,EAAS,CAAC,CAAD,EAAG,EAAH,EAAO,EAAP,CAAT,EAAuB,CAAC,GAAD,EAAK,GAAL,EAAS,GAAT,CAAvB,CAPgB,EAQhB,CAAC,KAAD,EAAS,CAAC,GAAD,EAAK,GAAL,EAAS,GAAT,CAAT,EAAuB,CAAC,GAAD,EAAK,GAAL,EAAS,GAAT,CAAvB,CARgB,EAShB,CAAC,KAAD,EAAS,CAAC,GAAD,EAAK,GAAL,EAAS,GAAT,CAAT,EAAuB,CAAC,GAAD,EAAK,GAAL,EAAS,GAAT,CAAvB,CATgB,EAUhB,CAAC,MAAD,EAAS,CAAC,GAAD,EAAK,GAAL,EAAS,GAAT,CAAT,EAAuB,CAAC,GAAD,EAAK,GAAL,EAAS,GAAT,CAAvB,CAVgB,EAWhB,CAAC,IAAD,EAAS,CAAC,GAAD,EAAK,GAAL,EAAS,GAAT,CAAT,EAAuB,CAAC,GAAD,EAAK,GAAL,EAAS,GAAT,CAAvB,CAXgB,EAYhB,CAAC,IAAD,EAAS,CAAC,GAAD,EAAK,GAAL,EAAS,GAAT,CAAT,EAAuB,CAAC,GAAD,EAAK,GAAL,EAAS,EAAT,CAAvB,CAZgB,EAahB,CAAC,MAAD,EAAS,CAAC,GAAD,EAAK,GAAL,EAAS,EAAT,CAAT,EAAuB,CAAC,GAAD,EAAK,GAAL,EAAS,EAAT,CAAvB,CAbgB,EAchB,CAAC,KAAD,EAAS,CAAC,GAAD,EAAK,GAAL,EAAS,EAAT,CAAT,EAAuB,CAAC,GAAD,EAAK,GAAL,EAAS,EAAT,CAAvB,CAdgB,EAehB,CAAC,KAAD,EAAS,CAAC,GAAD,EAAK,GAAL,EAAS,EAAT,CAAT,EAAuB,CAAC,EAAD,EAAI,GAAJ,EAAQ,CAAR,CAAvB,CAfgB,EAgBhB,CAAC,MAAD,EAAS,CAAC,EAAD,EAAI,GAAJ,EAAQ,CAAR,CAAT,EAAuB,CAAC,EAAD,EAAI,GAAJ,EAAQ,CAAR,CAAvB,CAhBgB,EAiBhB,CAAC,IAAD,EAAS,CAAC,EAAD,EAAI,GAAJ,EAAQ,CAAR,CAAT,EAAuB,CAAC,CAAD,EAAG,EAAH,EAAM,CAAN,CAAvB,CAjBgB,EAkBhB,CAAC,MAAD,EAAS,CAAC,CAAD,EAAG,EAAH,EAAM,CAAN,CAAT,EAAuB,CAAC,CAAD,EAAG,EAAH,EAAM,CAAN,CAAvB,CAlBgB,EAmBhB,CAAC,KAAD,EAAS,CAAC,CAAD,EAAG,EAAH,EAAM,CAAN,CAAT,EAAuB,CAAC,CAAD,EAAG,EAAH,EAAO,CAAP,CAAvB,CAnBgB,EAoBhB,CAAC,MAAD,EAAS,CAAC,CAAD,EAAG,EAAH,EAAO,CAAP,CAAT,EAAuB,CAAC,CAAD,EAAG,EAAH,EAAM,CAAN,CAAvB,CApBgB,EAqBhB,CAAC,KAAD,EAAS,CAAC,CAAD,EAAG,EAAH,EAAM,CAAN,CAAT,EAAuB,CAAC,EAAD,EAAI,EAAJ,EAAO,EAAP,CAAvB,CArBgB;AAJJ,OAjDF;AA8Eb,kBAAY;AACV,kBAAU,QADA;AAEV,uBAAe,iCAFL;AAGV,eAAO,0CAHG;AAIV,0BAAkB,CAChB,CAAC,CAAD,EAAS,CAAC,GAAD,EAAK,EAAL,EAAQ,CAAR,CAAT,EAAuB,CAAC,GAAD,EAAK,CAAL,EAAO,CAAP,CAAvB,CADgB,EAEhB,CAAC,MAAD,EAAS,CAAC,GAAD,EAAK,CAAL,EAAO,CAAP,CAAT,EAAuB,CAAC,GAAD,EAAK,EAAL,EAAQ,CAAR,CAAvB,CAFgB,EAGhB,CAAC,KAAD,EAAS,CAAC,GAAD,EAAK,EAAL,EAAQ,CAAR,CAAT,EAAuB,CAAC,GAAD,EAAK,EAAL,EAAQ,EAAR,CAAvB,CAHgB,EAIhB,CAAC,MAAD,EAAS,CAAC,GAAD,EAAK,EAAL,EAAQ,EAAR,CAAT,EAAuB,CAAC,GAAD,EAAK,EAAL,EAAQ,EAAR,CAAvB,CAJgB,EAKhB,CAAC,MAAD,EAAS,CAAC,GAAD,EAAK,EAAL,EAAQ,EAAR,CAAT,EAAuB,CAAC,GAAD,EAAK,EAAL,EAAQ,EAAR,CAAvB,CALgB,EAMhB,CAAC,IAAD,EAAS,CAAC,GAAD,EAAK,EAAL,EAAQ,EAAR,CAAT,EAAuB,CAAC,GAAD,EAAM,GAAN,EAAW,EAAX,CAAvB,CANgB,EAOhB,CAAC,MAAD,EAAS,CAAC,GAAD,EAAK,GAAL,EAAS,EAAT,CAAT,EAAuB,CAAC,GAAD,EAAK,GAAL,EAAS,GAAT,CAAvB,CAPgB,EAQhB,CAAC,KAAD,EAAS,CAAC,GAAD,EAAK,GAAL,EAAS,GAAT,CAAT,EAAuB,CAAC,GAAD,EAAM,GAAN,EAAW,GAAX,CAAvB,CARgB,EAShB,CAAC,MAAD,EAAS,CAAC,GAAD,EAAK,GAAL,EAAS,GAAT,CAAT,EAAuB,CAAC,GAAD,EAAK,GAAL,EAAS,GAAT,CAAvB,CATgB,EAUhB,CAAC,IAAD,EAAS,CAAC,GAAD,EAAK,GAAL,EAAS,GAAT,CAAT,EAAuB,CAAC,GAAD,EAAK,GAAL,EAAS,GAAT,CAAvB,CAVgB,EAWhB,CAAC,MAAD,EAAS,CAAC,GAAD,EAAK,GAAL,EAAS,GAAT,CAAT,EAAuB,CAAC,GAAD,EAAK,GAAL,EAAS,GAAT,CAAvB,CAXgB,EAYhB,CAAC,KAAD,EAAS,CAAC,GAAD,EAAK,GAAL,EAAS,GAAT,CAAT,EAAuB,CAAC,GAAD,EAAK,GAAL,EAAS,EAAT,CAAvB,CAZgB,EAahB,CAAC,MAAD,EAAS,CAAC,GAAD,EAAK,GAAL,EAAS,EAAT,CAAT,EAAuB,CAAC,EAAD,EAAI,GAAJ,EAAQ,EAAR,CAAvB,CAbgB,EAchB,CAAC,IAAD,EAAS,CAAC,EAAD,EAAI,GAAJ,EAAQ,EAAR,CAAT,EAAuB,CAAC,CAAD,EAAI,GAAJ,EAAS,EAAT,CAAvB,CAdgB,EAehB,CAAC,MAAD,EAAS,CAAC,CAAD,EAAG,GAAH,EAAO,EAAP,CAAT,EAAuB,CAAC,CAAD,EAAI,GAAJ,EAAS,EAAT,CAAvB,CAfgB,EAgBhB,CAAC,KAAD,EAAS,CAAC,CAAD,EAAG,GAAH,EAAO,EAAP,CAAT,EAAuB,CAAC,CAAD,EAAI,GAAJ,EAAS,EAAT,CAAvB,CAhBgB,EAiBhB,CAAC,IAAD,EAAS,CAAC,CAAD,EAAG,GAAH,EAAO,EAAP,CAAT,EAAuB,CAAC,CAAD,EAAG,GAAH,EAAO,EAAP,CAAvB,CAjBgB,EAkBhB,CAAC,MAAD,EAAS,CAAC,CAAD,EAAG,GAAH,EAAO,EAAP,CAAT,EAAuB,CAAC,CAAD,EAAG,EAAH,EAAM,EAAN,CAAvB,CAlBgB;AAJR,OA9EC;AAwGb,qBAAe;AACb,kBAAU,QADG;AAEb,uBAAe,8BAFF;AAGb,eAAO,6CAHM;AAIb,0BAAkB,CAChB,CAAC,CAAD,EAAU,CAAC,CAAD,EAAG,CAAH,EAAK,GAAL,CAAV,EAAwB,CAAC,CAAD,EAAG,CAAH,EAAK,GAAL,CAAxB,CADgB,EAEhB,CAAC,MAAD,EAAU,CAAC,CAAD,EAAG,CAAH,EAAK,GAAL,CAAV,EAAwB,CAAC,CAAD,EAAG,CAAH,EAAK,GAAL,CAAxB,CAFgB,EAGhB,CAAC,KAAD,EAAU,CAAC,CAAD,EAAG,CAAH,EAAK,GAAL,CAAV,EAAwB,CAAC,CAAD,EAAG,EAAH,EAAM,GAAN,CAAxB,CAHgB,EAIhB,CAAC,MAAD,EAAU,CAAC,CAAD,EAAG,EAAH,EAAM,GAAN,CAAV,EAAwB,CAAC,CAAD,EAAG,GAAH,EAAO,GAAP,CAAxB,CAJgB,EAKhB,CAAC,IAAD,EAAU,CAAC,CAAD,EAAG,GAAH,EAAO,GAAP,CAAV,EAAwB,CAAC,CAAD,EAAG,GAAH,EAAO,GAAP,CAAxB,CALgB,EAMhB,CAAC,MAAD,EAAU,CAAC,CAAD,EAAG,GAAH,EAAO,GAAP,CAAV,EAAwB,CAAC,CAAD,EAAG,GAAH,EAAO,GAAP,CAAxB,CANgB,EAOhB,CAAC,MAAD,EAAU,CAAC,CAAD,EAAG,GAAH,EAAO,GAAP,CAAV,EAAwB,CAAC,CAAD,EAAG,GAAH,EAAO,GAAP,CAAxB,CAPgB,EAQhB,CAAC,KAAD,EAAU,CAAC,CAAD,EAAG,GAAH,EAAO,GAAP,CAAV,EAAwB,CAAC,CAAD,EAAG,GAAH,EAAO,GAAP,CAAxB,CARgB,EAShB,CAAC,KAAD,EAAU,CAAC,CAAD,EAAG,GAAH,EAAO,GAAP,CAAV,EAAwB,CAAC,EAAD,EAAI,GAAJ,EAAQ,GAAR,CAAxB,CATgB,EAUhB,CAAC,KAAD,EAAU,CAAC,EAAD,EAAI,GAAJ,EAAQ,GAAR,CAAV,EAAwB,CAAC,EAAD,EAAI,GAAJ,EAAQ,GAAR,CAAxB,CAVgB,EAWhB,CAAC,MAAD,EAAU,CAAC,EAAD,EAAI,GAAJ,EAAQ,GAAR,CAAV,EAAwB,CAAC,GAAD,EAAK,GAAL,EAAS,GAAT,CAAxB,CAXgB,EAYhB,CAAC,IAAD,EAAU,CAAC,GAAD,EAAK,GAAL,EAAS,GAAT,CAAV,EAAwB,CAAC,GAAD,EAAK,GAAL,EAAS,EAAT,CAAxB,CAZgB,EAahB,CAAC,IAAD,EAAU,CAAC,GAAD,EAAK,GAAL,EAAS,EAAT,CAAV,EAAwB,CAAC,GAAD,EAAK,GAAL,EAAS,EAAT,CAAxB,CAbgB,EAchB,CAAC,MAAD,EAAU,CAAC,GAAD,EAAK,GAAL,EAAS,EAAT,CAAV,EAAwB,CAAC,GAAD,EAAK,GAAL,EAAS,EAAT,CAAxB,CAdgB,EAehB,CAAC,MAAD,EAAU,CAAC,GAAD,EAAK,GAAL,EAAS,EAAT,CAAV,EAAwB,CAAC,GAAD,EAAK,GAAL,EAAS,CAAT,CAAxB,CAfgB,EAgBhB,CAAC,KAAD,EAAU,CAAC,GAAD,EAAK,GAAL,EAAS,CAAT,CAAV,EAAwB,CAAC,GAAD,EAAK,GAAL,EAAS,CAAT,CAAxB,CAhBgB,EAiBhB,CAAC,KAAD,EAAU,CAAC,GAAD,EAAK,GAAL,EAAS,CAAT,CAAV,EAAwB,CAAC,GAAD,EAAK,GAAL,EAAS,CAAT,CAAxB,CAjBgB,EAkBhB,CAAC,MAAD,EAAU,CAAC,GAAD,EAAK,GAAL,EAAS,CAAT,CAAV,EAAwB,CAAC,GAAD,EAAK,GAAL,EAAS,CAAT,CAAxB,CAlBgB,EAmBhB,CAAC,IAAD,EAAU,CAAC,GAAD,EAAK,GAAL,EAAS,CAAT,CAAV,EAAwB,CAAC,GAAD,EAAK,EAAL,EAAS,CAAT,CAAxB,CAnBgB,EAoBhB,CAAC,MAAD,EAAU,CAAC,GAAD,EAAK,EAAL,EAAS,CAAT,CAAV,EAAwB,CAAC,GAAD,EAAM,CAAN,EAAS,CAAT,CAAxB,CApBgB,EAqBhB,CAAC,KAAD,EAAU,CAAC,GAAD,EAAK,CAAL,EAAO,CAAP,CAAV,EAAwB,CAAC,GAAD,EAAM,CAAN,EAAU,CAAV,CAAxB,CArBgB,EAsBhB,CAAC,MAAD,EAAU,CAAC,GAAD,EAAK,CAAL,EAAO,CAAP,CAAV,EAAwB,CAAC,GAAD,EAAM,CAAN,EAAU,CAAV,CAAxB,CAtBgB;AAJL,OAxGF;AAsIb,kBAAY;AACV,kBAAU,WADA;AAEV,uBAAe,0EAFL;AAGV,eAAO,0CAHG;AAIV,0BAAkB,CAChB,CAAC,CAAD,EAAS,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,CAAT,EAAwB,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,CAAxB,CADgB,EAEhB,CAAC,MAAD,EAAS,CAAC,CAAD,EAAG,CAAH,EAAK,GAAL,CAAT,EAAwB,CAAC,CAAD,EAAG,CAAH,EAAK,GAAL,CAAxB,CAFgB,EAGhB,CAAC,KAAD,EAAS,CAAC,CAAD,EAAG,CAAH,EAAK,GAAL,CAAT,EAAwB,CAAC,CAAD,EAAG,CAAH,EAAM,GAAN,CAAxB,CAHgB,EAIhB,CAAC,MAAD,EAAS,CAAC,CAAD,EAAG,GAAH,EAAO,GAAP,CAAT,EAAwB,CAAC,CAAD,EAAG,GAAH,EAAO,GAAP,CAAxB,CAJgB,EAKhB,CAAC,IAAD,EAAS,CAAC,CAAD,EAAG,GAAH,EAAO,GAAP,CAAT,EAAwB,CAAC,CAAD,EAAG,GAAH,EAAO,GAAP,CAAxB,CALgB,EAMhB,CAAC,MAAD,EAAS,CAAC,CAAD,EAAG,GAAH,EAAO,GAAP,CAAT,EAAwB,CAAC,CAAD,EAAG,GAAH,EAAO,GAAP,CAAxB,CANgB,EAOhB,CAAC,KAAD,EAAS,CAAC,CAAD,EAAG,GAAH,EAAO,CAAP,CAAT,EAAwB,CAAC,CAAD,EAAG,GAAH,EAAO,CAAP,CAAxB,CAPgB,EAQhB,CAAC,MAAD,EAAS,CAAC,GAAD,EAAK,GAAL,EAAS,CAAT,CAAT,EAAwB,CAAC,GAAD,EAAK,GAAL,EAAS,CAAT,CAAxB,CARgB,EAShB,CAAC,IAAD,EAAS,CAAC,GAAD,EAAK,GAAL,EAAS,CAAT,CAAT,EAAwB,CAAC,GAAD,EAAK,GAAL,EAAS,CAAT,CAAxB,CATgB,EAUhB,CAAC,MAAD,EAAS,CAAC,GAAD,EAAK,GAAL,EAAS,CAAT,CAAT,EAAwB,CAAC,GAAD,EAAK,GAAL,EAAS,CAAT,CAAxB,CAVgB,EAWhB,CAAC,KAAD,EAAS,CAAC,GAAD,EAAK,GAAL,EAAS,CAAT,CAAT,EAAwB,CAAC,GAAD,EAAK,GAAL,EAAS,CAAT,CAAxB,CAXgB,EAYhB,CAAC,MAAD,EAAS,CAAC,GAAD,EAAK,EAAL,EAAQ,CAAR,CAAT,EAAwB,CAAC,GAAD,EAAK,EAAL,EAAQ,CAAR,CAAxB,CAZgB,EAahB,CAAC,IAAD,EAAS,CAAC,GAAD,EAAK,CAAL,EAAO,CAAP,CAAT,EAAwB,CAAC,GAAD,EAAK,CAAL,EAAO,CAAP,CAAxB,CAbgB,EAchB,CAAC,MAAD,EAAS,CAAC,GAAD,EAAK,CAAL,EAAO,GAAP,CAAT,EAAwB,CAAC,GAAD,EAAK,CAAL,EAAO,GAAP,CAAxB,CAdgB,EAehB,CAAC,KAAD,EAAS,CAAC,GAAD,EAAK,GAAL,EAAS,GAAT,CAAT,EAAwB,CAAC,GAAD,EAAK,GAAL,EAAS,GAAT,CAAxB,CAfgB,EAgBhB,CAAC,MAAD,EAAS,CAAC,GAAD,EAAK,GAAL,EAAS,GAAT,CAAT,EAAwB,CAAC,GAAD,EAAK,GAAL,EAAU,GAAV,CAAxB,CAhBgB;AAJR,OAtIC;AA8Jb,gBAAU;AACR,kBAAU,SADF;AAER,uBAAe,yJAFP;AAGR,eAAO,wCAHC;AAIR,0BAAkB,CAChB,CAAC,CAAD,EAAQ,CAAC,GAAD,EAAM,GAAN,EAAW,GAAX,CAAR,EAAyB,CAAC,CAAD,EAAM,CAAN,EAAW,CAAX,CAAzB,CADgB,EAEhB,CAAC,KAAD,EAAQ,CAAC,CAAD,EAAM,CAAN,EAAW,CAAX,CAAR,EAAyB,CAAC,GAAD,EAAM,GAAN,EAAW,GAAX,CAAzB,CAFgB,EAGhB,CAAC,IAAD,EAAQ,CAAC,GAAD,EAAM,GAAN,EAAW,GAAX,CAAR,EAAyB,CAAC,CAAD,EAAM,CAAN,EAAW,CAAX,CAAzB,CAHgB,EAIhB,CAAC,GAAD,EAAQ,CAAC,CAAD,EAAM,CAAN,EAAW,CAAX,CAAR,EAAyB,CAAC,GAAD,EAAM,GAAN,EAAW,GAAX,CAAzB,CAJgB,EAKhB,CAAC,IAAD,EAAQ,CAAC,GAAD,EAAM,GAAN,EAAW,GAAX,CAAR,EAAyB,CAAC,CAAD,EAAM,GAAN,EAAW,CAAX,CAAzB,CALgB,EAMhB,CAAC,IAAD,EAAQ,CAAC,CAAD,EAAM,GAAN,EAAW,CAAX,CAAR,EAAyB,CAAC,GAAD,EAAM,GAAN,EAAW,CAAX,CAAzB,CANgB,EAOhB,CAAC,IAAD,EAAQ,CAAC,GAAD,EAAM,GAAN,EAAW,CAAX,CAAR,EAAyB,CAAC,GAAD,EAAM,CAAN,EAAW,CAAX,CAAzB,CAPgB,EAQhB,CAAC,IAAD,EAAQ,CAAC,GAAD,EAAM,CAAN,EAAW,CAAX,CAAR,EAAyB,CAAC,GAAD,EAAM,CAAN,EAAW,GAAX,CAAzB,CARgB;AAJV;AA9JG,KAAf;AAgLC,GAjLO,EAiLN,EAjLM,CA1Joc;AA2Utc,KAAE,CAAC,UAASN,OAAT,EAAiBS,MAAjB,EAAwBH,OAAxB,EAAgC;AACzC;AACA;AAEAG,WAAOH,OAAP,GAAiB,SAASqE,SAAT,CAAmBzC,OAAnB,EAA4B;AAE3C;AACA,UAAI0C,4BAA4B5E,QAAQ,gCAAR,CAAhC;;AACA,UAAI6E,YAAY7E,QAAQ,kBAAR,CAAhB;;AACA0B,aAAOD,IAAP,CAAYoD,SAAZ,EAAuBvD,OAAvB,CAA+B,UAASM,GAAT,EAAc;AAC3C;AACAiD,kBAAUjD,GAAV,EAAekD,EAAf,GAAoBF,0BAA0BC,UAAUjD,GAAV,EAAemD,cAAzC,CAApB;AACD,OAHD;;AAKA,UAAIC,UAAUhF,QAAQ,oBAAR,CAAd;;AAEA,eAASiF,QAAT,CAAkBC,OAAlB,EAA2BC,QAA3B,EAAqC;AACnC,YAAIC,CAAJ,EAAOC,IAAP,EAAaC,CAAb,EAAgBzF,CAAhB,EAAmB0F,CAAnB,EAAsBtB,CAAtB,EAAyBvE,CAAzB,EAA4BF,CAA5B,EAA+B4E,GAA/B;AACAoB,UAAE,eAAF,EAAmBC,QAAnB,CAA4B,QAA5B;AACA/F,YAAIwF,QAAQQ,KAAR,GAAgBR,QAAQS,MAA5B;AACAN,eAAO,IAAIO,iBAAJ,CAAsB,IAAIlG,CAA1B,CAAP;AACA6F,YAAI,CAAJ;;AACA,aAAK1F,IAAIoE,IAAI,CAAR,EAAWG,MAAM1E,CAAtB,EAAyB,KAAK0E,GAAL,GAAWH,IAAIG,GAAf,GAAqBH,IAAIG,GAAlD,EAAuDvE,IAAI,KAAKuE,GAAL,GAAW,EAAEH,CAAb,GAAiB,EAAEA,CAA9E,EAAiF;AAAA,0BACnEkB,SAASD,QAAQG,IAAR,CAAaxF,CAAb,CAAT,CADmE;;AAAA;;AAC9EL,WAD8E;AAC3E8F,WAD2E;AACxEF,WADwE;AAE/EC,eAAKE,GAAL,IAAY/F,CAAZ;AACA6F,eAAKE,GAAL,IAAYD,CAAZ;AACAD,eAAKE,GAAL,IAAYH,CAAZ;AACAC,eAAKE,GAAL,IAAY,GAAZ;AACD;;AACD,eAAO,IAAIP,OAAJ,CAAYK,IAAZ,EAAkBH,QAAQQ,KAA1B,EAAiCR,QAAQS,MAAzC,EAAiD,CAAjD,CAAP;AACD;;AAED,aAAO;AACLV,kBAAUA,QADL;AAELY,mBAAWhB,UAAU,SAAV,EAAqBC,EAF3B;AAGLgB,mBAAWjB,UAAU,WAAV,EAAuBC,EAH7B;AAILiB,4BAAoBlB,UAAU,WAAV,EAAuBC,EAJtC;AAKLhB,4BAAoBc;AALf,OAAP;AAQD,KApCD;AAsCC,GA1CO,EA0CN;AAAC,0BAAqB,EAAtB;AAAyB,sCAAiC,CAA1D;AAA4D,wBAAmB;AAA/E,GA1CM,CA3Uoc;AAqXvX,KAAE,CAAC,UAAS5E,OAAT,EAAiBS,MAAjB,EAAwBH,OAAxB,EAAgC;AACxH;AACA;AAEAG,WAAOH,OAAP,GAAiBU,OAAOgF,UAAP,GAAoB;AAEnC;AACA;AACAC,eAAS,SAASA,OAAT,CAAiBC,CAAjB,EAAoBC,CAApB,EAAuBC,CAAvB,EAA0B;AACjC,YAAIf,IAAJ,EAAUvF,CAAV,EAAaD,CAAb,EAAgBQ,CAAhB,EAAmBgG,CAAnB,EAAsBC,GAAtB,EAA2B3G,CAA3B;AACA0F,eAAO,EAAP;;AACA,YAAIc,MAAM,CAAV,EAAa;AACXG,gBAAM,CAACF,CAAD,EAAIA,CAAJ,EAAOA,CAAP,CAAN;AACD,SAFD,MAEO;AACLvG,cAAI0G,KAAKC,KAAL,CAAWN,IAAI,CAAf,CAAJ;AACApG,cAAIoG,IAAI,CAAJ,GAAQrG,CAAZ;AACAQ,cAAI+F,KAAK,IAAID,CAAT,CAAJ;AACAE,cAAID,KAAK,IAAItG,IAAIqG,CAAb,CAAJ;AACAxG,cAAIyG,KAAK,IAAI,CAAC,IAAItG,CAAL,IAAUqG,CAAnB,CAAJ;AACAd,iBAAO,CAACe,KAAK,IAAID,CAAT,CAAD,EAAcC,KAAK,IAAID,KAAKD,IAAIrG,CAAT,CAAT,CAAd,EAAqCuG,KAAK,IAAID,KAAK,KAAKD,IAAIrG,CAAT,CAAL,CAAT,CAArC,CAAP;;AACA,kBAAQA,CAAR;AACE,iBAAK,CAAL;AACEyG,oBAAM,CAACF,CAAD,EAAIzG,CAAJ,EAAOU,CAAP,CAAN;AACA;;AACF,iBAAK,CAAL;AACEiG,oBAAM,CAACD,CAAD,EAAID,CAAJ,EAAO/F,CAAP,CAAN;AACA;;AACF,iBAAK,CAAL;AACEiG,oBAAM,CAACjG,CAAD,EAAI+F,CAAJ,EAAOzG,CAAP,CAAN;AACA;;AACF,iBAAK,CAAL;AACE2G,oBAAM,CAACjG,CAAD,EAAIgG,CAAJ,EAAOD,CAAP,CAAN;AACA;;AACF,iBAAK,CAAL;AACEE,oBAAM,CAAC3G,CAAD,EAAIU,CAAJ,EAAO+F,CAAP,CAAN;AACA;;AACF;AACEE,oBAAM,CAACF,CAAD,EAAI/F,CAAJ,EAAOgG,CAAP,CAAN;AAjBJ;AAmBD;;AACD,eAAOC,GAAP;AACD,OArCkC;AAuCnCG,eAAS,SAASA,OAAT,CAAiBjH,CAAjB,EAAoB8F,CAApB,EAAuBF,CAAvB,EAA0B;AACjC,YAAIsB,CAAJ,EAAOR,CAAP,EAAUS,GAAV,EAAeC,GAAf,EAAoBT,CAApB,EAAuBC,CAAvB;AACAO,cAAMJ,KAAKI,GAAL,CAASnH,CAAT,EAAY8F,CAAZ,EAAeF,CAAf,CAAN;AACAwB,cAAML,KAAKK,GAAL,CAASpH,CAAT,EAAY8F,CAAZ,EAAeF,CAAf,CAAN;AACAc,YAAIC,IAAIC,IAAIO,GAAZ;AACAD,YAAIC,MAAMC,GAAV;AACAT,YAAIQ,QAAQ,CAAR,GAAY,CAAZ,GAAgBD,IAAIC,GAAxB;;AACA,YAAIA,QAAQC,GAAZ,EAAiB;AACfV,cAAI,CAAJ,CADe,CACR;AACR,SAFD,MAEO;AACL,kBAAQS,GAAR;AACE,iBAAKnH,CAAL;AACE0G,kBAAI,CAACZ,IAAIF,CAAL,IAAUsB,CAAV,IAAepB,IAAIF,CAAJ,GAAQ,CAAR,GAAY,CAA3B,CAAJ;AACA;;AACF,iBAAKE,CAAL;AACEY,kBAAI,CAACd,IAAI5F,CAAL,IAAUkH,CAAV,GAAc,CAAlB;AACA;;AACF,iBAAKtB,CAAL;AACEc,kBAAI,CAAC1G,IAAI8F,CAAL,IAAUoB,CAAV,GAAc,CAAlB;AARJ;;AAUAR,eAAK,CAAL;AACD;;AACD,eAAO,CAACA,CAAD,EAAIC,CAAJ,EAAOC,CAAP,CAAP;AACD;AA9DkC,KAArC;AAkEC,GAtEsF,EAsErF,EAtEqF,CArXqX;AA2btc,KAAE,CAAC,UAASpG,OAAT,EAAiBS,MAAjB,EAAwBH,OAAxB,EAAgC;AACzC;AACA;AACA;AACAG,WAAOH,OAAP,GAAiBU,OAAO6F,UAAP,GAAoB;AAEnCC,cAAQ,IAF2B;AAGnCnE,YAAM,IAH6B;AAInCoE,sBAAgB,EAJmB;AAMnCC,wBAAkB,4BAAW;AAC3B,YAAIH,WAAWlE,IAAf,EAAqB;AACnB,iBAAO,IAAP;AACD,SAFD,MAEO;AACL,iBAAO,KAAP;AACD;AACF,OAZkC;AAcnCsE,mBAAa,uBAAW;AACtB,eAAOJ,WAAWE,cAAlB;AACD,OAhBkC;AAkBnCG,mBAAa,qBAASC,IAAT,EAAe;AAC1B,eAAON,WAAWE,cAAX,GAA4BI,IAAnC;AACD,OApBkC;AAsBnCC,uBAAiB,yBAASC,GAAT,EAAcC,QAAd,EAAwB;AACvC,YAAIC,GAAJ;AACAA,cAAM,IAAIC,KAAJ,EAAN;;AACAD,YAAIE,MAAJ,GAAa,SAASC,WAAT,GAAuB;AAClC,cAAIC,MAAJ,EAAYC,GAAZ,EAAiBC,OAAjB;AACAF,mBAASG,SAASC,aAAT,CAAuB,QAAvB,CAAT;AACAH,gBAAMD,OAAOK,UAAP,CAAkB,IAAlB,CAAN;AACAL,iBAAOjC,KAAP,GAAe,GAAf;AACAiC,iBAAOhC,MAAP,GAAgB,GAAhB;AACAiC,cAAIK,SAAJ,CAAc,IAAd,EAAoB,CAApB,EAAuB,CAAvB,EAA0B,KAAKvC,KAA/B,EAAsC,KAAKC,MAA3C,EAAmD,CAAnD,EAAsD,CAAtD,EAAyDgC,OAAOjC,KAAhE,EAAuEiC,OAAOhC,MAA9E;AACA2B,qBAAWA,SAASY,QAAT,EAAX;AACAL,oBAAUF,OAAOQ,SAAP,CAAiB,YAAjB,CAAV;AACA,iBAAOtB,WAAWC,MAAX,CAAkBsB,IAAlB,CAAuB,iBAAvB,EAA0C;AAC/C,oBAAQvB,WAAWE,cAD4B;AAE/C,oBAAQc,OAFuC;AAG/C,wBAAYP;AAHmC,WAA1C,CAAP;AAKD,SAdD;;AAeA,eAAOC,IAAIF,GAAJ,GAAUA,GAAjB;AACD,OAzCkC;AA2CnCgB,gBAAU,kBAASC,KAAT,EAAgBhB,QAAhB,EAA0BiB,MAA1B,EAAkC;AAC1C,YAAIC,MAAJ;;AACA,YAAIF,SAASA,MAAM,CAAN,CAAb,EAAuB;AACrB9C,YAAE,WAAF,EAAeiD,IAAf,CAAoB,UAApB,EAAgC,IAAhC;AACAjD,YAAE,iBAAF,EAAqBiD,IAArB,CAA0B,UAA1B,EAAsC,IAAtC;AACA5B,qBAAWlE,IAAX,GAAkB2F,MAAM,CAAN,CAAlB;AACAzB,qBAAWlE,IAAX,CAAgB6F,MAAhB,GAAyB,IAAIE,UAAJ,EAAzB;;AACA,cAAIH,MAAJ,EAAY;AACV1B,uBAAWlE,IAAX,CAAgB6F,MAAhB,CAAuBf,MAAvB,GAAgC,SAASkB,YAAT,CAAsBC,KAAtB,EAA6B;AAC3D,qBAAO/B,WAAWC,MAAX,CAAkBsB,IAAlB,CAAuB,YAAvB,EAAqC;AAC1C,wBAAQvB,WAAWE,cADuB;AAE1C,wBAAQF,WAAWlE,IAAX,CAAgBkG,IAFkB;AAG1C,wBAAQD,MAAME,MAAN,CAAazE;AAHqB,eAArC,CAAP;AAKD,aAND;;AAOAwC,uBAAWC,MAAX,CAAkBsB,IAAlB,CAAuB,YAAvB,EAAqC;AACnC,sBAAQE,MAAM,CAAN,EAASnB,IADkB;AAEnC,sBAAQmB,MAAM,CAAN,EAASO;AAFkB,aAArC;AAID;;AACDhC,qBAAWlE,IAAX,CAAgBoG,QAAhB,GAA2B,CAA3B;AACAP,mBAAS,IAAIE,UAAJ,EAAT;;AACAF,iBAAOf,MAAP,GAAgB,SAASkB,YAAT,CAAsBC,KAAtB,EAA6B;AAC3C,gBAAIrB,GAAJ;AACAA,kBAAM,IAAIC,KAAJ,EAAN;;AACAD,gBAAIE,MAAJ,GAAa,SAASC,WAAT,GAAuB;AAClC,qBAAOJ,SAAS,IAAT,CAAP;AACD,aAFD;;AAGA,mBAAOC,IAAIF,GAAJ,GAAUuB,MAAME,MAAN,CAAazE,MAA9B;AACD,WAPD;;AAQA,iBAAOmE,OAAOQ,aAAP,CAAqBV,MAAM,CAAN,CAArB,CAAP;AACD;AACF,OA3EkC;AA6EnCW,iBAAW,mBAAS3B,QAAT,EAAmB;AAC5BA,mBAAWA,SAASY,QAAT,EAAX;AACA,eAAOrB,WAAWC,MAAX,CAAkBsB,IAAlB,CAAuB,iBAAvB,EAA0C;AAC/C,kBAAQvB,WAAWE,cAD4B;AAE/C,sBAAYO;AAFmC,SAA1C,CAAP;AAID,OAnFkC;AAqFnC4B,kBAAY,oBAAS/B,IAAT,EAAe9B,IAAf,EAAqBiC,QAArB,EAA+B;AACzCA,mBAAWA,SAASY,QAAT,EAAX;AACA,eAAOrB,WAAWC,MAAX,CAAkBsB,IAAlB,CAAuB,cAAvB,EAAuC;AAC5C,kBAAQjB,IADoC;AAE5C,kBAAQ9B,IAFoC;AAG5C,sBAAYiC;AAHgC,SAAvC,CAAP;AAKD,OA5FkC;AA8FnChE,kBAAY,oBAASpB,OAAT,EAAkB;AAC5BA,kBAAUA,WAAW,EAArB;AACAA,gBAAQiH,iBAAR,GAA4BjH,QAAQiH,iBAAR,IAA6B,KAAzD;AACAjH,gBAAQkH,UAAR,GAAqBlH,QAAQkH,UAAR,IAAsB,CAAC,WAAD,EAAc,mBAAd,CAA3C;;AAEA,YAAIlH,QAAQ4E,MAAZ,EAAoB;AAClBD,qBAAWC,MAAX,GAAoBuC,GAAGC,OAAH,CAAWtI,OAAOC,QAAP,CAAgBsI,QAAhB,GAA2B,IAA3B,GAAkCvI,OAAOC,QAAP,CAAgBuI,IAA7D,EAAmEtH,OAAnE,CAApB;AACA2E,qBAAWC,MAAX,CAAkB2C,EAAlB,CAAqB,eAArB,EAAsC,UAASpE,IAAT,EAAe;AACnD,gBAAI1C,IAAJ,EAAU+G,OAAV,EAAmBC,GAAnB;AACAhH,mBAAOkE,WAAWlE,IAAlB;AACAgH,kBAAMnE,EAAE,iBAAF,EAAqBoE,IAArB,GAA4BzI,KAA5B,CAAkC,QAAlC,EAA4C,CAA5C,CAAN;AACAwI,mBAAO,QAAQpD,KAAKsD,KAAL,CAAYlH,KAAKoG,QAAL,GAAgBpG,KAAKkG,IAAtB,GAA8B,GAAzC,CAAR,GAAwD,GAA/D;AACArD,cAAE,iBAAF,EAAqBoE,IAArB,CAA0BD,GAA1B;AACAD,sBAAU/G,KAAKmH,KAAL,CAAWnH,KAAKoG,QAAhB,EAA0BpG,KAAKoG,QAAL,GAAgBxC,KAAKK,GAAL,CAASvB,KAAK,OAAL,CAAT,EAAwB1C,KAAKkG,IAAL,GAAYlG,KAAKoG,QAAzC,CAA1C,CAAV;AACAlC,uBAAWlE,IAAX,CAAgBoG,QAAhB,IAA4B1D,KAAK,OAAL,CAA5B;AACAwB,uBAAWE,cAAX,GAA4B1B,KAAK,MAAL,CAA5B;AACA,mBAAO1C,KAAK6F,MAAL,CAAYQ,aAAZ,CAA0BU,OAA1B,CAAP;AACD,WAVD;AAWA7C,qBAAWC,MAAX,CAAkB2C,EAAlB,CAAqB,YAArB,EAAmC,UAASpE,IAAT,EAAe;AAChD,gBAAIsE,GAAJ;;AACA,gBAAItE,KAAK,OAAL,CAAJ,EAAmB;AACjB0E,oBAAM1E,KAAK,OAAL,CAAN;AACD,aAFD,MAEO;AACLwB,yBAAWE,cAAX,GAA4B1B,KAAK,MAAL,CAA5B;AACD;;AACDsE,kBAAMnE,EAAE,iBAAF,EAAqBoE,IAArB,GAA4BzI,KAA5B,CAAkC,QAAlC,EAA4C,CAA5C,CAAN;AACAqE,cAAE,iBAAF,EAAqBoE,IAArB,CAA0BD,GAA1B;AACAnE,cAAE,WAAF,EAAeiD,IAAf,CAAoB,UAApB,EAAgC,KAAhC;AACA,mBAAOjD,EAAE,iBAAF,EAAqBiD,IAArB,CAA0B,UAA1B,EAAsC,KAAtC,CAAP;AACD,WAXD;AAYA5B,qBAAWC,MAAX,CAAkB2C,EAAlB,CAAqB,aAArB,EAAoC,UAASpE,IAAT,EAAe;AACjDwB,uBAAWE,cAAX,GAA4B1B,KAAK,MAAL,CAA5B;AACA2E,iBAAK,kBAAkB3E,KAAK,UAAL,CAAvB;AACA,mBAAOiC,UAAP;AACD,WAJD;AAKAT,qBAAWC,MAAX,CAAkB2C,EAAlB,CAAqB,gBAArB,EAAuC,UAASpE,IAAT,EAAe;AACpD,gBAAIA,KAAK,OAAL,CAAJ,EAAmB;AACjB,qBAAO0E,MAAM1E,KAAK,OAAL,CAAN,CAAP;AACD,aAFD,MAEO;AACLwB,yBAAWE,cAAX,GAA4B1B,KAAK,MAAL,CAA5B;AACA2E,mBAAK,kBAAkB3E,KAAK,UAAL,CAAvB;AACA,qBAAOiC,UAAP;AACD;AACF,WARD;AASAT,qBAAWC,MAAX,CAAkB2C,EAAlB,CAAqB,gBAArB,EAAuC,UAASpE,IAAT,EAAe;AACpD2E,iBAAK,kBAAkB3E,KAAK,UAAL,CAAvB;AACA,mBAAOiC,UAAP;AACD,WAHD;AAID;AAEF;AAhJkC,KAArC;AAmJC,GAvJO,EAuJN,EAvJM,CA3boc;AAklBtc,KAAE,CAAC,UAAStH,OAAT,EAAiBS,MAAjB,EAAwBH,OAAxB,EAAgC;AACzC;AACA;AACAG,WAAOH,OAAP,GAAiB,SAASuD,MAAT,CAAgB3B,OAAhB,EAAyB;AACxC,UAAIyF,MAAJ,EACIC,GADJ,CADwC,CAIxC;;AACA,eAAStE,UAAT,GAAsB;AACpB2G,qBAAaC,aAAb,EAA4BC,OAA5B,EAAqCC,WAArC,EADoB,CAGpB;;AACAF,sBAAcG,OAAd,CAAsBC,YAAtB,CAAmC,UAAnC,EAA+C,UAA/C;AACAJ,sBAAcG,OAAd,CAAsBC,YAAtB,CAAmC,aAAnC,EAAkD,aAAlD;AAEAtJ,eAAOuJ,MAAP,GAAgBL,aAAhB,CAPoB,CAOW;;AAC/BvC,iBAASzF,QAAQyF,MAAR,IAAkBG,SAAS0C,cAAT,CAAwB,OAAxB,CAA3B;AACA5C,cAAMD,OAAOK,UAAP,CAAkB,IAAlB,CAAN,CAToB,CAUpB;AACA;;AACAxC,UAAE,WAAF,EAAeiF,IAAf;AACAjF,UAAE,aAAF,EAAiBiF,IAAjB;AACAjF,UAAE,SAAF,EAAaiF,IAAb;AACD,OApBuC,CAsBxC;AACA;AACA;AACA;AACA;;;AACA,UAAIP,gBAAgBhI,QAAQgI,aAAR,IAAyB;AAC3C,iBAAS,KADkC;AAE3C,iBAAS,IAFkC;AAG3C;AACA;AACAQ,YAAI,QALuC;AAM3CC,gBAAQ,IANmC;AAO3CC,gBAAQ,IAPmC;AAQ3C;AACA;AACAlF,eAAO,GAVoC;AAW3CC,gBAAQ,GAXmC;AAY3C;AACA;AACA;AACApD,cAAM,UAfqC;AAgB3C;AACAsI,eAAO,iBAAW,CAAE,CAjBuB;AAkB3C;AACAC,mBAAW,SAASC,eAAT,GAA2B;AACpC,iBAAO/J,OAAOuJ,MAAP,CAAcS,IAAd,EAAP;AACD,SArB0C;AAsB3C;AACA;AACAC,gBAAQC,kBAxBmC;AAyB3CC,gBAAQ,SAASC,kBAAT,GAA8B,CAAE;AAzBG,OAA7C;;AA4BA,eAASF,kBAAT,CAA4B7F,IAA5B,EAAkC;AAChC,YAAIgG,GAAJ;AAAA,YAASnF,CAAT;AAAA,YAAYrG,CAAZ;AAAA,YAAe0H,GAAf;AAAA,YAAoBhC,CAApB;AAAA,YAAuBnB,GAAvB;AAAA,YAA4BkH,GAA5B;AAAA,YAAiCC,CAAjC;AAAA,YAAoCC,MAAM,CAA1C;AACAH,cAAMhG,KAAKlE,KAAL,CAAW,EAAX,CAAN;AACAoG,cAAMlF,OAAOoB,KAAb;AACA6H,cAAM,IAAN;AACAC,YAAIrB,cAAcxE,KAAlB;AACAQ,YAAIgE,cAAcvE,MAAlB;;AACA,aAAK9F,IAAI0F,IAAI,CAAR,EAAWnB,MAAMmH,IAAI,CAA1B,EAA6B,KAAKnH,GAAL,GAAWmB,KAAKnB,GAAhB,GAAsBmB,KAAKnB,GAAxD,EAA6DvE,IAAI,KAAKuE,GAAL,GAAW,EAAEmB,CAAb,GAAiB,EAAEA,CAApF,EAAuF;AACrF+F,gBAAMG,SAASJ,IAAIxL,CAAJ,CAAT,EAAiB,EAAjB,CAAN;AACA0H,cAAIlC,IAAJ,CAASmG,MAAM,CAAf,IAAqBF,OAAO,EAAR,GAAc,IAAlC;AACA/D,cAAIlC,IAAJ,CAASmG,MAAM,CAAf,IAAqBF,OAAO,CAAR,GAAa,IAAjC;AACA/D,cAAIlC,IAAJ,CAASmG,MAAM,CAAf,IAAoBF,MAAM,IAA1B;AACA/D,cAAIlC,IAAJ,CAASmG,MAAM,CAAf,IAAoB,IAApB;AACAA,iBAAO,CAAP;AACD;;AACD,YAAIA,OAAO,IAAID,CAAJ,GAAQrF,CAAnB,EAAsB;AACpB0B,cAAI8D,YAAJ,CAAiBnE,GAAjB,EAAsB,CAAtB,EAAyB,CAAzB;AACA,iBAAOiE,MAAM,CAAb;AACD;AACF;;AAED,eAASrB,OAAT,CAAiBwB,MAAjB,EAAyB;AACvB,YAAItI,KAAJ;;AACA,YAAI6G,cAAc0B,OAAd,KAA0B,QAA9B,EAAwC;AACtCvI,kBAAQ6G,cAAcG,OAAtB;;AACA,cAAIwB,UAAUC,eAAd,EAA+B;AAC7BzI,kBAAM0I,YAAN,GAAqBJ,MAArB;AACA7I,oBAAQC,GAAR,CAAY,YAAZ;AACD,WAHD,MAGO;AACLM,kBAAM2I,SAAN,GAAkBL,MAAlB;AACD;;AACD,iBAAOtI,MAAM4I,OAAN,GAAgB,UAASxM,CAAT,EAAY;AACjC,mBAAOkM,OAAOO,IAAP,EAAP;AACD,WAFD;AAGD,SAXD,MAWO,CAEN;AACF;;AAED,eAAS9B,WAAT,CAAqB+B,KAArB,EAA4B;AAC1BpC,cAAM,sBAAN;AACAjH,gBAAQC,GAAR,CAAYoJ,KAAZ;AACA,eAAOrJ,QAAQqJ,KAAR,CAAc,8BAA8BA,MAAM/L,IAApC,GAA2C,GAAzD,CAAP;AACD,OAlGuC,CAoGxC;;;AACA,eAASsD,WAAT,GAAuB;AACrB,YAAIL,KAAJ,CADqB,CAErB;AACA;AACA;AACA;;AACA,YAAI6G,cAAc0B,OAAd,KAA0B,QAA9B,EAAwC;AACtCvI,kBAAQyE,SAASsE,oBAAT,CAA8B,OAA9B,EAAuC,CAAvC,CAAR;AACAlK,kBAAQE,SAAR,CAAkBiK,WAAlB,CAA8BhJ,KAA9B;AACA,iBAAOmC,EAAE,SAAF,EAAa8G,IAAb,EAAP,CAHsC,CAIxC;AACA;AACA;AACC,SAPD,MAOO,IAAIpC,cAAc0B,OAAd,KAA0B,OAA9B,EAAuC;AAC5C,iBAAO5K,OAAOuJ,MAAP,CAAcgC,OAAd,EAAP;AACD,SAFM,MAEA;AACLzJ,kBAAQC,GAAR,CAAY,0CAAZ;AACD;AACF;;AAED,aAAO;AACLW,qBAAaA,WADR;AAELJ,oBAAYA,UAFP;AAGL4H,4BAAoBA,kBAHf;AAILhB,uBAAeA;AAJV,OAAP;AAMD,KA/HD;AAiIC,GApIO,EAoIN,EApIM,CAllBoc;AAstBtc,KAAE,CAAC,UAASlK,OAAT,EAAiBS,MAAjB,EAAwBH,OAAxB,EAAgC;AACzC;AACA;AAEAG,WAAOH,OAAP,GAAiB,SAASkM,IAAT,CAActK,OAAd,EAAuBE,SAAvB,EAAkC;AAEjD,eAASwB,aAAT,GAAyB;AACvB,YAAIgF,KAAJ,EAAW6D,MAAX,EAAmBC,GAAnB,CADuB,CAEvB;;AACAA,cAAM5E,SAASC,aAAT,CAAuB,GAAvB,CAAN,CAHuB,CAIvB;;AACA2E,YAAIC,IAAJ,GAAWvK,UAAUwK,eAAV,EAAX;;AACA,YAAIF,IAAIC,IAAJ,CAASE,KAAT,CAAe,YAAf,CAAJ,EAAkC;AAChCJ,mBAAS,KAAT;AACD,SAFD,MAEO;AACLA,mBAAS,KAAT;AACD;;AACDC,YAAI/I,QAAJ,GAAgB,IAAImJ,IAAJ,EAAD,CAAaC,WAAb,GAA2BC,OAA3B,CAAmC,IAAnC,EAAyC,GAAzC,IAAgD,GAAhD,GAAsDP,MAArE,CAXuB,CAYvB;;AACA,YAAI3E,SAASmF,WAAb,EAA0B;AACxBrE,kBAAQd,SAASmF,WAAT,CAAqB,aAArB,CAAR;AACArE,gBAAMsE,cAAN,CAAqB,OAArB,EAA8B,IAA9B,EAAoC,IAApC,EAA0ClM,MAA1C,EAAkD,CAAlD,EAAqD,CAArD,EAAwD,CAAxD,EAA2D,CAA3D,EAA8D,CAA9D,EAAiE,KAAjE,EAAwE,KAAxE,EAA+E,KAA/E,EAAsF,KAAtF,EAA6F,CAA7F,EAAgG,IAAhG;AACA0L,cAAIS,aAAJ,CAAkBvE,KAAlB;AACD,SAJD,MAIO,IAAI8D,IAAIU,SAAR,EAAmB;AACxBV,cAAIU,SAAJ,CAAc,SAAd;AACD;;AACD,eAAO,IAAP;AACD,OAvBgD,CAyBjD;;;AACA,eAASC,UAAT,CAAoBhG,GAApB,EAAyB9E,IAAzB,EAA+B;AAC7B,YAAIgF,GAAJ;AACA/B,UAAE,iBAAF,EAAqBiF,IAArB;AACAjF,UAAE,YAAF,EAAgBiF,IAAhB;AACAlD,cAAM,IAAIC,KAAJ,EAAN;;AACA,YAAItF,QAAQC,QAAZ,EAAsB;AACpBoF,cAAIE,MAAJ,GAAa,YAAW;AACtB,gBAAI6F,QAAJ;AACAA,uBAAWjG,IAAIlG,KAAJ,CAAU,GAAV,CAAX;AACAmM,uBAAWA,SAASA,SAAS9M,MAAT,GAAkB,CAA3B,CAAX;AACAqG,uBAAWK,WAAX,CAAuBoG,QAAvB;;AACA,gBAAI/K,IAAJ,EAAU;AACR,kBAAIA,KAAKgL,SAAL,CAAe,CAAf,EAAkB,CAAlB,MAAyB,OAA7B,EAAsC;AACpC/H,kBAAE,eAAF,EAAmBgI,GAAnB,CAAuBjL,IAAvB,EAA6BkL,MAA7B;AACD,eAFD,MAEO;AACLjI,kBAAE,YAAYjD,IAAd,EAAoBmL,MAApB,CAA2B,QAA3B;AACAlI,kBAAE,YAAYjD,IAAd,EAAoBoL,KAApB,GAFK,CAEwB;AAC9B;AACF;;AACDzL,oBAAQ0L,6BAAR,CAAsC/M,MAAtC;;AACA,gBAAI0B,SAAS,MAAb,EAAqB;AACnBL,sBAAQ0L,6BAAR,CAAsC;AACpC,qBAAK;AAD+B,eAAtC;AAGArL,qBAAO,mBAAP;AACD,aALD,MAKO,IAAIA,SAAS,KAAb,EAAoB;AACzBL,sBAAQ0L,6BAAR,CAAsC;AACpC,qBAAK;AAD+B,eAAtC;AAGArL,qBAAO,mBAAP;AACD,aALM,MAKA,IAAIA,SAAS,KAAb,EAAoB;AACzBL,sBAAQ0L,6BAAR,CAAsC;AACpC,qBAAK,GAD+B;AAEpC,qBAAK,GAF+B;AAGpC,qBAAK;AAH+B,eAAtC;AAKArL,qBAAO,cAAP;AACD;;AACRH,sBAAUiK,WAAV,CAAsB,IAAtB;;AACO,gBAAIxL,OAAO,OAAP,MAAoB,MAApB,IAA8BA,OAAO,GAAP,MAAgB,MAAlD,EAA0D;AACxDqB,sBAAQI,SAAR,GAAoB,IAApB,CADwD,CAC9B;AAC3B;;AACDuL,6BAAiBtL,IAAjB,EApCsB,CAoCE;;AACxB,gBAAI1B,OAAO,OAAP,MAAoB,MAApB,IAA8BA,OAAO,GAAP,MAAgB,MAAlD,EAA0D;AACxDqB,sBAAQI,SAAR,GAAoB,IAApB,CADwD,CAC9B;AAC3B;;AACD,gBAAIJ,QAAQI,SAAZ,EAAuB;AACrBkD,gBAAE,cAAF,EAAkBkI,MAAlB,CAAyB,QAAzB;AACA,qBAAOI,cAAP;AACD;AACF,WA5CD;AA6CD;;AACD,eAAOvG,IAAIF,GAAJ,GAAUA,GAAjB;AACD;;AAED,aAAO;AACLgG,oBAAYA,UADP;AAELzJ,uBAAeA;AAFV,OAAP;AAKD,KAtFD;AAwFC,GA5FO,EA4FN,EA5FM,CAttBoc;AAkzBtc,MAAG,CAAC,UAAS5D,OAAT,EAAiBS,MAAjB,EAAwBH,OAAxB,EAAgC;AAC1C;AACAG,WAAOH,OAAP,GAAiB,SAASyN,MAAT,CAAgB7L,OAAhB,EAAyB;AAExC,UAAIa,MAAM,EAAV,CAFwC,CAE1B;;AAEd,eAASiL,QAAT,GAAoB;AAClB,YAAIC,QAAJ;AACAA,mBAAW,wBAAX;AACAA,oBAAYzI,EAAE,QAAF,EAAYgI,GAAZ,KAAoB,QAAQhI,EAAE,QAAF,EAAYgI,GAAZ,EAA5B,GAAgD,EAA5D;AACAS,oBAAY/L,QAAQI,SAAR,GAAoB,SAApB,GAAgC,EAA5C,CAJkB,CAI8B;;AAChD,eAAOS,IAAIlB,IAAJ,CAASoM,QAAT,CAAP;AACD;;AAED,eAASC,OAAT,GAAmB;AACjB,YAAID,QAAJ;AACAA,mBAAW,uBAAX;AACAA,oBAAYzI,EAAE,QAAF,EAAYgI,GAAZ,KAAoB,QAAQhI,EAAE,QAAF,EAAYgI,GAAZ,EAA5B,GAAgD,EAA5D;AACAS,oBAAYzI,EAAE,QAAF,EAAYgI,GAAZ,KAAoB,QAAQhI,EAAE,QAAF,EAAYgI,GAAZ,EAA5B,GAAgD,EAA5D;AACAS,oBAAYzI,EAAE,QAAF,EAAYgI,GAAZ,KAAoB,QAAQhI,EAAE,QAAF,EAAYgI,GAAZ,EAA5B,GAAgD,EAA5D;AACA,eAAOzK,IAAIlB,IAAJ,CAASoM,QAAT,CAAP;AACD;;AAED,eAASE,OAAT,GAAmB;AACjB,YAAIF,QAAJ;AACAA,mBAAW,mBAAX;AACAA,oBAAYzI,EAAE,QAAF,EAAYgI,GAAZ,KAAoB,QAAQhI,EAAE,QAAF,EAAYgI,GAAZ,EAA5B,GAAgD,EAA5D;AACAS,oBAAYzI,EAAE,QAAF,EAAYgI,GAAZ,KAAoB,QAAQhI,EAAE,QAAF,EAAYgI,GAAZ,EAA5B,GAAgD,EAA5D;AACAS,oBAAYzI,EAAE,QAAF,EAAYgI,GAAZ,KAAoB,QAAQhI,EAAE,QAAF,EAAYgI,GAAZ,EAA5B,GAAgD,EAA5D;AACA,eAAOzK,IAAIlB,IAAJ,CAASoM,QAAT,CAAP;AACD;;AAED,eAAS7K,QAAT,GAAoB;AAClB,YAAIlB,QAAQK,IAAR,KAAiB,mBAArB,EAA0C;AACxC,iBAAOyL,UAAP;AACD,SAFD,MAEO,IAAI9L,QAAQK,IAAR,KAAiB,kBAArB,EAAyC;AAC9C,iBAAO2L,SAAP;AACD,SAFM,MAEA,IAAIhM,QAAQK,IAAR,KAAiB,cAArB,EAAqC;AAC1C,iBAAO4L,SAAP;AACD;AACF;;AAED,aAAO;AACLpL,aAAKA,GADA;AAELmL,iBAASA,OAFJ;AAGLF,kBAAUA,QAHL;AAILG,iBAASA,OAJJ;AAKL/K,kBAAUA;AALL,OAAP;AAQD,KAhDD;AAkDC,GApDQ,EAoDP,EApDO,CAlzBmc;AAs2Btc,MAAG,CAAC,UAASpD,OAAT,EAAiBS,MAAjB,EAAwBH,OAAxB,EAAgC;AAC1C;AACA;AAEA;AACA;AAEAG,WAAOH,OAAP,GAAiB,SAAS8N,mBAAT,GAA+B;AAE9C,UAAIC,QAAQ,EAAZ;AAAA,UACIC,QAAQ,EADZ;AAAA,UAEIC,YAFJ;AAAA,UAGI5J,YAAY3E,QAAQ,oBAAR,EAA8BgF,OAA9B,CAHhB;AAAA,UAIIG,WAAWR,UAAUkB,SAJzB;AAAA,UAKI2I,aAAaxO,QAAQ,qBAAR,CALjB;AAAA,UAMIyD,QAAQ,IANZ;AAAA,UAOIlB,OAAO,KAPX;AAAA,UAQIkM,IARJ;AAAA,UASIC,QAAQ,EATZ;AAAA,UAUIC,QAVJ;AAAA,UAWIC,eAXJ;;AAaA,UAAI5J,UAAUhF,QAAQ,oBAAR,CAAd;;AAEA,eAASuO,YAAT,CAAsBrJ,OAAtB,EAA+B;AAC7B,YAAIE,CAAJ,EAAOE,CAAP,EAAUzF,CAAV,EAAaoE,CAAb,EAAgB4K,OAAhB,EAAyBnP,CAAzB,EAA4BF,CAA5B,EAA+B4E,GAA/B;AACA1E,YAAIwF,QAAQQ,KAAR,GAAgBR,QAAQS,MAA5B;AACAnG,YAAI,IAAIsP,YAAJ,CAAiBpP,CAAjB,CAAJ;AACA4F,YAAI,IAAIwJ,YAAJ,CAAiBpP,CAAjB,CAAJ;AACA0F,YAAI,IAAI0J,YAAJ,CAAiBpP,CAAjB,CAAJ;;AACA,aAAKG,IAAIoE,IAAI,CAAR,EAAWG,MAAM1E,CAAtB,EAAyB,KAAK0E,GAAL,GAAWH,IAAIG,GAAf,GAAqBH,IAAIG,GAAlD,EAAuDvE,IAAI,KAAKuE,GAAL,GAAW,EAAEH,CAAb,GAAiB,EAAEA,CAA9E,EAAiF;AAC/EzE,YAAEK,CAAF,IAAOqF,QAAQG,IAAR,CAAa,IAAIxF,CAAJ,GAAQ,CAArB,CAAP;AACAyF,YAAEzF,CAAF,IAAOqF,QAAQG,IAAR,CAAa,IAAIxF,CAAJ,GAAQ,CAArB,CAAP;AACAuF,YAAEvF,CAAF,IAAOqF,QAAQG,IAAR,CAAa,IAAIxF,CAAJ,GAAQ,CAArB,CAAP;AACD;;AACD,iBAASgP,OAAT,CAAiBnI,CAAjB,EAAoB;AAClB,iBAAO,IAAI1B,OAAJ,CAAY0B,CAAZ,EAAexB,QAAQQ,KAAvB,EAA8BR,QAAQS,MAAtC,EAA8C,CAA9C,CAAP;AACD;;AACD,eAAO,CAACkJ,QAAQrP,CAAR,CAAD,EAAaqP,QAAQvJ,CAAR,CAAb,EAAyBuJ,QAAQzJ,CAAR,CAAzB,CAAP;AACD,OAhC6C,CAkC9C;;;AACA,eAASqJ,IAAT,CAAcM,QAAd,EAAwBC,QAAxB,EAAkC;AAChC,YAAItI,CAAJ,EAAO7G,CAAP,EAAUoE,CAAV,EAAavE,CAAb,EAAgB0E,GAAhB;AACA1E,YAAIqP,SAASrJ,KAAT,GAAiBqJ,SAASpJ,MAA9B;AACAe,YAAI,IAAIuI,YAAJ,CAAiBvP,CAAjB,CAAJ;;AACA,aAAKG,IAAIoE,IAAI,CAAR,EAAWG,MAAM1E,CAAtB,EAAyB,KAAK0E,GAAL,GAAWH,IAAIG,GAAf,GAAqBH,IAAIG,GAAlD,EAAuDvE,IAAI,KAAKuE,GAAL,GAAW,EAAEH,CAAb,GAAiB,EAAEA,CAA9E,EAAiF;AAC/EyC,YAAE7G,CAAF,IAAO,CAACkP,SAAS1J,IAAT,CAAcxF,CAAd,IAAmBmP,SAAS3J,IAAT,CAAcxF,CAAd,CAApB,KAAyCkP,SAAS1J,IAAT,CAAcxF,CAAd,IAAmBmP,SAAS3J,IAAT,CAAcxF,CAAd,CAA5D,CAAP;AACD;;AACD,eAAO,IAAImF,OAAJ,CAAY0B,CAAZ,EAAeqI,SAASrJ,KAAxB,EAA+BqJ,SAASpJ,MAAxC,EAAgD,CAAhD,CAAP;AACD;;AAED,eAASuJ,YAAT,CAAsBhK,OAAtB,EAA+B;AAC7B,YAAIE,CAAJ,EAAOE,CAAP,EAAUzF,CAAV,EAAaoE,CAAb,EAAgBvE,CAAhB,EAAmBE,CAAnB,EAAsBJ,CAAtB,EAAyB4E,GAAzB;AACAoB,UAAE,eAAF,EAAmB2J,WAAnB,CAA+B,QAA/B;AACAzP,YAAIwF,QAAQQ,KAAR,GAAgBR,QAAQS,MAA5B;AACAnG,YAAI,IAAIsP,YAAJ,CAAiBpP,CAAjB,CAAJ;AACA4F,YAAI,IAAIwJ,YAAJ,CAAiBpP,CAAjB,CAAJ;AACA0F,YAAI,IAAI0J,YAAJ,CAAiBpP,CAAjB,CAAJ;AACAE,YAAI,IAAIkP,YAAJ,CAAiB,IAAIpP,CAArB,CAAJ;;AACA,aAAKG,IAAIoE,IAAI,CAAR,EAAWG,MAAM1E,CAAtB,EAAyB,KAAK0E,GAAL,GAAWH,IAAIG,GAAf,GAAqBH,IAAIG,GAAlD,EAAuDvE,IAAI,KAAKuE,GAAL,GAAW,EAAEH,CAAb,GAAiB,EAAEA,CAA9E,EAAiF;AAC/EzE,YAAEK,CAAF,IAAOqF,QAAQG,IAAR,CAAa,IAAIxF,CAAJ,GAAQ,CAArB,IAA0B,GAAjC;AACAyF,YAAEzF,CAAF,IAAOqF,QAAQG,IAAR,CAAa,IAAIxF,CAAJ,GAAQ,CAArB,IAA0B,GAAjC;AACAuF,YAAEvF,CAAF,IAAOqF,QAAQG,IAAR,CAAa,IAAIxF,CAAJ,GAAQ,CAArB,IAA0B,GAAjC;AACAD,YAAE,IAAIC,CAAJ,GAAQ,CAAV,IAAe,MAAM6O,MAAMlP,EAAEK,CAAF,CAAN,EAAYyF,EAAEzF,CAAF,CAAZ,EAAkBuF,EAAEvF,CAAF,CAAlB,CAArB;AACAD,YAAE,IAAIC,CAAJ,GAAQ,CAAV,IAAe,MAAMyO,MAAM9O,EAAEK,CAAF,CAAN,EAAYyF,EAAEzF,CAAF,CAAZ,EAAkBuF,EAAEvF,CAAF,CAAlB,CAArB;AACAD,YAAE,IAAIC,CAAJ,GAAQ,CAAV,IAAe,MAAMwO,MAAM7O,EAAEK,CAAF,CAAN,EAAYyF,EAAEzF,CAAF,CAAZ,EAAkBuF,EAAEvF,CAAF,CAAlB,CAArB;AACAD,YAAE,IAAIC,CAAJ,GAAQ,CAAV,IAAe,GAAf;AACD;;AACD,eAAO,IAAImF,OAAJ,CAAYpF,CAAZ,EAAesF,QAAQQ,KAAvB,EAA8BR,QAAQS,MAAtC,EAA8C,CAA9C,CAAP;AACD;;AAED,eAASyJ,iBAAT,CAA2BlK,OAA3B,EAAoC;AAClC,YAAIE,CAAJ,EAAOE,CAAP,EAAUzF,CAAV,EAAaoE,CAAb,EAAgBvE,CAAhB,EAAmBE,CAAnB,EAAsBJ,CAAtB,EAAyB4E,GAAzB;AACA1E,YAAIwF,QAAQQ,KAAR,GAAgBR,QAAQS,MAA5B;AACAnG,YAAI,IAAIsP,YAAJ,CAAiBpP,CAAjB,CAAJ;AACA4F,YAAI,IAAIwJ,YAAJ,CAAiBpP,CAAjB,CAAJ;AACA0F,YAAI,IAAI0J,YAAJ,CAAiBpP,CAAjB,CAAJ;AACAE,YAAI,IAAIkP,YAAJ,CAAiBpP,CAAjB,CAAJ;;AACA,aAAKG,IAAIoE,IAAI,CAAR,EAAWG,MAAM1E,CAAtB,EAAyB,KAAK0E,GAAL,GAAWH,IAAIG,GAAf,GAAqBH,IAAIG,GAAlD,EAAuDvE,IAAI,KAAKuE,GAAL,GAAW,EAAEH,CAAb,GAAiB,EAAEA,CAA9E,EAAiF;AAC/EzE,YAAEK,CAAF,IAAOqF,QAAQG,IAAR,CAAa,IAAIxF,CAAJ,GAAQ,CAArB,IAA0B,KAAjC;AACAyF,YAAEzF,CAAF,IAAOqF,QAAQG,IAAR,CAAa,IAAIxF,CAAJ,GAAQ,CAArB,IAA0B,KAAjC;AACAuF,YAAEvF,CAAF,IAAOqF,QAAQG,IAAR,CAAa,IAAIxF,CAAJ,GAAQ,CAArB,IAA0B,KAAjC;AACAD,YAAEC,CAAF,IAAO6O,MAAMlP,EAAEK,CAAF,CAAN,EAAYyF,EAAEzF,CAAF,CAAZ,EAAkBuF,EAAEvF,CAAF,CAAlB,CAAP;AACD;;AACD,eAAO,IAAImF,OAAJ,CAAYpF,CAAZ,EAAesF,QAAQQ,KAAvB,EAA8BR,QAAQS,MAAtC,EAA8C,CAA9C,CAAP;AACD;;AAED,eAAS0J,MAAT,CAAgBnK,OAAhB,EAAyB;AACvB,YAAI0C,GAAJ,EAASlB,CAAT,EAAYjH,CAAZ;AACAA,YAAI+F,EAAE,QAAF,EAAY,CAAZ,CAAJ;AACA/F,UAAEiG,KAAF,GAAUR,QAAQQ,KAAlB;AACAjG,UAAEkG,MAAF,GAAWT,QAAQS,MAAnB;AACAiC,cAAMnI,EAAEuI,UAAF,CAAa,IAAb,CAAN;AACAtB,YAAIkB,IAAI0H,YAAJ,CAAiB,CAAjB,EAAoB,CAApB,EAAuBpK,QAAQQ,KAA/B,EAAsCR,QAAQS,MAA9C,CAAJ;AACAT,gBAAQqK,eAAR,CAAwB7I,CAAxB;AACA,eAAOkB,IAAI8D,YAAJ,CAAiBhF,CAAjB,EAAoB,CAApB,EAAuB,CAAvB,CAAP;AACD;;AAED,eAASzD,QAAT,GAAoB;AAClB,YAAIuM,YAAYF,cAAhB;AACAD,eACE1K,UAAUM,QAAV,CAAmBmK,kBAAkBI,SAAlB,CAAnB,EAAiD,UAASxL,CAAT,EAAY;AAC3D,iBAAOmB,SAAS,CAACnB,IAAI,CAAL,IAAU,CAAnB,CAAP;AACD,SAFD,CADF;AAKA,eAAO,IAAP;AACD;;AAED4K,wBAAkB,yBAAChI,GAAD,EAAMD,GAAN,EAAc;AAC9B,YAAIvB,CAAJ,EAAOwC,GAAP,EAAYlB,CAAZ,EAAejH,CAAf,EAAkB6F,CAAlB,EAAqBzF,CAArB,EAAwB0F,CAAxB,EAA2BkK,CAA3B,EAA8BxL,CAA9B,EAAiCE,CAAjC,EAAoC3E,CAApC,EAAuC4E,GAAvC,EAA4CsL,IAA5C;AACAlK,UAAE,qBAAF,EAAyB,CAAzB,EAA4BmK,KAA5B,CAAkCC,OAAlC,GAA4C,cAA5C;AACAnQ,YAAI+F,EAAE,WAAF,EAAe,CAAf,CAAJ;AACAoC,cAAMnI,EAAEuI,UAAF,CAAa,IAAb,CAAN;AACAtB,YAAIkB,IAAI0H,YAAJ,CAAiB,CAAjB,EAAoB,CAApB,EAAuB7P,EAAEiG,KAAzB,EAAgCjG,EAAEkG,MAAlC,CAAJ;;AACA,aAAK9F,IAAIoE,IAAI,CAAR,EAAWG,MAAM3E,EAAEiG,KAAxB,EAA+B,KAAKtB,GAAL,GAAWH,IAAIG,GAAf,GAAqBH,IAAIG,GAAxD,EAA6DvE,IAAI,KAAKuE,GAAL,GAAW,EAAEH,CAAb,GAAiB,EAAEA,CAApF,EAAuF;AACrF,eAAKsB,IAAIpB,IAAI,CAAR,EAAWuL,OAAOjQ,EAAEkG,MAAzB,EAAiC,KAAK+J,IAAL,GAAYvL,IAAIuL,IAAhB,GAAuBvL,IAAIuL,IAA5D,EAAkEnK,IAAI,KAAKmK,IAAL,GAAY,EAAEvL,CAAd,GAAkB,EAAEA,CAA1F,EAA6F;AAAA,6BAC/EgB,SAAStF,IAAIJ,EAAEiG,KAAf,CAD+E;;AAAA;;AAC1FlG,aAD0F;AACvF8F,aADuF;AACpFF,aADoF;AAE3FqK,gBAAI,KAAK5P,IAAI0F,IAAI9F,EAAEiG,KAAf,CAAJ;AACAgB,cAAErB,IAAF,CAAOoK,IAAI,CAAX,IAAgBjQ,CAAhB;AACAkH,cAAErB,IAAF,CAAOoK,IAAI,CAAX,IAAgBnK,CAAhB;AACAoB,cAAErB,IAAF,CAAOoK,IAAI,CAAX,IAAgBrK,CAAhB;AACAsB,cAAErB,IAAF,CAAOoK,IAAI,CAAX,IAAgB,GAAhB;AACD;AACF;;AACD7H,YAAI8D,YAAJ,CAAiBhF,CAAjB,EAAoB,CAApB,EAAuB,CAAvB;AACAlB,UAAE,eAAF,EAAmB,CAAnB,EAAsBqK,WAAtB,GAAoCjJ,IAAIkJ,OAAJ,CAAY,CAAZ,CAApC;AACA,eAAOtK,EAAE,eAAF,EAAmB,CAAnB,EAAsBqK,WAAtB,GAAoClJ,IAAImJ,OAAJ,CAAY,CAAZ,CAA3C;AACD,OAnBD;;AAqBA,eAASC,MAAT,CAAgBtM,KAAhB,EAAuB;AACrB,YAAI2B,CAAJ,EAAOE,CAAP,EAAUqB,GAAV,EAAeC,GAAf,EAAoBoJ,UAApB,EAAgCC,SAAhC,EAA2CzQ,CAA3C,EAA8C0Q,aAA9C;AACA1K,UAAE,qBAAF,EAAyB,CAAzB,EAA4BmK,KAA5B,CAAkCC,OAAlC,GAA4C,MAA5C;;AACA,YAAIrN,SAAS,MAAb,EAAqB;AAAA,cAOV0N,UAPU,GAOnB,SAASA,UAAT,CAAmBjM,CAAnB,EAAsB;AACpB,mBAAO,CAACA,IAAI4C,GAAL,KAAaD,MAAMC,GAAnB,CAAP;AACD,WATkB;;AAAA,8BACP2H,aAAa9K,KAAb,CADO;;AAAA;;AAClBjE,WADkB;AACf8F,WADe;AACZF,WADY;AAEnB4K,uBAAavB,KAAKjP,CAAL,EAAQ4F,CAAR,CAAb,CAFmB,CAGnB;AACA;;AACAwB,gBAAM,CAAC,CAAP;AACAD,gBAAM,CAAN;AAGC;AACDuJ,0BAAgBvL,UAAUM,QAAV,CAAmB+K,UAAnB,EAA+B,UAAShM,CAAT,EAAY;AACzD,mBAAOmB,SAAS8K,WAAUjM,CAAV,CAAT,CAAP;AACD,WAFe,CAAhB;AAGA4K,0BAAgBhI,GAAhB,EAAqBD,GAArB;AACD,SAdD,MAcO,IAAIpE,SAAS,KAAb,EAAoB;AACzB2N,0BAAgB,IAAIlL,OAAJ,CAAYvB,MAAM4B,IAAlB,EAAwB5B,MAAMiC,KAA9B,EAAqCjC,MAAMkC,MAA3C,EAAmD,CAAnD,CAAhB;AACD,SAFM,MAEA,IAAIpD,SAAS,KAAb,EAAoB;AAAA,+BACbgM,aAAa9K,KAAb,CADa;;AAAA;;AACxBjE,WADwB;AACrB8F,WADqB;AAClBF,WADkB;AAEzB8K,0BAAgBvL,UAAUM,QAAV,CAAmBzF,CAAnB,EAAsB,UAASwE,CAAT,EAAY;AAChD,mBAAO,CAACA,CAAD,EAAIA,CAAJ,EAAOA,CAAP,CAAP;AACD,WAFe,CAAhB;AAGD,SALM,MAKA;AACLkM,0BAAgBhB,aAAazL,KAAb,CAAhB;AACD;;AACD,eAAO4L,OAAOa,aAAP,CAAP;AACD;;AAED,eAASC,gBAAT,CAA0B3Q,CAA1B,EAA6B8F,CAA7B,EAAgCF,CAAhC,EAAmC;AACjC,YAAI5F,MAAM,EAAV,EAAc;AACZA,cAAI,GAAJ;AACD;;AACD,YAAI8F,MAAM,EAAV,EAAc;AACZA,cAAI,GAAJ;AACD;;AACD,YAAIF,MAAM,EAAV,EAAc;AACZA,cAAI,GAAJ;AACD;;AACD4E,aAAK,oDAAoDxK,CAApD,GAAwD,IAA7D;AACAwK,aAAK,oDAAoD1E,CAApD,GAAwD,IAA7D;AACA,eAAO0E,KAAK,oDAAoD5E,CAApD,GAAwD,IAA7D,CAAP;AACD;;AAAA;;AAED,eAASgL,oBAAT,CAA8BlK,CAA9B,EAAiCC,CAAjC,EAAoCC,CAApC,EAAuC;AACrC,YAAIF,MAAM,EAAV,EAAc;AACZA,cAAI,GAAJ;AACD;;AACD,YAAIC,MAAM,EAAV,EAAc;AACZA,cAAI,GAAJ;AACD;;AACD,YAAIC,MAAM,EAAV,EAAc;AACZA,cAAI,GAAJ;AACD;;AACD4D,aAAK,8IAA8I9D,CAA9I,GAAkJ,GAAlJ,GAAwJC,CAAxJ,GAA4J,GAA5J,GAAkKC,CAAlK,GAAsK,QAA3K;AACA4D,aAAK,8IAA8I9D,CAA9I,GAAkJ,GAAlJ,GAAwJC,CAAxJ,GAA4J,GAA5J,GAAkKC,CAAlK,GAAsK,QAA3K;AACA,eAAO4D,KAAK,8IAA8I9D,CAA9I,GAAkJ,GAAlJ,GAAwJC,CAAxJ,GAA4J,GAA5J,GAAkKC,CAAlK,GAAsK,QAA3K,CAAP;AACD;;AAED,eAASkJ,YAAT,GAAwB;AACtB,YAAI1H,MAAMpC,EAAE,QAAF,EAAY,CAAZ,EAAewC,UAAf,CAA0B,IAA1B,CAAV,CADsB,CAE1B;;AACI,YAAItC,QAAQF,EAAE,QAAF,EAAYE,KAAZ,EAAZ;AACA,YAAIC,SAASH,EAAE,QAAF,EAAYG,MAAZ,EAAb,CAJsB,CAK1B;;AACI,eAAOlC,SAASmE,IAAI0H,YAAJ,CAAiB,CAAjB,EAAoB,CAApB,EAAuB5J,KAAvB,EAA8BC,MAA9B,CAAhB;AACD;;AAED,eAAS0K,UAAT,GAAsB;AACpB,YAAIb,YAAYF,cAAhB;AACA,eAAO,IAAItK,OAAJ,CAAYwK,UAAUnK,IAAtB,EAA4BmK,UAAU9J,KAAtC,EAA6C8J,UAAU7J,MAAvD,EAA+D,CAA/D,CAAP;AACD;;AAED,eAASgJ,QAAT,CAAkB2B,QAAlB,EAA4B;AAC1B/N,eAAO+N,QAAP;AACAP,eAAOT,cAAP;;AACA,YAAI/M,SAAS,MAAb,EAAqB;AACnB;AACA,iBAAOiD,EAAE,kBAAF,EAAsB,CAAtB,EAAyBmK,KAAzB,CAA+BC,OAA/B,GAAyC,cAAhD;AACD,SAHD,MAGO;AACL,cAAIpK,EAAE,kBAAF,EAAsBhF,MAAtB,GAA+B,CAAnC,EAAsC;AACpC,mBAAOgF,EAAE,kBAAF,EAAsB,CAAtB,EAAyBmK,KAAzB,CAA+BC,OAA/B,GAAyC,MAAhD;AACD;AACF;AACF,OAhN6C,CAkN9C;;;AACA,eAASvD,WAAT,CAAqB9E,GAArB,EAA0B;AACxB,YAAIK,GAAJ,EAASjC,MAAT,EAAiB4K,SAAjB,EAA4B7K,KAA5B;AACA6K,oBAAYzI,SAAS0C,cAAT,CAAwB,OAAxB,CAAZ;AACA5C,cAAM2I,UAAUvI,UAAV,CAAqB,IAArB,CAAN;AACAtC,gBAAQ6B,IAAIiJ,UAAJ,IAAkBjJ,IAAI7B,KAA9B;AACAC,iBAAS4B,IAAIkJ,WAAJ,IAAmBlJ,IAAI5B,MAAhC;AACAiC,YAAIK,SAAJ,CAAcV,GAAd,EAAmB,CAAnB,EAAsB,CAAtB,EAAyB7B,KAAzB,EAAgCC,MAAhC,EAAwC,CAAxC,EAA2C,CAA3C,EAA8C4K,UAAU7K,KAAxD,EAA+D6K,UAAU5K,MAAzE;AACAlC,gBAAQmE,IAAI0H,YAAJ,CAAiB,CAAjB,EAAoB,CAApB,EAAuBiB,UAAU7K,KAAjC,EAAwC6K,UAAU5K,MAAlD,CAAR;AACA,eAAOgJ,SAASpM,IAAT,CAAP;AACD;;AAED,eAASY,GAAT,CAAaZ,IAAb,EAAmB;AACjB,eAAOoM,SAASpM,IAAT,CAAP;AACD;;AAED,eAASqK,eAAT,GAA2B;AACzB,YAAIhF,GAAJ,EAASnI,CAAT;AACAA,YAAI+F,EAAE,QAAF,EAAY,CAAZ,CAAJ;AACAoC,cAAMnI,EAAEuI,UAAF,CAAa,IAAb,CAAN;AACA,eAAOJ,IAAID,MAAJ,CAAWQ,SAAX,CAAqB,YAArB,CAAP;AACD;;AAED,aAAO;AACLnF,cAAM,YADD;AAELmC,kBAAUA,QAFL;AAGLyH,yBAAiBA,eAHZ;AAIL0C,sBAAcA,YAJT;AAKLe,oBAAYA,UALP;AAMLjB,2BAAmBA,iBANd;AAOLF,sBAAcA,YAPT;AAQLG,gBAAQA,MARH;AASLlM,aAAKA,GATA;AAULgN,0BAAkBA,gBAVb;AAWLC,8BAAsBA,oBAXjB;AAYLL,gBAAQA,MAZH;AAaL1D,qBAAaA,WAbR;AAcLpJ,kBAAUA,QAdL;AAeLK,oBAAY,sBAAW,CAAE;AAfpB,OAAP;AAkBD,KA3PD;AA6PC,GApQQ,EAoQP;AAAC,0BAAqB,CAAtB;AAAwB,2BAAsB,CAA9C;AAAgD,0BAAqB;AAArE,GApQO,CAt2Bmc;AA0mChY,MAAG,CAAC,UAAStD,OAAT,EAAiBS,MAAjB,EAAwBH,OAAxB,EAAgC;AAChH;AACA;AACA;AACAG,WAAOH,OAAP,GAAiB,SAASoQ,cAAT,CAAwBxO,OAAxB,EAAiC;AAEhD,UAAIyO,aAAa,IAAjB;AAAA,UACIC,aAAa,IADjB;AAAA,UAEIC,UAFJ;AAAA,UAEgB;AACZC,iBAAW,CAAC,CAAC,GAAF,EAAO,CAAC,GAAR,EAAa,CAAC,GAAd,EAAmB,GAAnB,EAAwB,GAAxB,EAA6B,CAAC,GAA9B,EAAmC,GAAnC,EAAwC,GAAxC,CAHf;AAAA,UAIIC,uBAAuB,CAJ3B;AAAA,UAKIC,aAAahR,QAAQ,qBAAR,GALjB;AAAA,UAMIsC,YAAY,KANhB;AAAA,UAOI;AACA;AACA;AACA;AACA;AAEAuC,kBAAY;AACVoM,iBAAS,CADC;AAEVC,mBAAW,CAFD;AAGVC,cAAM;AAHI,OAbhB;AAAA,UAkBIhM,WAAWN,UAAUoM,OAlBzB;;AAoBAH,eAASM,QAAT,GAAoB,CAApB;;AAEA,eAAS9N,UAAT,CAAoBpB,OAApB,EAA6B;AAC/BY,gBAAQC,GAAR,CAAYb,OAAZ,EAAqB,OAArB;AACIA,kBAAUA,WAAW,EAArB;AACAA,gBAAQmP,cAAR,GAAyBnP,QAAQmP,cAAR,IAA0B,kBAAnD;AACAnP,gBAAQoP,cAAR,GAAyBpP,QAAQoP,cAAR,IAA0B,kBAAnD;;AACApP,gBAAQqP,qBAAR,GAAgCrP,QAAQqP,qBAAR,IAAiC,YAAW;AAAEzO,kBAAQC,GAAR,CAAY,gBAAZ;AAA+B,SAA7G;;AACA4N,qBAAaa,cAAc,KAAd,EAAqB,CAArB,EAAwB,CAAxB,EAA2B,GAA3B,EAAgC,OAAhC,CAAb;AACAZ,qBAAaY,cAAc,KAAd,EAAqB,CAArB,EAAwB,CAAxB,EAA2B,GAA3B,EAAgC,UAAhC,CAAb;AACAC;AACAV,+BAAuB,CAAvB;AACAvL,UAAE,YAAF,EAAgBkM,IAAhB,CAAqBxP,QAAQmP,cAA7B,EAA6CM,cAA7C;AACAnM,UAAE,qBAAF,EAAyBkM,IAAzB,CAA8BxP,QAAQoP,cAAtC,EAAsDK,cAAtD;;AACA,YAAIhB,cAAcC,UAAlB,EAA8B;AAC5B,iBAAO,IAAP;AACD,SAFD,MAEO;AACL,iBAAO,KAAP;AACD;AACF;;AAAA;;AAED,eAAS3N,QAAT,CAAkBuK,GAAlB,EAAuB;AACrB,YAAIA,QAAQ,KAAZ,EAAmBrK,IAAI,KAAJ,EAAnB,KACK;AACHqK,gBAAMA,OAAOrI,QAAb;AACAA,qBAAWqI,GAAX;AACA1K,kBAAQC,GAAR,CAAY,cAAcyK,GAA1B;AACA,cAAI,OAAOA,GAAP,KAAe,QAAnB,EAA6BA,MAAM3I,UAAU2I,GAAV,CAAN;AAC7BmD,qBAAWiB,WAAX,GAAyBhB,WAAWgB,WAAX,GAAyBpE,GAAlD;AACAlL,sBAAY,IAAZ;AACD;AACF;;AAED,eAASmP,UAAT,GAAsB;AACpBnP,oBAAY,KAAZ;AACD;;AAED,eAASuP,YAAT,CAAsBjK,GAAtB,EAA2BvC,IAA3B,EAAiC;AAC/B,YAAIyM,MAAJ,EAAYC,EAAZ;AACAA,aAAKnK,IAAImK,EAAT;AACAD,iBAASC,GAAGF,YAAH,EAAT;AACAE,WAAGC,UAAH,CAAcD,GAAGE,YAAjB,EAA+BH,MAA/B;AACAC,WAAGG,UAAH,CAAcH,GAAGE,YAAjB,EAA+B,IAAInD,YAAJ,CAAiBzJ,IAAjB,CAA/B,EAAuD0M,GAAGI,WAA1D;AACAL,eAAOV,QAAP,GAAkB/L,KAAK+L,QAAvB;AACA,eAAOU,MAAP;AACD;;AAAA;;AAED,eAASM,aAAT,CAAuBxK,GAAvB,EAA4ByK,WAA5B,EAAyC;AACvC,YAAIN,EAAJ,EAAQO,OAAR;AACAP,aAAKnK,IAAImK,EAAT;AACAO,kBAAUP,GAAGK,aAAH,EAAV;AACAL,WAAGQ,aAAH,CAAiBF,WAAjB;AACAN,WAAGS,WAAH,CAAeT,GAAGU,UAAlB,EAA8BH,OAA9B;AACAP,WAAGW,WAAH,CAAeX,GAAGY,mBAAlB,EAAuC,IAAvC;AACAZ,WAAGa,UAAH,CAAcb,GAAGU,UAAjB,EAA6B,CAA7B,EAAgCV,GAAGc,IAAnC,EAAyCjL,IAAID,MAAJ,CAAWjC,KAApD,EAA2DkC,IAAID,MAAJ,CAAWhC,MAAtE,EAA8E,CAA9E,EAAiFoM,GAAGc,IAApF,EAA0Fd,GAAGe,aAA7F,EAA4G,IAA5G;AACAf,WAAGgB,aAAH,CAAiBhB,GAAGU,UAApB,EAAgCV,GAAGiB,cAAnC,EAAmDjB,GAAGkB,aAAtD;AACAlB,WAAGgB,aAAH,CAAiBhB,GAAGU,UAApB,EAAgCV,GAAGmB,cAAnC,EAAmDnB,GAAGkB,aAAtD;AACAlB,WAAGgB,aAAH,CAAiBhB,GAAGU,UAApB,EAAgCV,GAAGoB,kBAAnC,EAAuDpB,GAAGqB,OAA1D;AACArB,WAAGgB,aAAH,CAAiBhB,GAAGU,UAApB,EAAgCV,GAAGsB,kBAAnC,EAAuDtB,GAAGqB,OAA1D;AACA,eAAOd,OAAP;AACD;;AAAA;;AAED,eAASd,aAAT,CAAuBjP,IAAvB,EAA6BqP,WAA7B,EAA0CzM,QAA1C,EAAoDmO,MAApD,EAA4DC,UAA5D,EAAwE;AACtE,YAAI3L,GAAJ;AACAA,cAAM,IAAIlG,MAAJ,EAAN;AACAkG,YAAIrF,IAAJ,GAAWA,IAAX;AACAqF,YAAI4L,UAAJ,GAAiB,CAAC,EAAD,EAAK,EAAL,EAAS,EAAT,CAAjB;AACA5L,YAAIgK,WAAJ,GAAkBA,WAAlB;AACAhK,YAAIzC,QAAJ,GAAeA,QAAf;AACAyC,YAAI0L,MAAJ,GAAaA,MAAb;AACA1L,YAAI6L,YAAJ,GAAmB,IAAnB;AACA7L,YAAID,MAAJ,GAAaG,SAAS0C,cAAT,CAAwB+I,UAAxB,CAAb;AACA3L,YAAID,MAAJ,CAAW+L,gBAAX,CAA4B,kBAA5B,EAAiD,UAAS9K,KAAT,EAAgB;AAC/D,iBAAOA,MAAM+K,cAAN,EAAP;AACD,SAFD,EAEI,KAFJ;AAGA/L,YAAID,MAAJ,CAAW+L,gBAAX,CAA4B,sBAA5B,EAAoDE,gBAApD,EAAsE,KAAtE;AACAhM,YAAImK,EAAJ,GAASf,WAAW6C,eAAX,CAA2BjM,IAAID,MAA/B,CAAT;;AACA,YAAIC,IAAImK,EAAR,EAAY;AACVnK,cAAImK,EAAJ,CAAO+B,YAAP,CAAoB,mBAApB;AACAlM,cAAImM,YAAJ,GAAmBlC,aAAajK,GAAb,EAAkBkJ,QAAlB,CAAnB;AACAlJ,cAAIoM,WAAJ,GAAkBpM,IAAImK,EAAJ,CAAOkC,iBAAP,EAAlB;AACArM,cAAIsM,YAAJ,GAAmB9B,cAAcxK,GAAd,EAAmBA,IAAImK,EAAJ,CAAOoC,QAA1B,CAAnB;AACA,iBAAOvM,GAAP;AACD,SAND,MAMO;AACL,iBAAO,IAAP;AACD;AACF;;AAAA;;AAED,eAASwM,SAAT,CAAmBxM,GAAnB,EAAwByM,WAAxB,EAAqC;AACnC,YAAItC,EAAJ,EAAQuC,SAAR,EAAmBC,WAAnB,EAAgCC,iBAAhC,EAAmDC,QAAnD,EAA6DC,mBAA7D,EAAkFC,cAAlF,EAAkGC,eAAlG;;AACA,YAAI,CAACP,WAAL,EAAkB;AAChBrT,iBAAO6T,qBAAP,CAA6B,YAAW;AACtC,mBAAOT,UAAUxM,GAAV,EAAe,KAAf,CAAP;AACD,WAFD;AAGD;;AACD,YAAIA,IAAI6L,YAAR,EAAsB;AACpB7L,cAAI6L,YAAJ,GAAmB,KAAnB;AACA7L,cAAIkN,aAAJ,GAAoBC,eAAenN,GAAf,CAApB;AACD;;AACDmK,aAAKnK,IAAImK,EAAT;AACAA,WAAGiD,QAAH,CAAY,CAAZ,EAAe,CAAf,EAAkBpN,IAAID,MAAJ,CAAWjC,KAA7B,EAAoCkC,IAAID,MAAJ,CAAWhC,MAA/C;AACAoM,WAAGkD,UAAH,CAAcrN,IAAIkN,aAAlB;AACA/C,WAAGC,UAAH,CAAcD,GAAGE,YAAjB,EAA+BrK,IAAImM,YAAnC;AACAa,0BAAkB7C,GAAGmD,iBAAH,CAAqBtN,IAAIkN,aAAzB,EAAwC,iBAAxC,CAAlB;AACA/C,WAAGoD,uBAAH,CAA2BP,eAA3B;AACA7C,WAAGqD,mBAAH,CAAuBR,eAAvB,EAAwChN,IAAImM,YAAJ,CAAiB3C,QAAzD,EAAmEW,GAAGsD,KAAtE,EAA6E,KAA7E,EAAoF,CAApF,EAAuF,CAAvF;AACAZ,mBAAW1C,GAAGuD,kBAAH,CAAsB1N,IAAIkN,aAA1B,EAAyC,UAAzC,CAAX;AACA/C,WAAGwD,SAAH,CAAad,QAAb,EAAuB,CAAvB;AACAE,yBAAiB5C,GAAGuD,kBAAH,CAAsB1N,IAAIkN,aAA1B,EAAyC,SAAzC,CAAjB;AACA/C,WAAGyD,SAAH,CAAab,cAAb,EAA6B/M,IAAI0L,MAAjC;AAEAkB,4BAAoBzC,GAAGuD,kBAAH,CAAsB1N,IAAIkN,aAA1B,EAAyC,YAAzC,CAApB;AACA/C,WAAGwD,SAAH,CAAaf,iBAAb,EAAiClS,aAAasF,IAAIzC,QAAjB,GAA4B,CAA5B,GAAgC,CAAjE;AAEAuP,8BAAsB3C,GAAGuD,kBAAH,CAAsB1N,IAAIkN,aAA1B,EAAyC,iBAAzC,CAAtB;AACA/C,WAAGwD,SAAH,CAAab,mBAAb,EAAkC9M,IAAIgK,WAAtC;AAEA2C,sBAAcxC,GAAGuD,kBAAH,CAAsB1N,IAAIkN,aAA1B,EAAyC,MAAzC,CAAd;AACA/C,WAAGwD,SAAH,CAAahB,WAAb,EAA2B3M,IAAIrF,IAAJ,KAAa,KAAb,GAAqB,CAArB,GAAyB,CAApD;AACA+R,oBAAYvC,GAAGuD,kBAAH,CAAsB1N,IAAIkN,aAA1B,EAAyC,WAAzC,CAAZ;AACA/C,WAAGwD,SAAH,CAAajB,SAAb,EAAyB1M,IAAIzC,QAAJ,GAAe,CAAf,GAAmB,CAA5C;AACA4M,WAAG0D,UAAH,CAAc1D,GAAG2D,cAAjB,EAAiC,CAAjC,EAAoC5E,SAAStQ,MAAT,GAAkBsQ,SAASM,QAA/D;AAEA,YAAIiD,WAAJ,EAAiB,OAAOzM,IAAID,MAAJ,CAAWQ,SAAX,CAAqB,YAArB,CAAP;AAClB;;AAAA;;AAED,eAAS4M,cAAT,CAAwBnN,GAAxB,EAA6B;AAC3B,YAAIxC,CAAJ,EAAOhF,IAAP,EAAakF,CAAb,EAAgB9F,CAAhB;;AAD2B,6CAEfoI,IAAI4L,UAFW;;AAE1BhU,SAF0B;AAEvB8F,SAFuB;AAEpBF,SAFoB;AAG3B;AACA5F,YAAIA,EAAEmW,WAAF,GAAgB3I,OAAhB,CAAwB,IAAxB,EAA8B,GAA9B,EAAmCA,OAAnC,CAA2C,IAA3C,EAAiD,GAAjD,EAAsDA,OAAtD,CAA8D,IAA9D,EAAoE,GAApE,CAAJ;AACA1H,YAAIA,EAAEqQ,WAAF,GAAgB3I,OAAhB,CAAwB,IAAxB,EAA8B,GAA9B,EAAmCA,OAAnC,CAA2C,IAA3C,EAAiD,GAAjD,EAAsDA,OAAtD,CAA8D,IAA9D,EAAoE,GAApE,CAAJ;AACA5H,YAAIA,EAAEuQ,WAAF,GAAgB3I,OAAhB,CAAwB,IAAxB,EAA8B,GAA9B,EAAmCA,OAAnC,CAA2C,IAA3C,EAAiD,GAAjD,EAAsDA,OAAtD,CAA8D,IAA9D,EAAoE,GAApE,CAAJ,CAN2B,CAO3B;;AACAxN,YAAIA,EAAEwN,OAAF,CAAU,4BAAV,EAAwC,EAAxC,CAAJ;AACA1H,YAAIA,EAAE0H,OAAF,CAAU,4BAAV,EAAwC,EAAxC,CAAJ;AACA5H,YAAIA,EAAE4H,OAAF,CAAU,4BAAV,EAAwC,EAAxC,CAAJ,CAV2B,CAW3B;;AACA,YAAI,CAACxN,EAAEoW,QAAF,CAAW,GAAX,CAAL,EAAsBpW,IAAIA,EAAEwN,OAAF,CAAU,kBAAV,EAA8B,QAA9B,CAAJ;AACtB,YAAI,CAAC1H,EAAEsQ,QAAF,CAAW,GAAX,CAAL,EAAsBtQ,IAAIA,EAAE0H,OAAF,CAAU,kBAAV,EAA8B,QAA9B,CAAJ;AACtB,YAAI,CAAC5H,EAAEwQ,QAAF,CAAW,GAAX,CAAL,EAAsBxQ,IAAIA,EAAE4H,OAAF,CAAU,kBAAV,EAA8B,QAA9B,CAAJ,CAdK,CAe3B;;AACA,YAAIpF,IAAIrF,IAAJ,KAAa,MAAjB,EAAyB;AACvB,cAAI/C,MAAM,EAAV,EAAc;AACZA,gBAAI,OAAOA,CAAP,GAAW,gBAAf;AACD;;AACD,cAAI8F,MAAM,EAAV,EAAc;AACZA,gBAAI,OAAOA,CAAP,GAAW,gBAAf;AACD;;AACD,cAAIF,MAAM,EAAV,EAAc;AACZA,gBAAI,OAAOA,CAAP,GAAW,gBAAf;AACD;AACF;;AACD,YAAI5F,MAAM,EAAV,EAAc;AACZA,cAAI,GAAJ;AACD;;AACD,YAAI8F,MAAM,EAAV,EAAc;AACZA,cAAI,GAAJ;AACD;;AACD,YAAIF,MAAM,EAAV,EAAc;AACZA,cAAI,GAAJ;AACD;;AACDhF,eAAOoF,EAAE,qBAAF,EAAyBoE,IAAzB,EAAP;AACAxJ,eAAOA,KAAK4M,OAAL,CAAa,MAAb,EAAqBxN,CAArB,CAAP;AACAY,eAAOA,KAAK4M,OAAL,CAAa,MAAb,EAAqB1H,CAArB,CAAP;AACAlF,eAAOA,KAAK4M,OAAL,CAAa,MAAb,EAAqB5H,CAArB,CAAP;AACAI,UAAE,YAAF,EAAgBoE,IAAhB,CAAqBxJ,IAArB;AACA,eAAO4Q,WAAW6E,wBAAX,CAAoCjO,IAAImK,EAAxC,EAA4C,CAAC,WAAD,EAAc,WAAd,CAA5C,CAAP;AACD;;AAAA;;AAED,eAAS+D,OAAT,CAAiBlO,GAAjB,EAAsBmO,OAAtB,EAA+B;AAC7B,YAAInO,IAAIrF,IAAJ,IAAYwT,OAAhB,EAAyBnO,IAAI6L,YAAJ,GAAmB,IAAnB;AACzB7L,YAAIrF,IAAJ,GAAWwT,OAAX;AACD;;AAAA;;AAED,eAASpE,cAAT,GAA0B;AACxBZ,gCAAwB,CAAxB;;AACA,YAAI,CAACA,oBAAL,EAA2B;AACzB7O,kBAAQqP,qBAAR;AACA6C,oBAAUzD,UAAV;AACA,iBAAOyD,UAAUxD,UAAV,CAAP;AACD;AACF;;AAAA;;AAED,eAASgD,gBAAT,GAA4B;AAC1B,YAAIpE,SAAJ;AACAA,oBAAYmB,WAAWnB,SAAvB;AACAmB,qBAAaa,cAAcb,WAAWpO,IAAzB,EAA+BoO,WAAWiB,WAA1C,EAAuDjB,WAAWxL,QAAlE,EAA4EwL,WAAW2C,MAAvF,EAA+F,OAA/F,CAAb;AACA1C,qBAAaY,cAAcZ,WAAWrO,IAAzB,EAA+BqO,WAAWgB,WAA1C,EAAuDhB,WAAWzL,QAAlE,EAA4EyL,WAAW0C,MAAvF,EAA+F,UAA/F,CAAb;;AACA,YAAI3C,cAAcC,UAAlB,EAA8B;AAC5B,iBAAOvE,YAAYmD,SAAZ,CAAP;AACD;AACF;;AAAA;;AAED,eAASnD,WAAT,CAAqB9E,GAArB,EAA0B;AACxB,YAAIwK,EAAJ;AACAA,aAAKpB,WAAWoB,EAAhB;AACAlB,qBAAatJ,GAAb;AACAoJ,mBAAWnB,SAAX,GAAuBjI,GAAvB;AACAwK,WAAGQ,aAAH,CAAiBR,GAAGoC,QAApB;AACA,eAAOpC,GAAGa,UAAH,CAAcb,GAAGU,UAAjB,EAA6B,CAA7B,EAAgCV,GAAGc,IAAnC,EAAyCd,GAAGc,IAA5C,EAAkDd,GAAGe,aAArD,EAAoEvL,GAApE,CAAP;AACD;;AAAA;;AAED,eAASyO,aAAT,GAAyB;AACvB,iBAASC,aAAT,CAAuB1O,GAAvB,EAA4B;AAC1B,cAAII,SAASG,SAASC,aAAT,CAAuB,QAAvB,CAAb;AACA,cAAMH,MAAMD,OAAOK,UAAP,CAAkB,IAAlB,CAAZ;AACAL,iBAAOhC,MAAP,GAAgB4B,IAAI5B,MAApB;AACAgC,iBAAOjC,KAAP,GAAe6B,IAAI7B,KAAnB;AACAkC,cAAIK,SAAJ,CAAcV,GAAd,EAAmB,CAAnB,EAAsB,CAAtB;AACA,cAAM2O,UAAUvO,OAAOQ,SAAP,CAAiB,mBAAjB,CAAhB;AACAR,mBAAS,IAAT;AACA,iBAAOuO,OAAP;AACD;;AACD,eAAOD,cAAcpF,UAAd,CAAP;AACD;;AAAA;;AAED,eAASjE,eAAT,GAA2B;AACzB,eAAOwH,UAAUzD,UAAV,EAAsB,IAAtB,CAAP;AACD;;AAAA;;AAED,eAASrB,YAAT,GAAwB;AACtB,eAAOqB,WAAWnB,SAAlB;AACD;;AAAA;;AAED,eAAS2G,cAAT,CAAwBjW,CAAxB,EAA2BkF,CAA3B,EAA8BrF,CAA9B,EAAiC;AAC/B,eAAO4Q,WAAW6C,UAAX,GAAwB,CAACtT,CAAD,EAAIkF,CAAJ,EAAOrF,CAAP,CAA/B;AACD;;AAAA;;AAED,eAASoD,GAAT,CAAaZ,IAAb,EAAmB;AACjB,eAAOuT,QAAQnF,UAAR,EAAoBpO,IAApB,CAAP;AACD;;AAAA;AAEDe,iBAAWpB,OAAX;AAEA,aAAO;AACLc,cAAM,OADD;AAELM,oBAAYA,UAFP;AAGL0S,uBAAeA,aAHV;AAILpJ,yBAAiBA,eAJZ;AAKL0C,sBAAcA,YALT;AAMLnM,aAAKA,GANA;AAOLgN,0BAAkBgG,cAPb;AAQLL,iBAASA,OARJ;AASLzJ,qBAAaA,WATR;AAULoF,oBAAYA,UAVP;AAWLxO,kBAAUA,QAXL;AAYL2I,iBAAS+E;AAZJ,OAAP;AAeD,KAhRD;AAkRC,GAtR8E,EAsR7E;AAAC,2BAAsB;AAAvB,GAtR6E,CA1mC6X;AAg4C9a,MAAG,CAAC,UAAS3Q,OAAT,EAAiBS,MAAjB,EAAwBH,OAAxB,EAAgC;AAClEG,WAAOH,OAAP,GAAiB,SAAS8V,QAAT,CAAkBlU,OAAlB,EAA2BmU,wBAA3B,EAAqD;AAEpE;AACA7Q,QAAE,mBAAF,EAAuB8Q,MAAvB,CAA8B,YAAW;AACvCxT,gBAAQC,GAAR,CAAY,UAAZ;AACAb,gBAAQK,IAAR,GAAe,kBAAf;AACAL,gBAAQU,MAAR,CAAesL,OAAf;AACAmI;AACAnU,gBAAQiB,GAAR,CAAYjB,QAAQK,IAApB;AACAL,gBAAQiB,GAAR;AACA,eAAO,IAAP;AACD,OARD;AAUAqC,QAAE,eAAF,EAAmB8Q,MAAnB,CAA0B,YAAW;AACnCxT,gBAAQC,GAAR,CAAY,mBAAZ;AACAb,gBAAQK,IAAR,GAAe,cAAf;AACAL,gBAAQU,MAAR,CAAeuL,OAAf;AACAkI;AACAnU,gBAAQiB,GAAR,CAAYjB,QAAQK,IAApB;AACAL,gBAAQiB,GAAR;AACA,eAAO,IAAP;AACD,OARD;AAUAqC,QAAE,oBAAF,EAAwB8Q,MAAxB,CAA+B,YAAW;AACxCxT,gBAAQC,GAAR,CAAY,wBAAZ;AACAb,gBAAQK,IAAR,GAAe,mBAAf;AACAL,gBAAQU,MAAR,CAAeoL,QAAf;AACAqI;AACAnU,gBAAQiB,GAAR,CAAYjB,QAAQK,IAApB;AACAL,gBAAQiB,GAAR;AACA,eAAO,IAAP;AACD,OARD;AAUD,KAjCD;AAmCC,GApCgC,EAoC/B,EApC+B,CAh4C2a;AAo6Ctc,MAAG,CAAC,UAASnD,OAAT,EAAiBS,MAAjB,EAAwBH,OAAxB,EAAgC;AAC1CG,WAAOH,OAAP,GAAiB,SAASiW,QAAT,CAAkBrU,OAAlB,EAA2B;AAE1CsD,QAAE,eAAF,EAAmBmI,KAAnB,CAAyB,YAAW;AAClC,YAAIzL,QAAQI,SAAZ,EAAuB;AACrBmP;AACAvP,kBAAQiB,GAAR,CAAYjB,QAAQK,IAApB;AACA,iBAAOL,QAAQE,SAAR,CAAkBqP,UAAlB,EAAP;AACD,SAJD,MAIO;AACLxO;AACAf,kBAAQiB,GAAR,CAAYjB,QAAQK,IAApB;AACA,iBAAOL,QAAQe,QAAR,EAAP;AACD;AACF,OAVD;AAYAuC,QAAE,mBAAF,EAAuBmI,KAAvB,CAA6B,YAAW;AACtC7K,gBAAQC,GAAR,CAAY,kBAAZ;AACAE;AACAf,gBAAQe,QAAR,CAAiB,SAAjB;AACAf,gBAAQiB,GAAR,CAAYjB,QAAQK,IAApB;AACA,eAAOiD,EAAE,eAAF,EAAmBC,QAAnB,CAA4B,QAA5B,CAAP;AACD,OAND;AAQAD,QAAE,qBAAF,EAAyBmI,KAAzB,CAA+B,YAAW;AACxC7K,gBAAQC,GAAR,CAAY,oBAAZ;AACAE;AACAf,gBAAQe,QAAR,CAAiB,WAAjB;AACAf,gBAAQiB,GAAR,CAAYjB,QAAQK,IAApB;AACA,eAAOiD,EAAE,eAAF,EAAmBC,QAAnB,CAA4B,QAA5B,CAAP;AACD,OAND,EAtB0C,CA8B1C;;AACA,eAASxC,QAAT,GAAoB;AAClBH,gBAAQC,GAAR,CAAY,cAAZ;AACAb,gBAAQI,SAAR,GAAoB,IAApB;AACAkD,UAAE,eAAF,EAAmBC,QAAnB,CAA4B,QAA5B;AACAD,UAAE,qBAAF,EAAyBgR,GAAzB,CAA6B,SAA7B,EAAwC,cAAxC;AACAhR,UAAE,kBAAF,EAAsBgR,GAAtB,CAA0B,SAA1B,EAAqC,cAArC;AACD;;AAED,eAAS/E,UAAT,GAAsB;AACpB3O,gBAAQC,GAAR,CAAY,eAAZ;AACAb,gBAAQI,SAAR,GAAoB,KAApB;AACAkD,UAAE,eAAF,EAAmB2J,WAAnB,CAA+B,QAA/B;AACA3J,UAAE,qBAAF,EAAyBgR,GAAzB,CAA6B,SAA7B,EAAwC,MAAxC;AACAhR,UAAE,kBAAF,EAAsBgR,GAAtB,CAA0B,SAA1B,EAAqC,MAArC;AACD;AAEF,KA/CD;AAiDC,GAlDQ,EAkDP,EAlDO,CAp6Cmc;AAs9Ctc,MAAG,CAAC,UAASxW,OAAT,EAAiBS,MAAjB,EAAwBH,OAAxB,EAAgC;AAC1CG,WAAOH,OAAP,GAAiB,SAASmW,UAAT,CAAoBvU,OAApB,EAA6B;AAC1C,UAAIwU,aAAa,KAAjB;AAEAlR,QAAE,aAAF,EAAiBmI,KAAjB,CAAuB,YAAW;AAChC,YAAI+I,UAAJ,EAAgB;AACdlR,YAAE,QAAF,EAAYgR,GAAZ,CAAgB,SAAhB,EAA2B,QAA3B;AACAhR,YAAE,QAAF,EAAYgR,GAAZ,CAAgB,UAAhB,EAA4B,UAA5B;AACAhR,YAAE,QAAF,EAAYgR,GAAZ,CAAgB,QAAhB,EAA0B,MAA1B;AACAhR,YAAE,QAAF,EAAYgR,GAAZ,CAAgB,MAAhB,EAAwB,CAAxB;AACAhR,YAAE,WAAF,EAAe8G,IAAf;AACA9G,YAAE,iBAAF,EAAqBiF,IAArB;AACAiM,uBAAa,KAAb;AACD,SARD,MAQO;AACLlR,YAAE,QAAF,EAAYgR,GAAZ,CAAgB,SAAhB,EAA2B,OAA3B;AACAhR,YAAE,QAAF,EAAYgR,GAAZ,CAAgB,QAAhB,EAA0B,MAA1B;AACAhR,YAAE,QAAF,EAAYgR,GAAZ,CAAgB,OAAhB,EAAyB,MAAzB;AACAhR,YAAE,QAAF,EAAYgR,GAAZ,CAAgB,UAAhB,EAA4B,UAA5B;AACAhR,YAAE,QAAF,EAAYgR,GAAZ,CAAgB,KAAhB,EAAuB,KAAvB;AACAhR,YAAE,QAAF,EAAYgR,GAAZ,CAAgB,MAAhB,EAAwB/K,SAAS,CAACzK,OAAO2V,UAAP,GAAoBnR,EAAE,QAAF,EAAYE,KAAZ,EAArB,IAA4C,CAArD,IAA0D,IAAlF;AACAF,YAAE,QAAF,EAAYgR,GAAZ,CAAgB,SAAhB,EAA2B,GAA3B;AACAhR,YAAE,WAAF,EAAeiF,IAAf;AACAjF,YAAE,iBAAF,EAAqB8G,IAArB;AACAoK,uBAAa,IAAb;AACD;;AACD,eAAOA,UAAP;AACD,OAtBD;AAwBH,KA3BD;AA6BC,GA9BQ,EA8BP,EA9BO,CAt9Cmc;AAo/Ctc,MAAG,CAAC,UAAS1W,OAAT,EAAiBS,MAAjB,EAAwBH,OAAxB,EAAgC;AAC1CG,WAAOH,OAAP,GAAiB,SAASuC,SAAT,CAAmBX,OAAnB,EAA4B;AAE3CA,cAAQ0U,aAAR,GAAwB1U,QAAQ0U,aAAR,IAAyB,kBAAjD;AACA1U,cAAQ2U,YAAR,GAAuB3U,QAAQ2U,YAAR,IAAwB,WAA/C;;AAEA,UAAInW,UAAUV,QAAQ,SAAR,GAAd;;AACA,UAAI6G,aAAa7G,QAAQ,gBAAR,CAAjB;;AACA,UAAI4C,SAASV,QAAQU,MAArB;;AACA,UAAI+B,YAAY3E,QAAQ,oBAAR,CAAhB;;AACA,UAAIyW,UAAJ,EAAgBK,OAAhB,EAAyBV,QAAzB,EAAmCG,QAAnC,EAA6CQ,MAA7C,CAT2C,CAW3C;;AAEA,eAASV,wBAAT,GAAoC;AAClCnU,gBAAQK,IAAR,GAAeiD,EAAE,eAAF,EAAmBgI,GAAnB,EAAf;AACA,eAAOI,8BAA8B;AACnC,eAAKpI,EAAE,QAAF,EAAYgI,GAAZ,EAD8B;AAEnC,eAAKhI,EAAE,QAAF,EAAYgI,GAAZ,EAF8B;AAGnC,eAAKhI,EAAE,QAAF,EAAYgI,GAAZ,EAH8B;AAInC,eAAKhI,EAAE,QAAF,EAAYgI,GAAZ,EAJ8B;AAKnC,eAAKhI,EAAE,QAAF,EAAYgI,GAAZ,EAL8B;AAMnC,eAAKhI,EAAE,QAAF,EAAYgI,GAAZ,EAN8B;AAOnC,eAAKhI,EAAE,QAAF,EAAYgI,GAAZ;AAP8B,SAA9B,CAAP;AASD;;AAED,eAASI,6BAAT,CAAuCoJ,IAAvC,EAA6C;AAC3ClU,gBAAQC,GAAR,CAAYiU,IAAZ;;AACA,YAAI9U,QAAQK,IAAR,KAAiB,cAArB,EAAqC;AACnCL,kBAAQE,SAAR,CAAkB+N,gBAAlB,CAAmC6G,KAAK,GAAL,CAAnC,EAA8CA,KAAK,GAAL,CAA9C,EAAyDA,KAAK,GAAL,CAAzD;AACD,SAFD,MAEO,IAAI9U,QAAQK,IAAR,KAAiB,mBAArB,EAA0C;AAC/CL,kBAAQE,SAAR,CAAkB+N,gBAAlB,CAAmC6G,KAAK,GAAL,CAAnC,EAA8CA,KAAK,GAAL,CAA9C,EAAyDA,KAAK,GAAL,CAAzD;AACD,SAFM,MAEA,IAAI9U,QAAQK,IAAR,KAAiB,kBAArB,EAAyC;AAC9C,iBAAOL,QAAQE,SAAR,CAAkBgO,oBAAlB,CAAuC4G,KAAK,GAAL,CAAvC,EAAkDA,KAAK,GAAL,CAAlD,EAA6DA,KAAK,GAAL,CAA7D,CAAP;AACD;AACF;;AAEDxR,QAAEsC,QAAF,EAAYmP,KAAZ,CAAkB,YAAW;AAE3BR,qBAAazW,QAAQ,cAAR,EAAwBkC,OAAxB,CAAb;AACA4U,kBAAU9W,QAAQ,eAAR,EAAyBkC,OAAzB,EAAkCmU,wBAAlC,CAAV;AACAD,mBAAWpW,QAAQ,gBAAR,EAA0BkC,OAA1B,EAAmCmU,wBAAnC,CAAX;AACAE,mBAAWvW,QAAQ,gBAAR,EAA0BkC,OAA1B,CAAX;AACA6U,iBAAS/W,QAAQ,cAAR,EAAwBkC,OAAxB,CAAT;AAEA,YAAIA,QAAQgV,UAAZ,EAAwBrQ,WAAWvD,UAAX,CAAsB;AAAEwD,kBAAQ5E,QAAQgV;AAAlB,SAAtB;AAExB1R,UAAEtD,QAAQ0U,aAAV,EAAyBK,KAAzB,CAA+B,YAAW;AAExC,cAAI5P,GAAJ;AAAA,cAAS8P,YAAY;AACnB,sBAAU,GADS;AAEnB,sBAAU,GAFS;AAGnB,sBAAU,GAHS;AAInB,sBAAU,GAJS;AAKnB,sBAAU,GALS;AAMnB,sBAAU,GANS;AAOnB,sBAAU;AAPS,WAArB;AAUA3R,YAAE,iBAAF,EAAqBgI,GAArB,CAAyB4J,aAAaC,OAAb,CAAqB,aAArB,CAAzB,EAZwC,CAcxC;AACA;;AACAhQ,gBAAM3G,QAAQC,mBAAR,CAA4B,KAA5B,CAAN;;AACA,cAAI0G,GAAJ,EAAS;AACPxG,qBAASyW,iBAAiBrW,SAASsW,MAAT,CAAgBpW,KAAhB,CAAsB,GAAtB,EAA2B,CAA3B,CAAjB,CAAT;AACAe,oBAAQK,IAAR,GAAe1B,OAAO,MAAP,CAAf;AACA2W,wBAAYnQ,GAAZ;AACD;;AACD,iBAAO,IAAP;AACD,SAvBD;AAyBA7B,UAAEtD,QAAQ2U,YAAV,EAAwBpJ,MAAxB,CAA+B,YAAW;AACxCjI,YAAE,gBAAF,EAAoB8G,IAApB;AACA9G,YAAE,iBAAF,EAAqBiF,IAArB;AACAjF,YAAE,YAAF,EAAgBiF,IAAhB;AACA5D,qBAAWwB,QAAX,CAAoB,KAAKC,KAAzB,EAAgCpG,QAAQE,SAAR,CAAkBiK,WAAlD,EAA+DnK,QAAQgV,UAAvE;AACA1R,YAAE,eAAF,EAAmBiS,KAAnB,CAAyB,MAAzB;AACA,iBAAO,IAAP;AACD,SAPD;AASAjS,UAAE,kBAAF,EAAsBmI,KAAtB,CAA4B,YAAW;AACrCnI,YAAE,gBAAF,EAAoB8G,IAApB;AACA9G,YAAE,iBAAF,EAAqBiF,IAArB;AACAjF,YAAE,YAAF,EAAgBiF,IAAhB;AACA4L;AACAnU,kBAAQmB,KAAR;AACAmC,YAAE,eAAF,EAAmBiS,KAAnB,CAAyB,MAAzB;AACA,iBAAO,IAAP;AACD,SARD;AAUAjS,UAAE,WAAF,EAAemI,KAAf,CAAqB,YAAW;AAC9BzL,kBAAQG,MAAR,CAAeqB,WAAf;AACA,iBAAO,IAAP;AACD,SAHD;AAKA8B,UAAE,eAAF,EAAmBiI,MAAnB,CAA0B,YAAW;AACnCjI,YAAE,sDAAF,EAA0D8G,IAA1D;AACA9G,YAAE,MAAMA,EAAE,eAAF,EAAmBgI,GAAnB,EAAR,EAAkCgJ,GAAlC,CAAsC,SAAtC,EAAiD,QAAjD;AACA,iBAAO,IAAP;AACD,SAJD;AAMAhR,UAAE,cAAF,EAAkBmI,KAAlB,CAAwB,YAAW;AACjCnI,YAAE,oBAAF,EAAwBkS,MAAxB;AACAlS,YAAE,cAAF,EAAkBmS,WAAlB,CAA8B,aAA9B;AACD,SAHD;AAKAnS,UAAE,iBAAF,EAAqBiE,EAArB,CAAwB,OAAxB,EAAiC,YAAW;AAC1C,cAAImO,QAAQ,EAAZ;AAAA,cACIC,QAAQ,OAAK,IADjB,CAD0C,CAEnB;;AACvBrS,YAAE,cAAF,EAAkBE,KAAlB,CAAwBF,EAAE,iBAAF,EAAqBgI,GAArB,KAA6BoK,KAArD;AACApS,YAAE,cAAF,EAAkBG,MAAlB,CAAyBH,EAAE,iBAAF,EAAqBgI,GAArB,KAA6BoK,KAA7B,GAAqCC,KAA9D,EAJ0C,CAI4B;AACvE,SALD;AAOArS,UAAE,mBAAF,EAAuBmI,KAAvB,CAA6B,YAAW;AACtCyJ,uBAAaU,OAAb,CAAqB,aAArB,EAAoCtS,EAAE,iBAAF,EAAqBgI,GAArB,EAApC;AACAhI,YAAE,oBAAF,EAAwBiF,IAAxB,GAA+BsN,KAA/B,CAAqC,IAArC,EAA2CC,OAA3C;AACD,SAHD;AAKAxS,UAAE,eAAF,EAAmByS,OAAnB;AACAzS,UAAE,eAAF,EAAmB0S,OAAnB;AACA,eAAO,IAAP;AACD,OArFD;AAsFD,KA3HD;AA6HC,GA9HQ,EA8HP;AAAC,0BAAqB,CAAtB;AAAwB,sBAAiB,CAAzC;AAA2C,sBAAiB,EAA5D;AAA+D,sBAAiB,EAAhF;AAAmF,qBAAgB,EAAnG;AAAsG,oBAAe,EAArH;AAAwH,oBAAe,EAAvI;AAA0I,eAAU;AAApJ,GA9HO,CAp/Cmc;AAknDlT,MAAG,CAAC,UAASlY,OAAT,EAAiBS,MAAjB,EAAwBH,OAAxB,EAAgC;AAC9LG,WAAOH,OAAP,GAAiB,SAASwW,OAAT,CAAiB5U,OAAjB,EAA0BmU,wBAA1B,EAAoD;AAEnE;AACA7Q,QAAE,aAAF,EAAiBmI,KAAjB,CAAuB,YAAW;AAChCnI,UAAE,eAAF,EAAmBgI,GAAnB,CAAuB,cAAvB,EAAuCC,MAAvC;AACAjI,UAAE,QAAF,EAAYgI,GAAZ,CAAgB,GAAhB;AACAhI,UAAE,QAAF,EAAYgI,GAAZ,CAAgB,GAAhB;AACAhI,UAAE,QAAF,EAAYgI,GAAZ,CAAgB,GAAhB;AACAhI,UAAE,eAAF,EAAmBiS,KAAnB,CAAyB,MAAzB;AACAvV,gBAAQI,SAAR,GAAoB,KAApB;AACAJ,gBAAQE,SAAR,CAAkBqP,UAAlB;AACA4E;AACA5E;AACA,eAAOvP,QAAQiB,GAAR,CAAYjB,QAAQK,IAApB,CAAP;AACD,OAXD,EAHmE,CAgBnE;;AACAiD,QAAE,mBAAF,EAAuBmI,KAAvB,CAA6B,YAAW;AACtCnI,UAAE,eAAF,EAAmBgI,GAAnB,CAAuB,mBAAvB,EAA4CC,MAA5C;AACAjI,UAAE,QAAF,EAAYgI,GAAZ,CAAgB,aAAhB;AACAhI,UAAE,eAAF,EAAmBiS,KAAnB,CAAyB,MAAzB;AACAvV,gBAAQI,SAAR,GAAoB,KAApB;AACAJ,gBAAQE,SAAR,CAAkBqP,UAAlB;AACA4E;AACA5E;AACA,eAAOvP,QAAQiB,GAAR,CAAYjB,QAAQK,IAApB,CAAP;AACD,OATD,EAjBmE,CA4BnE;;AACAiD,QAAE,yBAAF,EAA6BmI,KAA7B,CAAmC,YAAW;AAC5CnI,UAAE,eAAF,EAAmBgI,GAAnB,CAAuB,mBAAvB,EAA4CC,MAA5C;AACAjI,UAAE,QAAF,EAAYgI,GAAZ,CAAgB,aAAhB;AACAhI,UAAE,eAAF,EAAmBiS,KAAnB,CAAyB,MAAzB;AACApB;AACAnU,gBAAQI,SAAR,GAAoB,IAApB;AACAJ,gBAAQiB,GAAR,CAAYjB,QAAQK,IAApB;AACAL,gBAAQe,QAAR;AACAA;AACA,eAAOf,QAAQiB,GAAR,EAAP;AACD,OAVD,EA7BmE,CAyCnE;;AACAqC,QAAE,kBAAF,EAAsBmI,KAAtB,CAA4B,YAAW;AACrCnI,UAAE,eAAF,EAAmBgI,GAAnB,CAAuB,mBAAvB,EAA4CC,MAA5C;AACAjI,UAAE,QAAF,EAAYgI,GAAZ,CAAgB,aAAhB;AACAhI,UAAE,eAAF,EAAmBiS,KAAnB,CAAyB,MAAzB;AACAvV,gBAAQI,SAAR,GAAoB,KAApB;AACAJ,gBAAQE,SAAR,CAAkBqP,UAAlB;AACA4E;AACA5E;AACA,eAAOvP,QAAQiB,GAAR,CAAYjB,QAAQK,IAApB,CAAP;AACD,OATD,EA1CmE,CAqDnE;;AACAiD,QAAE,wBAAF,EAA4BmI,KAA5B,CAAkC,YAAW;AAC3CnI,UAAE,eAAF,EAAmBgI,GAAnB,CAAuB,mBAAvB,EAA4CC,MAA5C;AACAjI,UAAE,QAAF,EAAYgI,GAAZ,CAAgB,aAAhB;AACAhI,UAAE,eAAF,EAAmBiS,KAAnB,CAAyB,MAAzB;AACApB;AACApT;AACAf,gBAAQiB,GAAR,CAAYjB,QAAQK,IAApB;AACAL,gBAAQe,QAAR;AACA,eAAOf,QAAQiB,GAAR,EAAP;AACD,OATD;;AAWA,eAASF,QAAT,GAAoB;AAClBH,gBAAQC,GAAR,CAAY,cAAZ;AACAb,gBAAQI,SAAR,GAAoB,IAApB;AACAkD,UAAE,eAAF,EAAmBC,QAAnB,CAA4B,QAA5B;AACAD,UAAE,qBAAF,EAAyBgR,GAAzB,CAA6B,SAA7B,EAAwC,cAAxC;AACAhR,UAAE,kBAAF,EAAsBgR,GAAtB,CAA0B,SAA1B,EAAqC,cAArC;AACD;;AAED,eAAS/E,UAAT,GAAsB;AACpB3O,gBAAQC,GAAR,CAAY,eAAZ;AACAb,gBAAQI,SAAR,GAAoB,KAApB;AACAkD,UAAE,eAAF,EAAmB2J,WAAnB,CAA+B,QAA/B;AACA3J,UAAE,qBAAF,EAAyBgR,GAAzB,CAA6B,SAA7B,EAAwC,MAAxC;AACAhR,UAAE,kBAAF,EAAsBgR,GAAtB,CAA0B,SAA1B,EAAqC,MAArC;AACD;AAEF,KAjFD;AAmFC,GApF4J,EAoF3J,EApF2J,CAlnD+S;AAssDtc,MAAG,CAAC,UAASxW,OAAT,EAAiBS,MAAjB,EAAwBH,OAAxB,EAAgC;AAC1CG,WAAOH,OAAP,GAAiB,SAASyW,MAAT,CAAgB7U,OAAhB,EAAyB;AAExC;AAEAsD,QAAE,WAAF,EAAemI,KAAf,CAAqB,YAAW;AAC9B/J;AACA,eAAO,IAAP;AACD,OAHD,EAJwC,CASxC;;AACA4B,QAAE,OAAF,EAAWmI,KAAX,CAAiBwK,SAAjB;;AAEA,eAASA,SAAT,GAAqB;AACnB,YAAI5Q,GAAJ;;AACA,iBAAS6Q,aAAT,GAAyB;AACvB7Q,gBAAMrF,QAAQE,SAAR,CAAkBwK,eAAlB,EAAN;AACA,iBAAO/F,WAAWO,eAAX,CAA2BG,GAA3B,EAAgC,YAAW;AAChD/B,cAAE,gBAAF,EAAoBgI,GAApB,CAAwB3G,WAAWI,WAAX,EAAxB;AACAzB,cAAE,WAAF,EAAegI,GAAf,CAAmB6K,KAAKC,SAAL,CAAe1V,OAAOG,GAAtB,CAAnB;AACA,mBAAOyC,EAAE,YAAF,EAAgB8Q,MAAhB,EAAP;AACD,WAJM,CAAP;AAKD;;AAAA;AACD9Q,UAAE,OAAF,EAAWiD,IAAX,CAAgB,UAAhB,EAA4B,IAA5B;AACAjD,UAAE,OAAF,EAAWoE,IAAX,CAAgB,WAAhB;;AACA,YAAI/C,WAAWI,WAAX,OAA6B,EAAjC,EAAqC;AACnCM,gBAAMrF,QAAQE,SAAR,CAAkBwK,eAAlB,EAAN;AACA/F,qBAAWqC,UAAX,CAAsB,QAAtB,EAAgC3B,GAAhC,EAAqC6Q,aAArC;AACD,SAHD,MAGO,IAAIvR,WAAWG,gBAAX,OAAkC,KAAtC,EAA6C;AAClDH,qBAAWoC,SAAX,CAAqBmP,aAArB;AACD,SAFM,MAEA;AACLA;AACD;;AACD,eAAO7Q,GAAP;AACD;;AAED,aAAO;AACL4Q,mBAAWA;AADN,OAAP;AAID,KAvCD;AAyCC,GA1CQ,EA0CP,EA1CO,CAtsDmc;AAgvDtc,MAAG,CAAC,UAASnY,OAAT,EAAiBS,MAAjB,EAAwBH,OAAxB,EAAgC;AAC1CG,WAAOH,OAAP;AACE,uBAAYiY,KAAZ,EAAmBC,MAAnB,EAA2BC,OAA3B,EAAoCC,QAApC,EAA8C;AAAA;;AAC5C,aAAKrT,IAAL,GAAYkT,KAAZ;AACA,aAAK7S,KAAL,GAAa8S,MAAb;AACA,aAAK7S,MAAL,GAAc8S,OAAd;AACA,aAAKC,QAAL,GAAgBA,QAAhB;AACD;;AANH;AAAA;AAAA,wCAQkBC,OARlB,EAQ2B;AACvB,iBAAOA,QAAQtT,IAAR,CAAauT,GAAb,CAAiB,KAAKvT,IAAtB,CAAP;AACD;AAVH;AAAA;AAAA,kCAYY;AACR,cAAItF,CAAJ,EAAOF,CAAP,EAAU0F,CAAV,EAAatB,CAAb,EAAgBE,CAAhB,EAAmB0U,IAAnB,EAAyBC,IAAzB,EAA+BpZ,CAA/B,EAAkC0E,GAAlC,EAAuCsL,IAAvC;AACAhQ,cAAI,KAAKgG,KAAL,GAAa,KAAKC,MAAtB;;AACAmT,iBAAQ,YAAW;AACjB,gBAAI7U,CAAJ,EAAOG,GAAP,EAAY2U,OAAZ;AACAA,sBAAU,EAAV;;AACA,iBAAKlZ,IAAIoE,IAAI,CAAR,EAAWG,MAAM,KAAKsU,QAA3B,EAAqC,KAAKtU,GAAL,GAAWH,IAAIG,GAAf,GAAqBH,IAAIG,GAA9D,EAAmEvE,IAAI,KAAKuE,GAAL,GAAW,EAAEH,CAAb,GAAiB,EAAEA,CAA1F,EAA6F;AAC3F8U,sBAAQlX,IAAR,CAAa,KAAKwD,IAAL,CAAUxF,CAAV,CAAb;AACD;;AACD,mBAAOkZ,OAAP;AACD,WAPM,CAOJxY,IAPI,CAOC,IAPD,CAAP;;AAQAsY,iBAAQ,YAAW;AACjB,gBAAI5U,CAAJ,EAAOG,GAAP,EAAY2U,OAAZ;AACAA,sBAAU,EAAV;;AACA,iBAAKlZ,IAAIoE,IAAI,CAAR,EAAWG,MAAM,KAAKsU,QAA3B,EAAqC,KAAKtU,GAAL,GAAWH,IAAIG,GAAf,GAAqBH,IAAIG,GAA9D,EAAmEvE,IAAI,KAAKuE,GAAL,GAAW,EAAEH,CAAb,GAAiB,EAAEA,CAA1F,EAA6F;AAC3F8U,sBAAQlX,IAAR,CAAa,KAAKwD,IAAL,CAAUxF,CAAV,CAAb;AACD;;AACD,mBAAOkZ,OAAP;AACD,WAPM,CAOJxY,IAPI,CAOC,IAPD,CAAP;;AAQAgF,cAAI,CAAJ;;AACA,eAAK1F,IAAIoE,IAAI,CAAR,EAAWG,MAAM1E,CAAtB,EAAyB,KAAK0E,GAAL,GAAWH,IAAIG,GAAf,GAAqBH,IAAIG,GAAlD,EAAuDvE,IAAI,KAAKuE,GAAL,GAAW,EAAEH,CAAb,GAAiB,EAAEA,CAA9E,EAAiF;AAC/E,iBAAKlE,IAAIoE,IAAI,CAAR,EAAWuL,OAAO,KAAKgJ,QAA5B,EAAsC,KAAKhJ,IAAL,GAAYvL,IAAIuL,IAAhB,GAAuBvL,IAAIuL,IAAjE,EAAuE3P,IAAI,KAAK2P,IAAL,GAAY,EAAEvL,CAAd,GAAkB,EAAEA,CAA/F,EAAkG;AAChG,kBAAI,KAAKkB,IAAL,CAAUE,CAAV,IAAesT,KAAK9Y,CAAL,CAAnB,EAA4B;AAC1B8Y,qBAAK9Y,CAAL,IAAU,KAAKsF,IAAL,CAAUE,CAAV,CAAV;AACD;;AACD,kBAAI,KAAKF,IAAL,CAAUE,CAAV,IAAeuT,KAAK/Y,CAAL,CAAnB,EAA4B;AAC1B+Y,qBAAK/Y,CAAL,IAAU,KAAKsF,IAAL,CAAUE,CAAV,CAAV;AACD;;AACDA;AACD;AACF;;AACD,iBAAO,CAACuT,IAAD,EAAOD,IAAP,CAAP;AACD;AA5CH;;AAAA;AAAA;AAgDC,GAjDQ,EAiDP,EAjDO,CAhvDmc;AAiyDtc,MAAG,CAAC,UAAS7Y,OAAT,EAAiBS,MAAjB,EAAwBH,OAAxB,EAAgC;AAC1C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+BA;AACA;AAEA;AAEAG,WAAOH,OAAP,GAAiB,SAAS0Q,UAAT,GAAsB;AAEvC,UAAIgI,SAAJ;AAEA;;;;;AAIA,UAAIjW,MAAM,aAASkW,GAAT,EAAc;AACtB,YAAIjY,OAAO8B,OAAP,IAAkB9B,OAAO8B,OAAP,CAAeC,GAArC,EAA0C;AACxC/B,iBAAO8B,OAAP,CAAeC,GAAf,CAAmBkW,GAAnB;AACD;AACF,OAJD;AAMA;;;;;;AAIA,UAAI9M,QAAQ,eAAS8M,GAAT,EAAc;AACxB,YAAIjY,OAAO8B,OAAX,EAAoB;AAClB,cAAI9B,OAAO8B,OAAP,CAAeqJ,KAAnB,EAA0B;AACxBnL,mBAAO8B,OAAP,CAAeqJ,KAAf,CAAqB8M,GAArB;AACD,WAFD,MAGK,IAAIjY,OAAO8B,OAAP,CAAeC,GAAnB,EAAwB;AAC3B/B,mBAAO8B,OAAP,CAAeC,GAAf,CAAmBkW,GAAnB;AACD;AACF;AACF,OATD;AAWA;;;;;AAGA,UAAIC,aAAa,SAAbA,UAAa,GAAW;AAC1BnW,cAAM,eAAW,CAAE,CAAnB;;AACAoJ,gBAAQ,iBAAW,CAAE,CAArB;AACD,OAHD;AAKA;;;;;;AAIA,UAAIgN,aAAa,SAAbA,UAAa,GAAW;AAC1B,eAAOnY,UAAUA,OAAOoY,GAAxB;AACD,OAFD;AAIA;;;;;;;;AAMA,UAAIC,iBAAiB,SAAjBA,cAAiB,CAAStH,EAAT,EAAa/P,KAAb,EAAoB;AACvC,aAAK,IAAI3B,CAAT,IAAc0R,EAAd,EAAkB;AAChB,cAAIA,GAAG1R,CAAH,KAAS2B,KAAb,EAAoB;AAClB,mBAAO3B,CAAP;AACD;AACF;;AACD,eAAO,OAAO2B,MAAMkG,QAAN,CAAe,EAAf,CAAd;AACD,OAPD;AASA;;;;;;;;AAMA,UAAIoR,eAAe,SAAfA,YAAe,CAASL,GAAT,EAAc;AAC/B,eAAO,KACL,wEADK,GAEL,qBAFK,GAGL,4DAHK,GAIL,gBAJK,GAIcA,GAJd,GAIoB,QAJpB,GAKL,QALK,GAML,oBANF;AAOD,OARD;AAUA;;;;;;AAIA,UAAIM,sBAAsB,KACxB,wDADwB,GAExB,wEAFF;AAIA;;;;;AAIA,UAAIC,gBAAgB,KAClB,yDADkB,GAElB,sFAFF;AAIA;;;;;;;;;;;AAUA,UAAIC,aAAa,SAAbA,UAAa,CAAS9R,MAAT,EAAiB+R,WAAjB,EAA8B;AAC7C,iBAASC,QAAT,CAAkBC,GAAlB,EAAuB;AACrB,cAAIC,YAAYlS,OAAOmS,UAAvB;;AACA,cAAID,SAAJ,EAAe;AACbA,sBAAUE,SAAV,GAAsBT,aAAaM,GAAb,CAAtB;AACD;AACF;;AAAA;;AAED,YAAI,CAAC5Y,OAAOgZ,qBAAZ,EAAmC;AACjC;AACA,iBAAO,IAAP;AACD;;AAED,YAAIpO,UAAUqO,gBAAgBtS,MAAhB,EAAwB+R,WAAxB,CAAd;;AACA,YAAI,CAAC9N,OAAL,EAAc,CACZ;AACD;;AACD,eAAOA,OAAP;AACD,OAlBD;AAoBA;;;;;;;;AAMA,UAAIqO,kBAAkB,SAAlBA,eAAkB,CAAStS,MAAT,EAAiB+R,WAAjB,EAA8B;AAClD,YAAIQ,QAAQ,CAAC,OAAD,EAAU,oBAAV,CAAZ;AACA,YAAItO,UAAU,IAAd;;AACA,aAAK,IAAIuO,KAAK,CAAd,EAAiBA,KAAKD,MAAM1Z,MAA5B,EAAoC,EAAE2Z,EAAtC,EAA0C;AACxC,cAAI;AACFvO,sBAAUjE,OAAOK,UAAP,CAAkBkS,MAAMC,EAAN,CAAlB,EAA6BT,WAA7B,CAAV;AACD,WAFD,CAEE,OAAMja,CAAN,EAAS,CAAE;;AACb,cAAImM,OAAJ,EAAa;AACX;AACD;AACF;;AACD,eAAOA,OAAP;AACD,OAZD;;AAcA,UAAIwO,sBAAsB,SAAtBA,mBAAsB,GAAW;AACnC,YAAIjB,YAAJ,EAAkB;AAChBrR,mBAASuS,IAAT,CAAcC,SAAd,GAA0B,QAA1B;AACD;AACF,OAJD;AAMA;;;;;;AAIA,UAAIzG,kBAAkB,SAAlBA,eAAkB,CAASlM,MAAT,EAAiB+R,WAAjB,EAA8B;AAClD,YAAIP,YAAJ,EAAkB;AAChBiB,gCADgB,CAGhB;;AACAzS,iBAAOjC,KAAP,GAAeiC,OAAO4S,WAAtB;AACA5S,iBAAOhC,MAAP,GAAgBgC,OAAO6S,YAAvB;AACD;;AAED,YAAIzI,KAAK0H,WAAW9R,MAAX,EAAmB+R,WAAnB,CAAT;AACA,eAAO3H,EAAP;AACD,OAXD;AAaA;;;;;;;;;;AAQA,UAAI0I,aAAa,SAAbA,UAAa,CAAS1I,EAAT,EAAa2I,YAAb,EAA2BC,UAA3B,EAAuCC,iBAAvC,EAA0D;AACzE,YAAIC,QAAQD,qBAAqBzO,KAAjC,CADyE,CAEzE;;AACA,YAAI2O,SAAS/I,GAAGgJ,YAAH,CAAgBJ,UAAhB,CAAb,CAHyE,CAKzE;;AACA5I,WAAG2I,YAAH,CAAgBI,MAAhB,EAAwBJ,YAAxB,EANyE,CAQzE;;AACA3I,WAAGiJ,aAAH,CAAiBF,MAAjB,EATyE,CAWzE;;AACA,YAAIG,WAAWlJ,GAAGmJ,kBAAH,CAAsBJ,MAAtB,EAA8B/I,GAAGoJ,cAAjC,CAAf;;AACA,YAAI,CAACF,QAAL,EAAe;AACb;AACAjC,sBAAYjH,GAAGqJ,gBAAH,CAAoBN,MAApB,CAAZ;AACAD,gBAAM,iCAAiCC,MAAjC,GAA0C,IAA1C,GAAiD9B,SAAvD;AACAjH,aAAGsJ,YAAH,CAAgBP,MAAhB;AACA,iBAAO,IAAP;AACD;;AAED,eAAOA,MAAP;AACD,OAtBD;AAwBA;;;;;;;;;;AAQA,UAAIQ,cAAc,SAAdA,WAAc,CACdvJ,EADc,EACVwJ,OADU,EACD7B,WADC,EACY8B,aADZ,EAC2BZ,iBAD3B,EAC8C;AAC9D,YAAIC,QAAQD,qBAAqBzO,KAAjC;AACA,YAAIsP,UAAU1J,GAAG2J,aAAH,EAAd;;AACA,aAAK,IAAIvB,KAAK,CAAd,EAAiBA,KAAKoB,QAAQ/a,MAA9B,EAAsC,EAAE2Z,EAAxC,EAA4C;AAC1CpI,aAAG4J,YAAH,CAAgBF,OAAhB,EAAyBF,QAAQpB,EAAR,CAAzB;AACD;;AACD,YAAIT,WAAJ,EAAiB;AACf,eAAK,IAAIS,KAAK,CAAd,EAAiBA,KAAKT,YAAYlZ,MAAlC,EAA0C,EAAE2Z,EAA5C,EAAgD;AAC9CpI,eAAG6J,kBAAH,CACIH,OADJ,EAEID,gBAAgBA,cAAcrB,EAAd,CAAhB,GAAoCA,EAFxC,EAGIT,YAAYS,EAAZ,CAHJ;AAID;AACF;;AACDpI,WAAG8J,WAAH,CAAeJ,OAAf,EAd8D,CAgB9D;;AACA,YAAIK,SAAS/J,GAAGgK,mBAAH,CAAuBN,OAAvB,EAAgC1J,GAAGiK,WAAnC,CAAb;;AACA,YAAI,CAACF,MAAL,EAAa;AACT;AACA9C,sBAAYjH,GAAGkK,iBAAH,CAAsBR,OAAtB,CAAZ;AACAZ,gBAAM,8BAA8B7B,SAApC;AAEAjH,aAAGmK,aAAH,CAAiBT,OAAjB;AACA,iBAAO,IAAP;AACH;;AACD,eAAOA,OAAP;AACD,OA5BD;AA8BA;;;;;;;;;;;AASA,UAAIU,yBAAyB,SAAzBA,sBAAyB,CACzBpK,EADyB,EACrBqK,QADqB,EACXC,cADW,EACKzB,iBADL,EACwB;AACnD,YAAIF,eAAe,EAAnB;AACA,YAAIC,UAAJ;AACA,YAAI2B,eAAexU,SAAS0C,cAAT,CAAwB4R,QAAxB,CAAnB;;AACA,YAAI,CAACE,YAAL,EAAmB;AACjB,gBAAM,sCAAsCF,QAA5C;AACD;;AACD1B,uBAAe4B,aAAaC,IAA5B;;AAEA,YAAI,CAACF,cAAL,EAAqB;AACnB,cAAIC,aAAatZ,IAAb,IAAqB,mBAAzB,EAA8C;AAC5C2X,yBAAa5I,GAAGyK,aAAhB;AACD,WAFD,MAEO,IAAIF,aAAatZ,IAAb,IAAqB,qBAAzB,EAAgD;AACrD2X,yBAAa5I,GAAG0K,eAAhB;AACD,WAFM,MAEA,IAAI9B,cAAc5I,GAAGyK,aAAjB,IAAkC7B,cAAc5I,GAAG0K,eAAvD,EAAwE;AAC7E,kBAAM,gCAAN;AACA,mBAAO,IAAP;AACD;AACF;;AAED,eAAOhC,WACH1I,EADG,EACC2I,YADD,EACe2B,iBAAiBA,cAAjB,GAAkC1B,UADjD,EAEHC,iBAFG,CAAP;AAGD,OAxBD;;AA0BA,UAAI8B,oBAAoB,CACtB,eADsB,EAEtB,iBAFsB,CAAxB;AAKA;;;;;;;;;;;;;AAYA,UAAI7G,2BAA2B,SAA3BA,wBAA2B,CAC3B9D,EAD2B,EACvB4K,eADuB,EACNjD,WADM,EACO8B,aADP,EACsBZ,iBADtB,EACyC;AACtE,YAAIW,UAAU,EAAd;;AACA,aAAK,IAAIpB,KAAK,CAAd,EAAiBA,KAAKwC,gBAAgBnc,MAAtC,EAA8C,EAAE2Z,EAAhD,EAAoD;AAClDoB,kBAAQ1Z,IAAR,CAAasa,uBACTpK,EADS,EACL4K,gBAAgBxC,EAAhB,CADK,EACgBpI,GAAG2K,kBAAkBvC,EAAlB,CAAH,CADhB,EAC2CS,iBAD3C,CAAb;AAED;;AACD,eAAOU,YAAYvJ,EAAZ,EAAgBwJ,OAAhB,EAAyB7B,WAAzB,EAAsC8B,aAAtC,EAAqDZ,iBAArD,CAAP;AACD,OARD,CA/RuC,CA0SvC;;;AACA,UAAIgC,kBAAkB,CACpB,EADoB,EAEpB,MAFoB,EAGpB,KAHoB,EAIpB,SAJoB,CAAtB;AAOA;;;;;;;;;AAQA,UAAIC,gCAAgC,SAAhCA,6BAAgC,CAAS9K,EAAT,EAAa5K,IAAb,EAAmB;AACrD,aAAK,IAAIgT,KAAK,CAAd,EAAiBA,KAAKyC,gBAAgBpc,MAAtC,EAA8C,EAAE2Z,EAAhD,EAAoD;AAClD,cAAI2C,eAAeF,gBAAgBzC,EAAhB,IAAsBhT,IAAzC;AACA,cAAI4V,MAAMhL,GAAG+B,YAAH,CAAgBgJ,YAAhB,CAAV;;AACA,cAAIC,GAAJ,EAAS;AACP,mBAAOA,GAAP;AACD;AACF;AACF,OARD;AAWA;;;;;;AAIA,UAAIC,4BAA4B,SAA5BA,yBAA4B,CAASrV,MAAT,EAAiB;AAC/C,YAAIA,OAAOjC,KAAP,IAAgBiC,OAAO4S,WAAvB,IACA5S,OAAOhC,MAAP,IAAiBgC,OAAO6S,YAD5B,EAC0C;AACxC7S,iBAAOjC,KAAP,GAAeiC,OAAO4S,WAAtB;AACA5S,iBAAOhC,MAAP,GAAgBgC,OAAO6S,YAAvB;AACD;AACF,OAND;AAQA;;;;;AAGA,UAAIyC,mBAAoB,YAAW;AACjC,eAAOjc,OAAO6T,qBAAP,IACA7T,OAAOkc,2BADP,IAEAlc,OAAOmc,wBAFP,IAGAnc,OAAOoc,sBAHP,IAIApc,OAAOqc,uBAJP,IAKA;AAAS;AAAoC/V,gBAA7C;AAAuD;AAAyBgW,eAAhF,EAAyF;AACvF,iBAAOtc,OAAOuc,UAAP,CAAkBjW,QAAlB,EAA4B,OAAK,EAAjC,CAAP;AACD,SAPR;AAQD,OATsB,EAAvB;AAWA;;;;;AAGA,UAAIkW,yBAA0B,YAAW;AACvC,eAAOxc,OAAOyc,iCAAP,IACAzc,OAAO0c,iCADP,IAEA1c,OAAO2c,8BAFP,IAGA3c,OAAO4c,4BAHP,IAIA5c,OAAO6c,6BAJP,IAKA7c,OAAO8c,YALd;AAMD,OAP4B,EAA7B;;AASA,aAAO;AACLpC,uBAAeJ,WADV;AAELzF,kCAA0BA,wBAFrB;AAGLkI,uCAA+B5B,sBAH1B;AAILtI,yBAAiBA,eAJZ;AAKLuG,6BAAqBA,mBALhB;AAMLyC,uCAA+BA,6BAN1B;AAOLG,mCAA2BA,yBAPtB;AAQLC,0BAAkBA,gBARb;AASLO,gCAAwBA;AATnB,OAAP;AAYC,KAvXD;AAyXC,GA9ZQ,EA8ZP,EA9ZO;AAjyDmc,CAA5c,EA+rEO,EA/rEP,EA+rEU,CAAC,CAAD,CA/rEV","file":"infragram.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){\nfunction urlHash() {\n\nfunction getUrlHashParameter(param) {\n\n  var params = getUrlHashParameters();\n  return params[param];\n\n}\n\nfunction getUrlHashParameters() {\n\n  var sPageURL = window.location.hash;\n  if (sPageURL) sPageURL = sPageURL.split('#')[1];\n  var pairs = sPageURL.split('&');\n  var object = {};\n  pairs.forEach(function(pair, i) {\n    pair = pair.split('=');\n    if (pair[0] != '') object[pair[0]] = pair[1];\n  });\n  return object;\n}\n\n// accepts an object like { paramName: value, paramName1: value }\n// and transforms to: url.com#paramName=value&paramName1=value\nfunction setUrlHashParameters(params) {\n\n  var keys = Object.keys(params);\n  var values = Object.values(params);\n  var pairs = [];\n  keys.forEach(function(key, i) {\n    if (key != '') pairs.push(keys[i] + '=' + values[i]);\n  });\n  var hash = pairs.join('&');\n  window.location.hash = hash;\n\n}\n\nfunction setUrlHashParameter(param, value) {\n\n  var params = getUrlHashParameters();\n  params[param] = value;\n  setUrlHashParameters(params);\n\n}\n\nreturn {\n  getUrlHashParameter:   getUrlHashParameter,\n  getUrlHashParameters:  getUrlHashParameters,\n  setUrlHashParameter:   setUrlHashParameter,\n  setUrlHashParameters:  setUrlHashParameters\n}\n\n}\n\nmodule.exports = urlHash;\n\n},{}],2:[function(require,module,exports){\nwindow.Infragram = function Infragram(options) {\n  options = options || {};\n  options.uploader = options.uploader || false;\n  options.processor = options.processor || 'javascript';\n  options.camera = require('./io/camera')(options);\n  options.colorized      = options.colorized      || false;\n  options.mode           = options.mode           || \"raw\",\n  options.video_live     = options.video_live     || false,\n  options.webGlSupported = options.webGlSupported || false; // move into processor\n\n  options.processors = {\n    'webgl':           require('./processors/webgl'),\n    'javascript':      require('./processors/javascript'),\n  }\n\n  options.processor = options.processors[options.processor](options);\n  options.file = require('./io/file')(options, options.processor);\n  options.logger = require('./logger')(options);\n\n  var Interface = require('./ui/interface')(options); // this can change processor based on URL hash\n  //options.processor.initialize(options); // double initialize after end of processor code?\n  console.log('processor:', options.processor.type)\n\n  options.colorize = function colorize(map) {\n    options.processor.colorize(map);\n  }\n\n  // this should accept an object with parameters r,g,b,h,s,v,m and mode\n  options.run = function run(mode) {\n    options.logger.save_log();\n    return options.processor.run(mode);\n  }\n\n  // split into processor.video() methods\n  options.video = function video() {\n    options.camera.initialize();\n    var interval;\n    if (options.processor.type == \"webgl\") interval = 15;\n    else interval = 150;\n    setInterval(function() {\n      if (image) options.run(options.mode);\n      options.camera.getSnapshot();\n      //if (options.colorized) return options.colorize();\n    }, interval);\n  }\n\n  // TODO: this doesn't work; it just downloads the unmodified image. \n  // probably a timing issue?\n  function download() {\n    //options.run(options.mode);\n    //if (options.colorized) return options.colorize();\n    options.file.downloadImage();\n  }\n\n  return {\n    Camera: options.camera,\n    Interface: Interface,\n    logger: options.logger,\n    run: options.run,\n    colorize: options.colorize,\n    processors: options.processors,\n    download: download,\n    options: options\n  }\n}\nmodule.exports = Infragram;\n\n},{\"./io/camera\":8,\"./io/file\":9,\"./logger\":10,\"./processors/javascript\":11,\"./processors/webgl\":12,\"./ui/interface\":16}],3:[function(require,module,exports){\nmodule.exports = function segmented_colormap(segments) {\n  return function(x) {\n    var i, l, len, m, ref, result, x0, x1, xstart, y0, y1;\n    [y0, y1] = [0, 0];\n    [x0, x1] = [segments[0][0], 1];\n    if (x < x0) {\n      return y0;\n    }\n    for (i = l = 0, len = segments.length; l < len; i = ++l) {\n      [xstart, y0, y1] = segments[i];\n      x0 = xstart;\n      if (i === segments.length - 1) {\n        x1 = 1;\n        break;\n      }\n      x1 = segments[i + 1][0];\n      if ((xstart <= x && x < x1)) {\n        break;\n      }\n    }\n    result = [];\n    for (i = m = 0, ref = y0.length; 0 <= ref ? m < ref : m > ref; i = 0 <= ref ? ++m : --m) {\n      result[i] = (x - x0) / (x1 - x0) * (y1[i] - y0[i]) + y0[i];\n    }\n    return result;\n  }\n}\n\n},{}],4:[function(require,module,exports){\nmodule.exports={\n  \"greyscale\": {\n    \"author\": \"publiclab\",\n    \"description\": \"A simple linear greyscale colormap, black to white.\",\n    \"url\": \"https://publiclab.org/colormaps#greyscale\",\n    \"colormapRanges\": [\n      [0,     [0,   0,   0],   [255, 255, 255] ],\n      [1,     [255, 255, 255], [255, 255, 255] ]\n    ]\n  },\n\n  \"default\": {\n    \"author\": \"publiclab\",\n    \"description\": \"A full-colorwheel colormap, covering the colors in the spectrum.\",\n    \"url\": \"https://publiclab.org/colormaps#default\",\n    \"colormapRanges\": [\n      [0,       [45,1,121],     [25,1,137]    ],\n      [0.125,   [25,1,137],     [0,6,156]     ],\n      [0.1875,  [0,6,156],      [7,41,172]    ],\n      [0.25,    [7,41,172],     [22,84,187]   ],\n      [0.3125,  [22,84,187],    [25,125,194]  ],\n      [0.375,   [25,125,194],   [26,177,197]  ],   \n      [0.4375,  [26,177,197],   [23,199,193]  ],\n      [0.47,    [23,199,193],   [25, 200,170] ],\n      [0.50,    [25, 200,170],  [21,209,27]   ],\n      [0.5625,  [21,209,27],    [108,215,18]  ],\n      [0.625,   [108,215,18],   [166,218,19]  ],\n      [0.6875,  [166,218,19],   [206,221,20]  ],\n      [0.75,    [206,221,20],   [222,213,19 ] ],\n      [0.7813,  [222,213,19],   [222, 191, 19]],\n      [0.8125,  [222, 191, 19], [227,133,17]  ],\n      [0.875,   [227,133,17],   [231,83,16]   ],\n      [0.9375,  [231,83,16],    [220,61,48]   ] \n    ]\n  },\n\n  \"stretched\": {\n    \"author\": \"publiclab\",\n    \"description\": \"A simple colormap from blue to red, with no purple overlap.\",\n    \"url\": \"https://publiclab.org/colormaps#stretched\",\n    \"colormapRanges\": [\n      [0,     [0,   0,   255], [0,   0,   255] ],\n      [0.1,   [0,   0,   255], [38,  195, 195] ],\n      [0.5,   [0,   150, 0],   [255, 255, 0]   ],\n      [0.7,   [255, 255, 0],   [255, 50,  50]  ],\n      [0.9,   [255, 50,  50],  [255, 50,  50]  ]\n    ]\n  },\n\n \"bluwhtgrngis\": {\n   \"author\": \"MaggPi\",\n   \"description\": \"A colormap from blue to white to green to....\",\n   \"url\": \"https://publiclab.org/colormaps#bluwhtgrngis\",\n   \"colormapRanges\": [\n     [0,      [6,23,86],    [6,25, 84]    ],\n     [0.0625, [6,25,84],    [6,25, 84]    ],\n     [0.125,  [6,25,84],    [6,25, 84]    ],\n     [0.1875, [6,25,84],    [6,25, 84]    ],\n     [0.25,   [6,25,84],    [6,25,84]     ],\n     [0.3125, [6,25,84],    [9,24, 84]    ],\n     [0.3438, [9,24, 84],   [119,120,162] ],\n     [0.375,  [119,129,162],[249,250,251] ],\n     [0.406,  [249,250,251],[255,255,255] ],\n     [0.4375, [255,255,255],[255,255,255] ],\n     [0.50,   [255,255,255],[214,205,191] ],\n     [0.52,   [214,205,191],[178,175,96]  ],\n     [0.5625, [178,175,96], [151,176,53]  ],\n     [0.593,  [151,176,53], [146,188,12]  ],\n     [0.625,  [146,188,12], [96,161,1]    ],\n     [0.6875, [96,161,1],   [30,127,3]    ],\n     [0.75,   [30,127,3],   [0,99,1]      ],\n     [0.8125, [0,99,1],     [0,74,1]      ],\n     [0.875,  [0,74,1],     [0,52, 0]     ],\n     [0.9375, [0,52, 0],    [0,34,0]      ],\n     [0.968,  [0,34,0],     [68,70,67]    ]\n    ]\n  },\n\n  \"brntogrn\": {\n    \"author\": \"MaggPi\",\n    \"description\": \"A colormap from brown to green.\",\n    \"url\": \"https://publiclab.org/colormaps#brntogrn\",\n    \"colormapRanges\": [\n      [0,      [110,12,3],   [118,6,1]      ],\n      [0.0625, [118,6,1],    [141,19,6]     ],\n      [0.125,  [141,19,6],   [165,35,13]    ],\n      [0.1875, [165,35,13],  [177,59,25]    ],\n      [0.2188, [177,59,25],  [192,91,36]    ],\n      [0.25,   [192,91,36],  [214, 145, 76] ],\n      [0.3125, [214,145,76], [230,183,134]  ],\n      [0.375,  [230,183,134],[243, 224, 194]],   \n      [0.4375, [243,224,194],[250,252,229]  ],\n      [0.50,   [250,252,229],[217,235,185]  ],\n      [0.5625, [217,235,185],[184,218,143]  ],\n      [0.625,  [184,218,143],[141,202,89]   ],\n      [0.6875, [141,202,89], [80,176,61]    ],\n      [0.75,   [80,176,61],  [0, 147, 32]   ],\n      [0.8125, [0,147,32],   [1, 122, 22]   ],\n      [0.875,  [1,122,22],   [0, 114, 19]   ],\n      [0.90,   [0,114,19],   [0,105,18]     ],\n      [0.9375, [0,105,18],   [7,70,14]      ] \n    ]\n  },\n\n  \"blutoredjet\": {\n    \"author\": \"MaggPi\",\n    \"description\": \"A colormap from blue to red.\",\n    \"url\": \"https://publiclab.org/colormaps#blutoredjet\",\n    \"colormapRanges\": [\n      [0,       [0,0,140],    [1,1,186]    ],\n      [0.0625,  [1,1,186],    [0,1,248]    ],\n      [0.125,   [0,1,248],    [0,70,254]   ],\n      [0.1875,  [0,70,254],   [0,130,255]  ],\n      [0.25,    [0,130,255],  [2,160,255]  ],\n      [0.2813,  [2,160,255],  [0,187,255]  ],\n      [0.3125,  [0,187,255],  [6,250,255]  ],\n      [0.348,   [0,218,255],  [8,252,251]  ],\n      [0.375,   [8,252,251],  [27,254,228] ], \n      [0.406,   [27,254,228], [70,255,187] ],\n      [0.4375,  [70,255,187], [104,254,151]],\n      [0.47,    [104,254,151],[132,255,19] ],\n      [0.50,    [132,255,19], [195,255,60] ],\n      [0.5625,  [195,255,60], [231,254,25] ],\n      [0.5976,  [231,254,25], [253,246,1]  ],\n      [0.625,   [253,246,1],  [252,210,1]  ],\n      [0.657,   [252,210,1],  [255,183,0]  ],\n      [0.6875,  [255,183,0],  [255,125,2]  ],\n      [0.75,    [255,125,2],  [255,65, 1]  ],\n      [0.8125,  [255,65, 1],  [247, 1, 1]  ],\n      [0.875,   [247,1,1],    [200, 1,  3] ],\n      [0.9375,  [200,1,3],    [122, 3,  2] ] \n    ]\n  },\n\n  \"colors16\": {\n    \"author\": \"publiclab\",\n    \"description\": \"A segmented colormap of the full color spectrum, divided into 16 colors.\",\n    \"url\": \"https://publiclab.org/colormaps#colors16\",\n    \"colormapRanges\": [\n      [0,      [0,0,0],       [0,0,0]       ],\n      [0.0625, [3,1,172],     [3,1,172]     ],\n      [0.125,  [3,1,222],     [3,1, 222]    ],\n      [0.1875, [0,111,255],   [0,111,255]   ],\n      [0.25,   [3,172,255],   [3,172,255]   ],\n      [0.3125, [1,226,255],   [1,226,255]   ],\n      [0.375,  [2,255,0],     [2,255,0]     ],   \n      [0.4375, [198,254,0],   [190,254,0]   ],\n      [0.50,   [252,255,0],   [252,255,0]   ],\n      [0.5625, [255,223,3],   [255,223,3]   ],\n      [0.625,  [255,143,3],   [255,143,3]   ],\n      [0.6875, [255,95,3],    [255,95,3]    ],\n      [0.75,   [242,0,1],     [242,0,1]     ],\n      [0.8125, [245,0,170],   [245,0,170]   ],\n      [0.875,  [223,180,225], [223,180,225] ],\n      [0.9375, [255,255,255], [255,255, 255]] \n    ]\n  },\n\n  \"fastie\": {\n    \"author\": \"cfastie\",\n    \"description\": \"A colormap for highlighting NDVI values over 0 on a scale from -1 to 1; in this scale, values from 0-0.5 are greyscale, while those over 0.5 are color.\",\n    \"url\": \"https://publiclab.org/colormaps#fastie\",\n    \"colormapRanges\": [\n      [0,     [255, 255, 255], [0,   0,   0]   ],\n      [0.167, [0,   0,   0],   [255, 255, 255] ],\n      [0.33,  [255, 255, 255], [0,   0,   0]   ],\n      [0.5,   [0,   0,   0],   [140, 140, 255] ],\n      [0.55,  [140, 140, 255], [0,   255, 0]   ],\n      [0.63,  [0,   255, 0],   [255, 255, 0]   ],\n      [0.75,  [255, 255, 0],   [255, 0,   0]   ],\n      [0.95,  [255, 0,   0],   [255, 0,   255] ]\n    ]\n  }\n \n}\n\n},{}],5:[function(require,module,exports){\n// This file was adapted from infragram-js:\n// http://github.com/p-v-o-s/infragram-js.\n\nmodule.exports = function Colormaps(options) {\n\n  // see https://github.com/publiclab/image-sequencer/tree/main/src/modules/Colormap/\n  var colormapFunctionGenerator = require('./colormapFunctionGenerator.js');\n  var colormaps = require('./colormaps.json');\n  Object.keys(colormaps).forEach(function(key) {\n    // make a function from the colormap, which we can't easily do in JSON\n    colormaps[key].fn = colormapFunctionGenerator(colormaps[key].colormapRanges);\n  });\n\n  var JsImage = require('../util/JsImage.js');\n\n  function colorify(jsImage, colormap) {\n    var b, data, g, i, j, l, n, r, ref;\n    $('#btn-colorize').addClass('active');\n    n = jsImage.width * jsImage.height;\n    data = new Uint8ClampedArray(4 * n);\n    j = 0;\n    for (i = l = 0, ref = n; 0 <= ref ? l < ref : l > ref; i = 0 <= ref ? ++l : --l) {\n      [r, g, b] = colormap(jsImage.data[i]);\n      data[j++] = r;\n      data[j++] = g;\n      data[j++] = b;\n      data[j++] = 255;\n    }\n    return new JsImage(data, jsImage.width, jsImage.height, 4);\n  }\n\n  return {\n    colorify: colorify,\n    colormap1: colormaps['default'].fn,\n    colormap2: colormaps['stretched'].fn,\n    greyscale_colormap: colormaps['greyscale'].fn,\n    segmented_colormap: colormapFunctionGenerator\n  }\n\n}\n\n},{\"../util/JsImage.js\":19,\"./colormapFunctionGenerator.js\":3,\"./colormaps.json\":4}],6:[function(require,module,exports){\n// This file was adapted from infragram-js:\n// http://github.com/p-v-o-s/infragram-js.\n\nmodule.exports = window.Converters = {\n\n  // modified from:\n  // http://axonflux.com/handy-rgb-to-hsl-and-rgb-to-hsv-color-model-c\n  hsv2rgb: function hsv2rgb(h, s, v) {\n    var data, f, i, p, q, rgb, t;\n    data = [];\n    if (s === 0) {\n      rgb = [v, v, v];\n    } else {\n      i = Math.floor(h * 6);\n      f = h * 6 - i;\n      p = v * (1 - s);\n      q = v * (1 - f * s);\n      t = v * (1 - (1 - f) * s);\n      data = [v * (1 - s), v * (1 - s * (h - i)), v * (1 - s * (1 - (h - i)))];\n      switch (i) {\n        case 0:\n          rgb = [v, t, p];\n          break;\n        case 1:\n          rgb = [q, v, p];\n          break;\n        case 2:\n          rgb = [p, v, t];\n          break;\n        case 3:\n          rgb = [p, q, v];\n          break;\n        case 4:\n          rgb = [t, p, v];\n          break;\n        default:\n          rgb = [v, p, q];\n      }\n    }\n    return rgb;\n  },\n\n  rgb2hsv: function rgb2hsv(r, g, b) {\n    var d, h, max, min, s, v;\n    max = Math.max(r, g, b);\n    min = Math.min(r, g, b);\n    h = s = v = max;\n    d = max - min;\n    s = max === 0 ? 0 : d / max;\n    if (max === min) {\n      h = 0; // achromatic\n    } else {\n      switch (max) {\n        case r:\n          h = (g - b) / d + (g < b ? 6 : 0);\n          break;\n        case g:\n          h = (b - r) / d + 2;\n          break;\n        case b:\n          h = (r - g) / d + 4;\n      }\n      h /= 6;\n    }\n    return [h, s, v];\n  }\n\n}\n\n},{}],7:[function(require,module,exports){\n// Generated by CoffeeScript 2.1.0\n// This file was adapted from infragram-js:\n// http://github.com/p-v-o-s/infragram-js.\nmodule.exports = window.FileUpload = {\n\n  socket: null,\n  file: null,\n  serverFilename: \"\",\n\n  isLoadedFromFile: function() {\n    if (FileUpload.file) {\n      return true;\n    } else {\n      return false;\n    }\n  },\n\n  getFilename: function() {\n    return FileUpload.serverFilename;\n  },\n\n  setFilename: function(name) {\n    return FileUpload.serverFilename = name;\n  },\n\n  uploadThumbnail: function(src, callback) {\n    var img;\n    img = new Image();\n    img.onload = function onImageLoad() {\n      var canvas, ctx, dataUrl;\n      canvas = document.createElement(\"canvas\");\n      ctx = canvas.getContext(\"2d\");\n      canvas.width = 260;\n      canvas.height = 195;\n      ctx.drawImage(this, 0, 0, this.width, this.height, 0, 0, canvas.width, canvas.height);\n      callback = callback.toString();\n      dataUrl = canvas.toDataURL(\"image/jpeg\");\n      return FileUpload.socket.emit(\"thumbnail_start\", {\n        \"name\": FileUpload.serverFilename,\n        \"data\": dataUrl,\n        \"callback\": callback\n      });\n    };\n    return img.src = src;\n  },\n\n  fromFile: function(files, callback, upload) {\n    var reader;\n    if (files && files[0]) {\n      $(\"#file-sel\").prop(\"disabled\", true);\n      $(\"#save-modal-btn\").prop(\"disabled\", true);\n      FileUpload.file = files[0];\n      FileUpload.file.reader = new FileReader();\n      if (upload) {\n        FileUpload.file.reader.onload = function onReaderLoad(event) {\n          return FileUpload.socket.emit(\"image_send\", {\n            \"name\": FileUpload.serverFilename,\n            \"size\": FileUpload.file.size,\n            \"data\": event.target.result\n          });\n        };\n        FileUpload.socket.emit(\"image_send\", {\n          \"name\": files[0].name,\n          \"size\": files[0].size\n        });\n      }\n      FileUpload.file.uploaded = 0;\n      reader = new FileReader();\n      reader.onload = function onReaderLoad(event) {\n        var img;\n        img = new Image();\n        img.onload = function onImageLoad() {\n          return callback(this);\n        };\n        return img.src = event.target.result;\n      };\n      return reader.readAsDataURL(files[0]);\n    }\n  },\n\n  duplicate: function(callback) {\n    callback = callback.toString();\n    return FileUpload.socket.emit(\"duplicate_start\", {\n      \"name\": FileUpload.serverFilename,\n      \"callback\": callback\n    });\n  },\n\n  fromBase64: function(name, data, callback) {\n    callback = callback.toString();\n    return FileUpload.socket.emit(\"base64_start\", {\n      \"name\": name,\n      \"data\": data,\n      \"callback\": callback\n    });\n  },\n\n  initialize: function(options) {\n    options = options || {};\n    options.rememberTransport = options.rememberTransport || false;\n    options.transports = options.transports || ['websocket', 'AJAX long-polling'];\n\n    if (options.socket) {\n      FileUpload.socket = io.connect(window.location.protocol + \"//\" + window.location.host, options);\n      FileUpload.socket.on(\"image_request\", function(data) {\n        var file, newFile, txt;\n        file = FileUpload.file;\n        txt = $(\"#save-modal-btn\").html().split(/\\s-\\s/g)[0];\n        txt += \" - \" + Math.round((file.uploaded / file.size) * 100) + \"%\";\n        $(\"#save-modal-btn\").html(txt);\n        newFile = file.slice(file.uploaded, file.uploaded + Math.min(data[\"chunk\"], file.size - file.uploaded));\n        FileUpload.file.uploaded += data[\"chunk\"];\n        FileUpload.serverFilename = data[\"name\"];\n        return file.reader.readAsDataURL(newFile);\n      });\n      FileUpload.socket.on(\"image_done\", function(data) {\n        var txt;\n        if (data[\"error\"]) {\n          alert(data[\"error\"]);\n        } else {\n          FileUpload.serverFilename = data[\"name\"];\n        }\n        txt = $(\"#save-modal-btn\").html().split(/\\s-\\s/g)[0];\n        $(\"#save-modal-btn\").html(txt);\n        $(\"#file-sel\").prop(\"disabled\", false);\n        return $(\"#save-modal-btn\").prop(\"disabled\", false);\n      });\n      FileUpload.socket.on(\"base64_done\", function(data) {\n        FileUpload.serverFilename = data[\"name\"];\n        eval(\"var callback=\" + data[\"callback\"]);\n        return callback();\n      });\n      FileUpload.socket.on(\"duplicate_done\", function(data) {\n        if (data[\"error\"]) {\n          return alert(data[\"error\"]);\n        } else {\n          FileUpload.serverFilename = data[\"name\"];\n          eval(\"var callback=\" + data[\"callback\"]);\n          return callback();\n        }\n      });\n      FileUpload.socket.on(\"thumbnail_done\", function(data) {\n        eval(\"var callback=\" + data[\"callback\"]);\n        return callback();\n      });\n    }\n\n  }\n}\n\n},{}],8:[function(require,module,exports){\n// This file was adapted from infragram-js:\n// http://github.com/p-v-o-s/infragram-js.\nmodule.exports = function Camera(options) {\n  var canvas, \n      ctx;\n\n  // Initialize getUserMedia with options\n  function initialize() {\n    getUserMedia(webRtcOptions, success, deviceError);\n\n    // iOS Safari 11 compatibility: https://github.com/webrtc/adapter/issues/685\n    webRtcOptions.videoEl.setAttribute('autoplay', 'autoplay');\n    webRtcOptions.videoEl.setAttribute('playsinline', 'playsinline');\n\n    window.webcam = webRtcOptions; // this is weird but maybe used for flash fallback?\n    canvas = options.canvas || document.getElementById(\"image\");\n    ctx = canvas.getContext(\"2d\");\n    // Trigger a snapshot w/ button\n    // -- move this to interface.js?\n    $(\"#snapshot\").show();\n    $(\"#live-video\").show();\n    $(\"#webcam\").show();\n  }\n\n  // webRtcOptions contains the configuration information for the shim\n  // it allows us to specify the width and height of the video\n  // output we\"re working with, the location of the fallback swf,\n  // events that are triggered onCapture and onSave (for the fallback)\n  // and so on.\n  var webRtcOptions = options.webRtcOptions || {\n    \"audio\": false,\n    \"video\": true,\n    // the element (by id) you wish to use for \n    // displaying the stream from a camera\n    el: \"webcam\",\n    extern: null,\n    append: true,\n    // height and width of the output stream\n    // container\n    width: 640,\n    height: 480,\n    // the recommended mode to be used is \n    // \"callback \" where a callback is executed \n    // once data is available\n    mode: \"callback\",\n    // a debugger callback is available if needed\n    debug: function() {},\n    // callback for capturing the fallback stream\n    onCapture: function onWebRtcCapture() {\n      return window.webcam.save();\n    },\n    // callback for saving the stream, useful for\n    // relaying data further.\n    onSave: onSaveGetUserMedia,\n    onLoad: function onLoadGetUserMedia() {}\n  }\n\n  function onSaveGetUserMedia(data) {\n    var col, h, i, img, j, ref, tmp, w, pos = 0;\n    col = data.split(\"\");\n    img = camera.image;\n    tmp = null;\n    w = webRtcOptions.width;\n    h = webRtcOptions.height;\n    for (i = j = 0, ref = w - 1; 0 <= ref ? j <= ref : j >= ref; i = 0 <= ref ? ++j : --j) {\n      tmp = parseInt(col[i], 10);\n      img.data[pos + 0] = (tmp >> 16) & 0xff;\n      img.data[pos + 1] = (tmp >> 8) & 0xff;\n      img.data[pos + 2] = tmp & 0xff;\n      img.data[pos + 3] = 0xff;\n      pos += 4;\n    }\n    if (pos >= 4 * w * h) {\n      ctx.putImageData(img, 0, 0);\n      return pos = 0;\n    }\n  }\n\n  function success(stream) {\n    var video;\n    if (webRtcOptions.context === \"webrtc\") {\n      video = webRtcOptions.videoEl;\n      if (navigator.mozGetUserMedia) {\n        video.mozSrcObject = stream;\n        console.log(\"mozilla???\");\n      } else {\n        video.srcObject = stream;\n      }\n      return video.onerror = function(e) {\n        return stream.stop();\n      }\n    } else {\n\n    }\n  }\n\n  function deviceError(error) {\n    alert(\"No camera available.\");\n    console.log(error);\n    return console.error(\"An error occurred: [CODE \" + error.code + \"]\");\n  }\n\n  // not doing anything now... for copying to a 2nd canvas\n  function getSnapshot() {\n    var video;\n    // If the current context is WebRTC/getUserMedia (something\n    // passed back from the shim to avoid doing further feature\n    // detection), we handle getting video/images for our canvas \n    // from our HTML5 <video> element.\n    if (webRtcOptions.context === \"webrtc\") {\n      video = document.getElementsByTagName(\"video\")[0];\n      options.processor.updateImage(video);\n      return $(\"#webcam\").hide();\n    // Otherwise, if the context is Flash, we ask the shim to\n    // directly call window.webcam, where our shim is located\n    // and ask it to capture for us.\n    } else if (webRtcOptions.context === \"flash\") {\n      return window.webcam.capture();\n    } else {\n      console.log(\"No context was supplied to getSnapshot()\");\n    }\n  }\n\n  return {\n    getSnapshot: getSnapshot,\n    initialize: initialize,\n    onSaveGetUserMedia: onSaveGetUserMedia,\n    webRtcOptions: webRtcOptions\n  }\n}\n\n},{}],9:[function(require,module,exports){\n// This file was adapted from infragram-js:\n// http://github.com/p-v-o-s/infragram-js.\n\nmodule.exports = function File(options, processor) {\n\n  function downloadImage() {\n    var event, format, lnk;\n    // create an \"off-screen\" anchor tag\n    lnk = document.createElement(\"a\");\n    // the key here is to set the download attribute of the a tag\n    lnk.href = processor.getCurrentImage();\n    if (lnk.href.match('image/jpeg')) {\n      format = \"jpg\";\n    } else {\n      format = \"png\";\n    }\n    lnk.download = (new Date()).toISOString().replace(/:/g, \"_\") + \".\" + format;\n    // create a \"fake\" click-event to trigger the download\n    if (document.createEvent) {\n      event = document.createEvent(\"MouseEvents\");\n      event.initMouseEvent(\"click\", true, true, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);\n      lnk.dispatchEvent(event);\n    } else if (lnk.fireEvent) {\n      lnk.fireEvent(\"onclick\");\n    }\n    return true;\n  }\n\n  // from a local URL (remote may be against js security rules)\n  function fetchImage(src, mode) {\n    var img;\n    $(\"#save-modal-btn\").show();\n    $(\"#save-zone\").show();\n    img = new Image();\n    if (options.uploader) {\n      img.onload = function() {\n        var filename;\n        filename = src.split('/');\n        filename = filename[filename.length - 1];\n        FileUpload.setFilename(filename);\n        if (mode) {\n          if (mode.substring(0, 5) === \"infra\") {\n            $(\"#modeSwitcher\").val(mode).change();\n          } else {\n            $(\"button#\" + mode).button(\"toggle\");\n            $(\"button#\" + mode).click(); // this should be via a direct call, not a click; the show.jade page should not require buttons!\n          }\n        }\n        options.save_infragrammar_expressions(params);\n        if (mode === \"ndvi\") {\n          options.save_infragrammar_expressions({\n            'm': '(R-B)/(R+B)'\n          });\n          mode = \"infragrammar_mono\";\n        } else if (mode === \"nir\") {\n          options.save_infragrammar_expressions({\n            'm': 'R'\n          });\n          mode = \"infragrammar_mono\";\n        } else if (mode === \"raw\") {\n          options.save_infragrammar_expressions({\n            'r': 'R',\n            'g': 'G',\n            'b': 'B'\n          });\n          mode = \"infragrammar\";\n        }\n\tprocessor.updateImage(this);\n        if (params['color'] === \"true\" || params['c'] === \"true\") {\n          options.colorized = true; // before run_infrag, so it gets logged\n        }\n        run_infragrammar(mode); // this sets colorized to false!\n        if (params['color'] === \"true\" || params['c'] === \"true\") {\n          options.colorized = true; // again, so it gets run \n        }\n        if (options.colorized) {\n          $(\"button#color\").button(\"toggle\");\n          return run_colorize();\n        }\n      }\n    }\n    return img.src = src;\n  }\n\n  return {\n    fetchImage: fetchImage,\n    downloadImage: downloadImage\n  }\n\n}\n\n},{}],10:[function(require,module,exports){\n// refactor to access state, not dom\nmodule.exports = function Logger(options) {\n\n  var log = []; // a record of previous commands run\n\n  function log_mono() {\n    var logEntry;\n    logEntry = \"mode=infragrammar_mono\";\n    logEntry += $(\"#m_exp\").val() ? \"&m=\" + $(\"#m_exp\").val() : \"\";\n    logEntry += options.colorized ? \"&c=true\" : \"\"; // no way to succinctly store the colormap... just offer range of colorizations at view-time?\n    return log.push(logEntry);\n  }\n\n  function log_hsv() {\n    var logEntry;\n    logEntry = \"mode=infragrammar_hsv\";\n    logEntry += $(\"#h_exp\").val() ? \"&h=\" + $(\"#h_exp\").val() : \"\";\n    logEntry += $(\"#s_exp\").val() ? \"&s=\" + $(\"#s_exp\").val() : \"\";\n    logEntry += $(\"#v_exp\").val() ? \"&v=\" + $(\"#v_exp\").val() : \"\";\n    return log.push(logEntry);\n  }\n\n  function log_rgb() {\n    var logEntry;\n    logEntry = \"mode=infragrammar\";\n    logEntry += $(\"#r_exp\").val() ? \"&r=\" + $(\"#r_exp\").val() : \"\";\n    logEntry += $(\"#g_exp\").val() ? \"&g=\" + $(\"#g_exp\").val() : \"\";\n    logEntry += $(\"#b_exp\").val() ? \"&b=\" + $(\"#b_exp\").val() : \"\";\n    return log.push(logEntry);\n  }\n\n  function save_log() {\n    if (options.mode === \"infragrammar_mono\") {\n      return log_mono();\n    } else if (options.mode === \"infragrammar_hsv\") {\n      return log_hsv();\n    } else if (options.mode === \"infragrammar\") {\n      return log_rgb();\n    }\n  }\n\n  return {\n    log: log,\n    log_hsv: log_hsv,\n    log_mono: log_mono,\n    log_rgb: log_rgb,\n    save_log: save_log\n  }\n\n}\n\n},{}],11:[function(require,module,exports){\n// This file was adapted from infragram-js:\n// http://github.com/p-v-o-s/infragram-js.\n\n// not currently being used -- will replace with Image Sequencer perhaps?\n// https://github.com/publiclab/image-sequencer\n\nmodule.exports = function javascriptProcessor() {\n\n  var b_exp = \"\",\n      g_exp = \"\",\n      get_channels,\n      Colormaps = require('../color/colormaps')(JsImage),\n      colormap = Colormaps.colormap1,\n      converters = require('../color/converters'),\n      image = null,\n      mode = \"raw\",\n      ndvi,\n      r_exp = \"\",\n      set_mode,\n      update_colorbar;\n\n  var JsImage = require('../util/JsImage.js');\n\n  function get_channels(jsImage) {\n    var b, g, i, l, mkImage, n, r, ref;\n    n = jsImage.width * jsImage.height;\n    r = new Float32Array(n);\n    g = new Float32Array(n);\n    b = new Float32Array(n);\n    for (i = l = 0, ref = n; 0 <= ref ? l < ref : l > ref; i = 0 <= ref ? ++l : --l) {\n      r[i] = jsImage.data[4 * i + 0];\n      g[i] = jsImage.data[4 * i + 1];\n      b[i] = jsImage.data[4 * i + 2];\n    }\n    function mkImage(d) {\n      return new JsImage(d, jsImage.width, jsImage.height, 1);\n    }\n    return [mkImage(r), mkImage(g), mkImage(b)];\n  }\n\n  // replace with infragrammar expression\n  function ndvi(nirJsImg, visJsImg) {\n    var d, i, l, n, ref;\n    n = nirJsImg.width * nirJsImg.height;\n    d = new Float64Array(n);\n    for (i = l = 0, ref = n; 0 <= ref ? l < ref : l > ref; i = 0 <= ref ? ++l : --l) {\n      d[i] = (nirJsImg.data[i] - visJsImg.data[i]) / (nirJsImg.data[i] + visJsImg.data[i]);\n    }\n    return new JsImage(d, nirJsImg.width, nirJsImg.height, 1);\n  }\n\n  function infragrammar(jsImage) {\n    var b, g, i, l, n, o, r, ref;\n    $('#btn-colorize').removeClass('active');\n    n = jsImage.width * jsImage.height;\n    r = new Float32Array(n);\n    g = new Float32Array(n);\n    b = new Float32Array(n);\n    o = new Float32Array(4 * n);\n    for (i = l = 0, ref = n; 0 <= ref ? l < ref : l > ref; i = 0 <= ref ? ++l : --l) {\n      r[i] = jsImage.data[4 * i + 0] / 255;\n      g[i] = jsImage.data[4 * i + 1] / 255;\n      b[i] = jsImage.data[4 * i + 2] / 255;\n      o[4 * i + 0] = 255 * r_exp(r[i], g[i], b[i]);\n      o[4 * i + 1] = 255 * g_exp(r[i], g[i], b[i]);\n      o[4 * i + 2] = 255 * b_exp(r[i], g[i], b[i]);\n      o[4 * i + 3] = 255;\n    }\n    return new JsImage(o, jsImage.width, jsImage.height, 4);\n  }\n\n  function infragrammar_mono(jsImage) {\n    var b, g, i, l, n, o, r, ref;\n    n = jsImage.width * jsImage.height;\n    r = new Float32Array(n);\n    g = new Float32Array(n);\n    b = new Float32Array(n);\n    o = new Float32Array(n);\n    for (i = l = 0, ref = n; 0 <= ref ? l < ref : l > ref; i = 0 <= ref ? ++l : --l) {\n      r[i] = jsImage.data[4 * i + 0] / 255.0;\n      g[i] = jsImage.data[4 * i + 1] / 255.0;\n      b[i] = jsImage.data[4 * i + 2] / 255.0;\n      o[i] = r_exp(r[i], g[i], b[i]);\n    }\n    return new JsImage(o, jsImage.width, jsImage.height, 1);\n  }\n\n  function render(jsImage) {\n    var ctx, d, e;\n    e = $(\"#image\")[0];\n    e.width = jsImage.width;\n    e.height = jsImage.height;\n    ctx = e.getContext(\"2d\");\n    d = ctx.getImageData(0, 0, jsImage.width, jsImage.height);\n    jsImage.copyToImageData(d);\n    return ctx.putImageData(d, 0, 0);\n  }\n\n  function colorize() {\n    var imageData = getImageData();\n    render(\n      Colormaps.colorify(infragrammar_mono(imageData), function(x) {\n        return colormap((x + 1) / 2);\n      })\n    );\n    return true;\n  }\n\n  update_colorbar = (min, max) => {\n    var b, ctx, d, e, g, i, j, k, l, m, r, ref, ref1;\n    $('#colorbar-container')[0].style.display = 'inline-block';\n    e = $('#colorbar')[0];\n    ctx = e.getContext(\"2d\");\n    d = ctx.getImageData(0, 0, e.width, e.height);\n    for (i = l = 0, ref = e.width; 0 <= ref ? l < ref : l > ref; i = 0 <= ref ? ++l : --l) {\n      for (j = m = 0, ref1 = e.height; 0 <= ref1 ? m < ref1 : m > ref1; j = 0 <= ref1 ? ++m : --m) {\n        [r, g, b] = colormap(i / e.width);\n        k = 4 * (i + j * e.width);\n        d.data[k + 0] = r;\n        d.data[k + 1] = g;\n        d.data[k + 2] = b;\n        d.data[k + 3] = 255;\n      }\n    }\n    ctx.putImageData(d, 0, 0);\n    $(\"#colorbar-min\")[0].textContent = min.toFixed(2);\n    return $(\"#colorbar-max\")[0].textContent = max.toFixed(2);\n  }\n\n  function update(image) {\n    var b, g, max, min, ndvi_jsImg, normalize, r, resultJsImage;\n    $('#colorbar-container')[0].style.display = 'none';\n    if (mode === \"ndvi\") {\n      [r, g, b] = get_channels(image);\n      ndvi_jsImg = ndvi(r, b);\n      // this isn't correct for NDVI; we want values from -1 to 1:\n      // [[min],[max]] = ndvi_img.extrema()\n      min = -1;\n      max = 1;\n      function normalize(x) {\n        return (x - min) / (max - min);\n      };\n      resultJsImage = Colormaps.colorify(ndvi_jsImg, function(x) {\n        return colormap(normalize(x));\n      });\n      update_colorbar(min, max);\n    } else if (mode === \"raw\") {\n      resultJsImage = new JsImage(image.data, image.width, image.height, 4);\n    } else if (mode === \"nir\") {\n      [r, g, b] = get_channels(image);\n      resultJsImage = Colormaps.colorify(r, function(x) {\n        return [x, x, x];\n      });\n    } else {\n      resultJsImage = infragrammar(image);\n    }\n    return render(resultJsImage);\n  }\n\n  function save_expressions(r, g, b) {\n    if (r === \"\") {\n      r = \"R\";\n    }\n    if (g === \"\") {\n      g = \"G\";\n    }\n    if (b === \"\") {\n      b = \"B\";\n    }\n    eval(\"r_exp = function(R,G,B){var r=R,g=G,b=B;return \" + r + \";}\");\n    eval(\"g_exp = function(R,G,B){var r=R,g=G,b=B;return \" + g + \";}\");\n    return eval(\"b_exp = function(R,G,B){var r=R,g=G,b=B;return \" + b + \";}\");\n  };\n\n  function save_expressions_hsv(h, s, v) {\n    if (h === \"\") {\n      h = \"H\";\n    }\n    if (s === \"\") {\n      s = \"S\";\n    }\n    if (v === \"\") {\n      v = \"V\";\n    }\n    eval(\"r_exp = function(R,G,B){var h=H,s=S,v=V,hsv = converters.rgb2hsv(R, G, B), H = hsv[0], S = hsv[1], V = hsv[2]; return converters.hsv2rgb(\" + h + \",\" + s + \",\" + v + \")[0];}\");\n    eval(\"g_exp = function(R,G,B){var h=H,s=S,v=V,hsv = converters.rgb2hsv(R, G, B), H = hsv[0], S = hsv[1], V = hsv[2]; return converters.hsv2rgb(\" + h + \",\" + s + \",\" + v + \")[1];}\");\n    return eval(\"b_exp = function(R,G,B){var h=H,s=S,v=V,hsv = converters.rgb2hsv(R, G, B), H = hsv[0], S = hsv[1], V = hsv[2]; return converters.hsv2rgb(\" + h + \",\" + s + \",\" + v + \")[2];}\");\n  }\n\n  function getImageData() {\n    var ctx = $('#image')[0].getContext(\"2d\");\n// risks being circular def of width/height\n    var width = $('#image').width();\n    var height = $('#image').height();\n// this now just defaults to file-scoped 'image' which we want to avoid\n    return image || ctx.getImageData(0, 0, width, height);\n  }\n\n  function getJsImage() {\n    var imageData = getImageData();\n    return new JsImage(imageData.data, imageData.width, imageData.height, 1);\n  }\n\n  function set_mode(new_mode) {\n    mode = new_mode;\n    update(getImageData());\n    if (mode === \"ndvi\") {\n      // TODO: move this into interface code:\n      return $(\"#colormaps-group\")[0].style.display = \"inline-block\";\n    } else {\n      if ($(\"#colormaps-group\").length > 0) {\n        return $(\"#colormaps-group\")[0].style.display = \"none\";\n      }\n    }\n  }\n\n  // img should be a native JavaScript image obj\n  function updateImage(img) {\n    var ctx, height, imgCanvas, width;\n    imgCanvas = document.getElementById(\"image\");\n    ctx = imgCanvas.getContext(\"2d\");\n    width = img.videoWidth || img.width;\n    height = img.videoHeight || img.height;\n    ctx.drawImage(img, 0, 0, width, height, 0, 0, imgCanvas.width, imgCanvas.height);\n    image = ctx.getImageData(0, 0, imgCanvas.width, imgCanvas.height);\n    return set_mode(mode);\n  }\n\n  function run(mode) {\n    return set_mode(mode);\n  }\n\n  function getCurrentImage() {\n    var ctx, e;\n    e = $(\"#image\")[0];\n    ctx = e.getContext(\"2d\");\n    return ctx.canvas.toDataURL(\"image/jpeg\");\n  }\n\n  return {\n    type: 'javascript',\n    colormap: colormap,\n    getCurrentImage: getCurrentImage,\n    getImageData: getImageData,\n    getJsImage: getJsImage,\n    infragrammar_mono: infragrammar_mono,\n    infragrammar: infragrammar,\n    render: render,\n    run: run,\n    save_expressions: save_expressions,\n    save_expressions_hsv: save_expressions_hsv,\n    update: update,\n    updateImage: updateImage,\n    colorize: colorize,\n    initialize: function() {}\n  }\n\n}\n\n},{\"../color/colormaps\":5,\"../color/converters\":6,\"../util/JsImage.js\":19}],12:[function(require,module,exports){\n// Generated by CoffeeScript 2.1.0\n// This file was adapted from infragram-js:\n// http://github.com/p-v-o-s/infragram-js.\nmodule.exports = function webglProcessor(options) {\n\n  var imgContext = null,\n      mapContext = null,\n      inputImage, // the pre-processed image\n      vertices = [-1.0, -1.0, -1.0, 1.0, 1.0, -1.0, 1.0, 1.0],\n      waitForShadersToLoad = 0,\n      webglUtils = require('../util/webgl-utils')(),\n      colorized = false,\n      // TODO: we should refactor this to use colormaps in /src/color/;\n      // we could build the dist/shader.frag file automatically around these\n      // using the function now at /src/color/colormapFunctionGenerator.js\n      // ... we need to either use integer indices for colormap, \n      // OR switch the system to strings and use the colormap names\n\n      colormaps = {\n        default: 0,\n        stretched: 2,\n        grey: 1\n      },\n      colormap = colormaps.default;\n\n  vertices.itemSize = 2;\n\n  function initialize(options) {\nconsole.log(options, 'webgl');\n    options = options || {};\n    options.shaderVertPath = options.shaderVertPath || \"dist/shader.vert\";\n    options.shaderFragPath = options.shaderFragPath || \"dist/shader.frag\";\n    options.shadersLoadedCallback = options.shadersLoadedCallback || function() { console.log('shaders loaded') };\n    imgContext = createContext(\"raw\", 1, 0, 1.0, \"image\");\n    mapContext = createContext(\"raw\", 1, 1, 1.0, \"colorbar\");\n    decolorize();\n    waitForShadersToLoad = 2;\n    $(\"#shader-vs\").load(options.shaderVertPath, glShaderLoaded);\n    $(\"#shader-fs-template\").load(options.shaderFragPath, glShaderLoaded);\n    if (imgContext && mapContext) {\n      return true;\n    } else {\n      return false;\n    }\n  };\n\n  function colorize(val) {\n    if (val === \"hsv\") run('hsv');\n    else {\n      val = val || colormap;\n      colormap = val;\n      console.log('colorize:' + val);\n      if (typeof val === 'string') val = colormaps[val];\n      imgContext.selColormap = mapContext.selColormap = val;\n      colorized = true;\n    }\n  }\n\n  function decolorize() {\n    colorized = false;\n  }\n\n  function createBuffer(ctx, data) {\n    var buffer, gl;\n    gl = ctx.gl;\n    buffer = gl.createBuffer();\n    gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(data), gl.STATIC_DRAW);\n    buffer.itemSize = data.itemSize;\n    return buffer;\n  };\n\n  function createTexture(ctx, textureUnit) {\n    var gl, texture;\n    gl = ctx.gl;\n    texture = gl.createTexture();\n    gl.activeTexture(textureUnit);\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n    gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, true);\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, ctx.canvas.width, ctx.canvas.height, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n    return texture;\n  };\n\n  function createContext(mode, selColormap, colormap, slider, canvasName) {\n    var ctx;\n    ctx = new Object();\n    ctx.mode = mode;\n    ctx.expression = [\"\", \"\", \"\"];\n    ctx.selColormap = selColormap;\n    ctx.colormap = colormap;\n    ctx.slider = slider;\n    ctx.updateShader = true;\n    ctx.canvas = document.getElementById(canvasName);\n    ctx.canvas.addEventListener(\"webglcontextlost\", (function(event) {\n      return event.preventDefault();\n    }), false);\n    ctx.canvas.addEventListener(\"webglcontextrestored\", glRestoreContext, false);\n    ctx.gl = webglUtils.getWebGLContext(ctx.canvas);\n    if (ctx.gl) {\n      ctx.gl.getExtension(\"OES_texture_float\");\n      ctx.vertexBuffer = createBuffer(ctx, vertices);\n      ctx.framebuffer = ctx.gl.createFramebuffer();\n      ctx.imageTexture = createTexture(ctx, ctx.gl.TEXTURE0);\n      return ctx;\n    } else {\n      return null;\n    }\n  };\n\n  function drawScene(ctx, returnImage) {\n    var gl, pColormap, pHsvUniform, pColorizedUniform, pSampler, pSelColormapUniform, pSliderUniform, pVertexPosition;\n    if (!returnImage) {\n      window.requestAnimationFrame(function() {\n        return drawScene(ctx, false);\n      });\n    }\n    if (ctx.updateShader) {\n      ctx.updateShader = false;\n      ctx.shaderProgram = generateShader(ctx);\n    }\n    gl = ctx.gl;\n    gl.viewport(0, 0, ctx.canvas.width, ctx.canvas.height);\n    gl.useProgram(ctx.shaderProgram);\n    gl.bindBuffer(gl.ARRAY_BUFFER, ctx.vertexBuffer);\n    pVertexPosition = gl.getAttribLocation(ctx.shaderProgram, \"aVertexPosition\");\n    gl.enableVertexAttribArray(pVertexPosition);\n    gl.vertexAttribPointer(pVertexPosition, ctx.vertexBuffer.itemSize, gl.FLOAT, false, 0, 0);\n    pSampler = gl.getUniformLocation(ctx.shaderProgram, \"uSampler\");\n    gl.uniform1i(pSampler, 0);\n    pSliderUniform = gl.getUniformLocation(ctx.shaderProgram, \"uSlider\");\n    gl.uniform1f(pSliderUniform, ctx.slider);\n\n    pColorizedUniform = gl.getUniformLocation(ctx.shaderProgram, \"uColorized\");\n    gl.uniform1i(pColorizedUniform, (colorized || ctx.colormap ? 1 : 0));\n\n    pSelColormapUniform = gl.getUniformLocation(ctx.shaderProgram, \"uSelectColormap\");\n    gl.uniform1i(pSelColormapUniform, ctx.selColormap);\n\n    pHsvUniform = gl.getUniformLocation(ctx.shaderProgram, \"uHsv\");\n    gl.uniform1i(pHsvUniform, (ctx.mode === \"hsv\" ? 1 : 0));\n    pColormap = gl.getUniformLocation(ctx.shaderProgram, \"uColormap\");\n    gl.uniform1i(pColormap, (ctx.colormap ? 1 : 0));\n    gl.drawArrays(gl.TRIANGLE_STRIP, 0, vertices.length / vertices.itemSize);\n\n    if (returnImage) return ctx.canvas.toDataURL(\"image/jpeg\");\n  };\n\n  function generateShader(ctx) {\n    var b, code, g, r;\n    [r, g, b] = ctx.expression;\n    // Map HSV to shader variable names\n    r = r.toLowerCase().replace(/h/g, \"r\").replace(/s/g, \"g\").replace(/v/g, \"b\");\n    g = g.toLowerCase().replace(/h/g, \"r\").replace(/s/g, \"g\").replace(/v/g, \"b\");\n    b = b.toLowerCase().replace(/h/g, \"r\").replace(/s/g, \"g\").replace(/v/g, \"b\");\n    // Sanitize strings\n    r = r.replace(/[^xrgb\\/\\-\\+\\*\\(\\)\\.0-9]*/g, \"\");\n    g = g.replace(/[^xrgb\\/\\-\\+\\*\\(\\)\\.0-9]*/g, \"\");\n    b = b.replace(/[^xrgb\\/\\-\\+\\*\\(\\)\\.0-9]*/g, \"\");\n    // Convert int to float if no decimals are present\n    if (!r.includes('.')) r = r.replace(/([0-9])([^\\.])?/g, \"$1.0$2\");\n    if (!g.includes('.')) g = g.replace(/([0-9])([^\\.])?/g, \"$1.0$2\");\n    if (!b.includes('.')) b = b.replace(/([0-9])([^\\.])?/g, \"$1.0$2\");\n    // adjust NDVI range\n    if (ctx.mode === \"ndvi\") {\n      if (r !== \"\") {\n        r = \"((\" + r + \") + 1.0) / 2.0\";\n      }\n      if (g !== \"\") {\n        g = \"((\" + g + \") + 1.0) / 2.0\";\n      }\n      if (b !== \"\") {\n        b = \"((\" + b + \") + 1.0) / 2.0\";\n      }\n    }\n    if (r === \"\") {\n      r = \"r\";\n    }\n    if (g === \"\") {\n      g = \"g\";\n    }\n    if (b === \"\") {\n      b = \"b\";\n    }\n    code = $(\"#shader-fs-template\").html();\n    code = code.replace(/@1@/g, r);\n    code = code.replace(/@2@/g, g);\n    code = code.replace(/@3@/g, b);\n    $(\"#shader-fs\").html(code);\n    return webglUtils.createProgramFromScripts(ctx.gl, [\"shader-vs\", \"shader-fs\"]);\n  };\n\n  function setMode(ctx, newMode) {\n    if (ctx.mode != newMode) ctx.updateShader = true;\n    ctx.mode = newMode;\n  };\n\n  function glShaderLoaded() {\n    waitForShadersToLoad -= 1;\n    if (!waitForShadersToLoad) {\n      options.shadersLoadedCallback();\n      drawScene(imgContext);\n      return drawScene(mapContext);\n    }\n  };\n\n  function glRestoreContext() {\n    var imageData;\n    imageData = imgContext.imageData;\n    imgContext = createContext(imgContext.mode, imgContext.selColormap, imgContext.colormap, imgContext.slider, \"image\");\n    mapContext = createContext(mapContext.mode, mapContext.selColormap, mapContext.colormap, mapContext.slider, \"colorbar\");\n    if (imgContext && mapContext) {\n      return updateImage(imageData);\n    }\n  };\n\n  function updateImage(img) {\n    var gl;\n    gl = imgContext.gl;\n    inputImage = img;\n    imgContext.imageData = img;\n    gl.activeTexture(gl.TEXTURE0);\n    return gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, img);\n  };\n\n  function getInputImage() {\n    function imageToBase64(img) {\n      let canvas = document.createElement('CANVAS');\n      const ctx = canvas.getContext('2d');\n      canvas.height = img.height;\n      canvas.width = img.width;\n      ctx.drawImage(img, 0, 0);\n      const dataURL = canvas.toDataURL('image/png|gif|jpg');\n      canvas = null;\n      return dataURL;\n    }\n    return imageToBase64(inputImage);\n  };\n\n  function getCurrentImage() {\n    return drawScene(imgContext, true);\n  };\n\n  function getImageData() {\n    return imgContext.imageData;\n  };\n\n  function saveExpression(a, b, c) {\n    return imgContext.expression = [a, b, c];\n  };\n\n  function run(mode) {\n    return setMode(imgContext, mode);\n  };\n\n  initialize(options);\n\n  return {\n    type: 'webgl',\n    initialize: initialize,\n    getInputImage: getInputImage,\n    getCurrentImage: getCurrentImage,\n    getImageData: getImageData,\n    run: run,\n    save_expressions: saveExpression,\n    setMode: setMode,\n    updateImage: updateImage,\n    decolorize: decolorize,\n    colorize: colorize,\n    context: imgContext\n  }\n\n}\n\n},{\"../util/webgl-utils\":20}],13:[function(require,module,exports){\nmodule.exports = function Analysis(options, save_infragrammar_inputs) {\n\n  // buttons to run Analysis steps\n  $(\"#infragrammar_hsv\").submit(function() {\n    console.log('hsv mode');\n    options.mode = \"infragrammar_hsv\";\n    options.logger.log_hsv();\n    save_infragrammar_inputs();\n    options.run(options.mode);\n    options.run();\n    return true;\n  });\n\n  $(\"#infragrammar\").submit(function() {\n    console.log('infragrammar mode');\n    options.mode = \"infragrammar\";\n    options.logger.log_rgb();\n    save_infragrammar_inputs();\n    options.run(options.mode);\n    options.run();\n    return true;\n  });\n\n  $(\"#infragrammar_mono\").submit(function() {\n    console.log('infragrammar mono mode');\n    options.mode = \"infragrammar_mono\";\n    options.logger.log_mono();\n    save_infragrammar_inputs();\n    options.run(options.mode);\n    options.run();\n    return true;\n  });\n\n}\n\n},{}],14:[function(require,module,exports){\nmodule.exports = function Colorize(options) {\n\n  $(\".btn-colorize\").click(function() {\n    if (options.colorized) {\n      decolorize();\n      options.run(options.mode);\n      return options.processor.decolorize();\n    } else {\n      colorize();\n      options.run(options.mode);\n      return options.colorize();\n    }\n  });\n\n  $(\"#default_colormap\").click(function() {\n    console.log('default colormap');\n    colorize();\n    options.colorize('default');\n    options.run(options.mode);\n    return $(\"#btn-colorize\").addClass(\"active\");\n  });\n\n  $(\"#stretched_colormap\").click(function() {\n    console.log('stretched colormap');\n    colorize();\n    options.colorize('stretched');\n    options.run(options.mode);\n    return $(\"#btn-colorize\").addClass(\"active\");\n  });\n\n  // duplicated in presets.js\n  function colorize() {\n    console.log('colorized on');\n    options.colorized = true;\n    $(\"#btn-colorize\").addClass(\"active\");\n    $(\"#colorbar-container\").css('display', 'inline-block');\n    $(\"#colormaps-group\").css('display', 'inline-block');\n  }\n\n  function decolorize() {\n    console.log('colorized off');\n    options.colorized = false;\n    $(\"#btn-colorize\").removeClass(\"active\");\n    $(\"#colorbar-container\").css('display', 'none');\n    $(\"#colormaps-group\").css('display', 'none');\n  }\n\n}\n\n},{}],15:[function(require,module,exports){\nmodule.exports = function Fullscreen(options) {\n    var fullscreen = false;\n\n    $(\".fullscreen\").click(function() {\n      if (fullscreen) {\n        $(\"#image\").css(\"display\", \"inline\");\n        $(\"#image\").css(\"position\", \"relative\");\n        $(\"#image\").css(\"height\", \"auto\");\n        $(\"#image\").css(\"left\", 0);\n        $(\"#backdrop\").hide();\n        $(\".btn.fullscreen\").show();\n        fullscreen = false;\n      } else {\n        $(\"#image\").css(\"display\", \"block\");\n        $(\"#image\").css(\"height\", \"100%\");\n        $(\"#image\").css(\"width\", \"auto\");\n        $(\"#image\").css(\"position\", \"absolute\");\n        $(\"#image\").css(\"top\", \"0px\");\n        $(\"#image\").css(\"left\", parseInt((window.innerWidth - $(\"#image\").width()) / 2) + \"px\");\n        $(\"#image\").css(\"z-index\", \"2\");\n        $(\"#backdrop\").show();\n        $(\".btn.fullscreen\").hide();\n        fullscreen = true;\n      }\n      return fullscreen;\n    });\n\n}\n\n},{}],16:[function(require,module,exports){\nmodule.exports = function Interface(options) {\n\n  options.imageSelector = options.imageSelector || \"#image-container\";\n  options.fileSelector = options.fileSelector || \"#file-sel\";\n\n  var urlHash = require('urlhash')();\n  var FileUpload = require('../file-upload');\n  var logger = options.logger;\n  var Colormaps = require('../color/colormaps');\n  var Fullscreen, Presets, Analysis, Colorize, Saving;\n\n  // saving inputs/expressions:\n\n  function save_infragrammar_inputs() {\n    options.mode = $('#modeSwitcher').val();\n    return save_infragrammar_expressions({\n      'r': $('#r_exp').val(),\n      'g': $('#g_exp').val(),\n      'b': $('#b_exp').val(),\n      'm': $('#m_exp').val(),\n      'h': $('#h_exp').val(),\n      's': $('#s_exp').val(),\n      'v': $('#v_exp').val()\n    });\n  }\n\n  function save_infragrammar_expressions(args) {\n    console.log(args);\n    if (options.mode === \"infragrammar\") {\n      options.processor.save_expressions(args['r'], args['g'], args['b']);\n    } else if (options.mode === \"infragrammar_mono\") {\n      options.processor.save_expressions(args['m'], args['m'], args['m']);\n    } else if (options.mode === \"infragrammar_hsv\") {\n      return options.processor.save_expressions_hsv(args['h'], args['s'], args['v']);\n    }\n  }\n\n  $(document).ready(function() {\n\n    Fullscreen = require('./fullscreen')(options);\n    Presets = require('../ui/presets')(options, save_infragrammar_inputs);\n    Analysis = require('../ui/analysis')(options, save_infragrammar_inputs);\n    Colorize = require('../ui/colorize')(options);\n    Saving = require('../ui/saving')(options);\n\n    if (options.uploadable) FileUpload.initialize({ socket: options.uploadable });\n\n    $(options.imageSelector).ready(function() {\n\n      var src, idNameMap = {\n        \"#m_exp\": \"m\",\n        \"#r_exp\": \"r\",\n        \"#g_exp\": \"g\",\n        \"#b_exp\": \"b\",\n        \"#h_exp\": \"h\",\n        \"#s_exp\": \"s\",\n        \"#v_exp\": \"v\"\n      };\n \n      $(\"#overlay-slider\").val(localStorage.getItem(\"overlaySize\"));\n\n      // TODO: broken:  \n      //urlHash.setUrlHashParameter(JSON.stringify(idNameMap));\n      src = urlHash.getUrlHashParameter('src');\n      if (src) {\n        params = parametersObject(location.search.split('?')[1]);\n        options.mode = params['mode'];\n        fetch_image(src);\n      }\n      return true;\n    });\n\n    $(options.fileSelector).change(function() {\n      $('.choose-prompt').hide();\n      $(\"#save-modal-btn\").show();\n      $(\"#save-zone\").show();\n      FileUpload.fromFile(this.files, options.processor.updateImage, options.uploadable);\n      $('#preset-modal').modal('show');\n      return true;\n    });\n\n    $(\"#webcam-activate\").click(function() {\n      $('.choose-prompt').hide();\n      $(\"#save-modal-btn\").show();\n      $(\"#save-zone\").show();\n      save_infragrammar_inputs();\n      options.video();\n      $('#preset-modal').modal('show');\n      return true;\n    });\n\n    $(\"#snapshot\").click(function() {\n      options.camera.getSnapshot();\n      return true;\n    });\n\n    $(\"#modeSwitcher\").change(function() {\n      $(\"#infragrammar, #infragrammar_mono, #infragrammar_hsv\").hide();\n      $(\"#\" + $(\"#modeSwitcher\").val()).css(\"display\", \"inline\");\n      return true;\n    });\n\n    $(\"#overlay-btn\").click(function() {\n      $(\"#overlay-container\").toggle();\n      $(\"#overlay-btn\").toggleClass(\"btn-success\");\n    });\n\n    $(\"#overlay-slider\").on(\"input\", function() {\n      var scale = 12,\n          ratio = 1250/4000; // size of svg\n      $(\"#overlay-img\").width($(\"#overlay-slider\").val() * scale);\n      $(\"#overlay-img\").height($(\"#overlay-slider\").val() * scale * ratio); // 3:4 ratio\n    });\n\n    $(\"#overlay-save-btn\").click(function() {\n      localStorage.setItem(\"overlaySize\", $(\"#overlay-slider\").val())\n      $(\"#overlay-save-info\").show().delay(2000).fadeOut();\n    });\n    \n    $(\"[rel=tooltip]\").tooltip()\n    $(\"[rel=popover]\").popover()\n    return true;\n  });\n}\n\n},{\"../color/colormaps\":5,\"../file-upload\":7,\"../ui/analysis\":13,\"../ui/colorize\":14,\"../ui/presets\":17,\"../ui/saving\":18,\"./fullscreen\":15,\"urlhash\":1}],17:[function(require,module,exports){\nmodule.exports = function Presets(options, save_infragrammar_inputs) {\n\n  // preset button\n  $(\"#preset_raw\").click(function() {\n    $('#modeSwitcher').val(\"infragrammar\").change();\n    $('#r_exp').val(\"R\");\n    $('#g_exp').val(\"G\");\n    $('#b_exp').val(\"B\");\n    $('#preset-modal').modal('hide');\n    options.colorized = false;\n    options.processor.decolorize();\n    save_infragrammar_inputs();\n    decolorize();\n    return options.run(options.mode);\n  });\n\n  // preset button\n  $(\"#preset_ndvi_blue\").click(function() {\n    $('#modeSwitcher').val(\"infragrammar_mono\").change();\n    $('#m_exp').val(\"(R-B)/(R+B)\");\n    $('#preset-modal').modal('hide');\n    options.colorized = false;\n    options.processor.decolorize();\n    save_infragrammar_inputs();\n    decolorize();\n    return options.run(options.mode);\n  });\n\n  // preset button\n  $(\"#preset_ndvi_blue_color\").click(function() {\n    $('#modeSwitcher').val(\"infragrammar_mono\").change();\n    $('#m_exp').val(\"(R-B)/(R+B)\");\n    $('#preset-modal').modal('hide');\n    save_infragrammar_inputs();\n    options.colorized = true;\n    options.run(options.mode);\n    options.colorize();\n    colorize();\n    return options.run();\n  });\n\n  // preset button\n  $(\"#preset_ndvi_red\").click(function() {\n    $('#modeSwitcher').val(\"infragrammar_mono\").change();\n    $('#m_exp').val(\"(B-R)/(B+R)\");\n    $('#preset-modal').modal('hide');\n    options.colorized = false;\n    options.processor.decolorize();\n    save_infragrammar_inputs();\n    decolorize();\n    return options.run(options.mode);\n  });\n\n  // preset button\n  $(\"#preset_ndvi_red_color\").click(function() {\n    $('#modeSwitcher').val(\"infragrammar_mono\").change();\n    $('#m_exp').val(\"(B-R)/(B+R)\");\n    $('#preset-modal').modal('hide');\n    save_infragrammar_inputs();\n    colorize();\n    options.run(options.mode);\n    options.colorize();\n    return options.run();\n  });\n\n  function colorize() {\n    console.log('colorized on');\n    options.colorized = true;\n    $(\"#btn-colorize\").addClass(\"active\");\n    $(\"#colorbar-container\").css('display', 'inline-block');\n    $(\"#colormaps-group\").css('display', 'inline-block');\n  }\n\n  function decolorize() {\n    console.log('colorized off');\n    options.colorized = false;\n    $(\"#btn-colorize\").removeClass(\"active\");\n    $(\"#colorbar-container\").css('display', 'none');\n    $(\"#colormaps-group\").css('display', 'none');\n  }\n\n}\n\n},{}],18:[function(require,module,exports){\nmodule.exports = function Saving(options) {\n\n  // This is all unused...\n\n  $(\"#download\").click(function() {\n    downloadImage();\n    return true;\n  });\n\n  // refactor this, it's a mess:\n  $(\"#save\").click(saveImage);\n\n  function saveImage() {\n    var img;\n    function sendThumbnail() {\n      img = options.processor.getCurrentImage();\n      return FileUpload.uploadThumbnail(img, function() {\n        $(\"#form-filename\").val(FileUpload.getFilename());\n        $(\"#form-log\").val(JSON.stringify(logger.log));\n        return $(\"#save-form\").submit();\n      });\n    };\n    $(\"#save\").prop(\"disabled\", true);\n    $(\"#save\").html(\"Saving...\");\n    if (FileUpload.getFilename() === \"\") {\n      img = options.processor.getCurrentImage();\n      FileUpload.fromBase64(\"camera\", img, sendThumbnail);\n    } else if (FileUpload.isLoadedFromFile() === false) {\n      FileUpload.duplicate(sendThumbnail);\n    } else {\n      sendThumbnail();\n    }\n    return img;\n  }\n\n  return {\n    saveImage: saveImage\n  }\n\n}\n\n},{}],19:[function(require,module,exports){\nmodule.exports = class JsImage {\n  constructor(data1, width1, height1, channels) {\n    this.data = data1;\n    this.width = width1;\n    this.height = height1;\n    this.channels = channels;\n  }\n\n  copyToImageData(imgData) {\n    return imgData.data.set(this.data);\n  }\n\n  extrema() {\n    var c, i, j, l, m, maxs, mins, n, ref, ref1;\n    n = this.width * this.height;\n    mins = (function() {\n      var l, ref, results;\n      results = [];\n      for (i = l = 0, ref = this.channels; 0 <= ref ? l < ref : l > ref; i = 0 <= ref ? ++l : --l) {\n        results.push(this.data[i]);\n      }\n      return results;\n    }).call(this);\n    maxs = (function() {\n      var l, ref, results;\n      results = [];\n      for (i = l = 0, ref = this.channels; 0 <= ref ? l < ref : l > ref; i = 0 <= ref ? ++l : --l) {\n        results.push(this.data[i]);\n      }\n      return results;\n    }).call(this);\n    j = 0;\n    for (i = l = 0, ref = n; 0 <= ref ? l < ref : l > ref; i = 0 <= ref ? ++l : --l) {\n      for (c = m = 0, ref1 = this.channels; 0 <= ref1 ? m < ref1 : m > ref1; c = 0 <= ref1 ? ++m : --m) {\n        if (this.data[j] > maxs[c]) {\n          maxs[c] = this.data[j];\n        }\n        if (this.data[j] < mins[c]) {\n          mins[c] = this.data[j];\n        }\n        j++;\n      }\n    }\n    return [mins, maxs];\n  }\n\n}\n\n},{}],20:[function(require,module,exports){\n/*\n * Copyright 2012, Gregg Tavares.\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are\n * met:\n *\n *     * Redistributions of source code must retain the above copyright\n * notice, this list of conditions and the following disclaimer.\n *     * Redistributions in binary form must reproduce the above\n * copyright notice, this list of conditions and the following disclaimer\n * in the documentation and/or other materials provided with the\n * distribution.\n *     * Neither the name of Gregg Tavares. nor the names of his\n * contributors may be used to endorse or promote products derived from\n * this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n * \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n// These funcitions are meant solely to help unclutter the tutorials.\n// They are not meant as production type functions.\n\n// This file was adapted from the above author for Node.js use.\n\nmodule.exports = function webglUtils() {\n\nvar lastError;\n\n/**\n * Wrapped logging function.\n * @param {string} msg The message to log.\n */\nvar log = function(msg) {\n  if (window.console && window.console.log) {\n    window.console.log(msg);\n  }\n};\n\n/**\n * Wrapped logging function.\n * @param {string} msg The message to log.\n */\nvar error = function(msg) {\n  if (window.console) {\n    if (window.console.error) {\n      window.console.error(msg);\n    }\n    else if (window.console.log) {\n      window.console.log(msg);\n    }\n  }\n};\n\n/**\n * Turn off all logging.\n */\nvar loggingOff = function() {\n  log = function() {};\n  error = function() {};\n};\n\n/**\n * Check if the page is embedded.\n * @return {boolean} True of we are in an iframe\n */\nvar isInIFrame = function() {\n  return window != window.top;\n};\n\n/**\n * Converts a WebGL enum to a string\n * @param {!WebGLContext} gl The WebGLContext to use.\n * @param {number} value The enum value.\n * @return {string} The enum as a string.\n */\nvar glEnumToString = function(gl, value) {\n  for (var p in gl) {\n    if (gl[p] == value) {\n      return p;\n    }\n  }\n  return \"0x\" + value.toString(16);\n};\n\n/**\n * Creates the HTLM for a failure message\n * @param {string} canvasContainerId id of container of th\n *        canvas.\n * @return {string} The html.\n */\nvar makeFailHTML = function(msg) {\n  return '' +\n    '<table style=\"background-color: #8CE; width: 100%; height: 100%;\"><tr>' +\n    '<td align=\"center\">' +\n    '<div style=\"display: table-cell; vertical-align: middle;\">' +\n    '<div style=\"\">' + msg + '</div>' +\n    '</div>' +\n    '</td></tr></table>';\n};\n\n/**\n * Mesasge for getting a webgl browser\n * @type {string}\n */\nvar GET_A_WEBGL_BROWSER = '' +\n  'This page requires a browser that supports WebGL.<br/>' +\n  '<a href=\"http://get.webgl.org\">Click here to upgrade your browser.</a>';\n\n/**\n * Mesasge for need better hardware\n * @type {string}\n */\nvar OTHER_PROBLEM = '' +\n  \"It doesn't appear your computer can support WebGL.<br/>\" +\n  '<a href=\"http://get.webgl.org/troubleshooting/\">Click here for more information.</a>';\n\n/**\n * Creates a webgl context. If creation fails it will\n * change the contents of the container of the <canvas>\n * tag to an error message with the correct links for WebGL.\n * @param {Element} canvas. The canvas element to create a\n *     context from.\n * @param {WebGLContextCreationAttirbutes} opt_attribs Any\n *     creation attributes you want to pass in.\n * @return {WebGLRenderingContext} The created context.\n */\nvar setupWebGL = function(canvas, opt_attribs) {\n  function showLink(str) {\n    var container = canvas.parentNode;\n    if (container) {\n      container.innerHTML = makeFailHTML(str);\n    }\n  };\n\n  if (!window.WebGLRenderingContext) {\n    //showLink(GET_A_WEBGL_BROWSER);\n    return null;\n  }\n\n  var context = create3DContext(canvas, opt_attribs);\n  if (!context) {\n    //showLink(OTHER_PROBLEM);\n  }\n  return context;\n};\n\n/**\n * Creates a webgl context.\n * @param {!Canvas} canvas The canvas tag to get context\n *     from. If one is not passed in one will be created.\n * @return {!WebGLContext} The created context.\n */\nvar create3DContext = function(canvas, opt_attribs) {\n  var names = [\"webgl\", \"experimental-webgl\"];\n  var context = null;\n  for (var ii = 0; ii < names.length; ++ii) {\n    try {\n      context = canvas.getContext(names[ii], opt_attribs);\n    } catch(e) {}\n    if (context) {\n      break;\n    }\n  }\n  return context;\n}\n\nvar updateCSSIfInIFrame = function() {\n  if (isInIFrame()) {\n    document.body.className = \"iframe\";\n  }\n};\n\n/**\n * Gets a WebGL context.\n * makes its backing store the size it is displayed.\n */\nvar getWebGLContext = function(canvas, opt_attribs) {\n  if (isInIFrame()) {\n    updateCSSIfInIFrame();\n\n    // make the canvas backing store the size it's displayed.\n    canvas.width = canvas.clientWidth;\n    canvas.height = canvas.clientHeight;\n  }\n\n  var gl = setupWebGL(canvas, opt_attribs);\n  return gl;\n};\n\n/**\n * Loads a shader.\n * @param {!WebGLContext} gl The WebGLContext to use.\n * @param {string} shaderSource The shader source.\n * @param {number} shaderType The type of shader.\n * @param {function(string): void) opt_errorCallback callback for errors.\n * @return {!WebGLShader} The created shader.\n */\nvar loadShader = function(gl, shaderSource, shaderType, opt_errorCallback) {\n  var errFn = opt_errorCallback || error;\n  // Create the shader object\n  var shader = gl.createShader(shaderType);\n\n  // Load the shader source\n  gl.shaderSource(shader, shaderSource);\n\n  // Compile the shader\n  gl.compileShader(shader);\n\n  // Check the compile status\n  var compiled = gl.getShaderParameter(shader, gl.COMPILE_STATUS);\n  if (!compiled) {\n    // Something went wrong during compilation; get the error\n    lastError = gl.getShaderInfoLog(shader);\n    errFn(\"*** Error compiling shader '\" + shader + \"':\" + lastError);\n    gl.deleteShader(shader);\n    return null;\n  }\n\n  return shader;\n}\n\n/**\n * Creates a program, attaches shaders, binds attrib locations, links the\n * program and calls useProgram.\n * @param {!Array.<!WebGLShader>} shaders The shaders to attach\n * @param {!Array.<string>} opt_attribs The attribs names.\n * @param {!Array.<number>} opt_locations The locations for the attribs.\n * @param {function(string): void) opt_errorCallback callback for errors.\n */\nvar loadProgram = function(\n    gl, shaders, opt_attribs, opt_locations, opt_errorCallback) {\n  var errFn = opt_errorCallback || error;\n  var program = gl.createProgram();\n  for (var ii = 0; ii < shaders.length; ++ii) {\n    gl.attachShader(program, shaders[ii]);\n  }\n  if (opt_attribs) {\n    for (var ii = 0; ii < opt_attribs.length; ++ii) {\n      gl.bindAttribLocation(\n          program,\n          opt_locations ? opt_locations[ii] : ii,\n          opt_attribs[ii]);\n    }\n  }\n  gl.linkProgram(program);\n\n  // Check the link status\n  var linked = gl.getProgramParameter(program, gl.LINK_STATUS);\n  if (!linked) {\n      // something went wrong with the link\n      lastError = gl.getProgramInfoLog (program);\n      errFn(\"Error in program linking:\" + lastError);\n\n      gl.deleteProgram(program);\n      return null;\n  }\n  return program;\n};\n\n/**\n * Loads a shader from a script tag.\n * @param {!WebGLContext} gl The WebGLContext to use.\n * @param {string} scriptId The id of the script tag.\n * @param {number} opt_shaderType The type of shader. If not passed in it will\n *     be derived from the type of the script tag.\n * @param {function(string): void) opt_errorCallback callback for errors.\n * @return {!WebGLShader} The created shader.\n */\nvar createShaderFromScript = function(\n    gl, scriptId, opt_shaderType, opt_errorCallback) {\n  var shaderSource = \"\";\n  var shaderType;\n  var shaderScript = document.getElementById(scriptId);\n  if (!shaderScript) {\n    throw(\"*** Error: unknown script element\" + scriptId);\n  }\n  shaderSource = shaderScript.text;\n\n  if (!opt_shaderType) {\n    if (shaderScript.type == \"x-shader/x-vertex\") {\n      shaderType = gl.VERTEX_SHADER;\n    } else if (shaderScript.type == \"x-shader/x-fragment\") {\n      shaderType = gl.FRAGMENT_SHADER;\n    } else if (shaderType != gl.VERTEX_SHADER && shaderType != gl.FRAGMENT_SHADER) {\n      throw(\"*** Error: unknown shader type\");\n      return null;\n    }\n  }\n\n  return loadShader(\n      gl, shaderSource, opt_shaderType ? opt_shaderType : shaderType,\n      opt_errorCallback);\n};\n\nvar defaultShaderType = [\n  \"VERTEX_SHADER\",\n  \"FRAGMENT_SHADER\"\n];\n\n/**\n * Creates a program from 2 script tags.\n *\n * @param {!WebGLContext} gl The WebGLContext to use.\n * @param {!Array.<string>} shaderScriptIds Array of ids of the\n *        script tags for the shaders. The first is assumed to\n *        be the vertex shader, the second the fragment shader.\n * @param {!Array.<string>} opt_attribs The attribs names.\n * @param {!Array.<number>} opt_locations The locations for the attribs.\n * @param {function(string): void) opt_errorCallback callback for errors.\n * @return {!WebGLProgram} The created program.\n */\nvar createProgramFromScripts = function(\n    gl, shaderScriptIds, opt_attribs, opt_locations, opt_errorCallback) {\n  var shaders = [];\n  for (var ii = 0; ii < shaderScriptIds.length; ++ii) {\n    shaders.push(createShaderFromScript(\n        gl, shaderScriptIds[ii], gl[defaultShaderType[ii]], opt_errorCallback));\n  }\n  return loadProgram(gl, shaders, opt_attribs, opt_locations, opt_errorCallback);\n};\n\n\n// Add your prefix here.\nvar browserPrefixes = [\n  \"\",\n  \"MOZ_\",\n  \"OP_\",\n  \"WEBKIT_\"\n];\n\n/**\n * Given an extension name like WEBGL_compressed_texture_s3tc\n * returns the supported version extension, like\n * WEBKIT_WEBGL_compressed_teture_s3tc\n * @param {string} name Name of extension to look for\n * @return {WebGLExtension} The extension or undefined if not\n *     found.\n */\nvar getExtensionWithKnownPrefixes = function(gl, name) {\n  for (var ii = 0; ii < browserPrefixes.length; ++ii) {\n    var prefixedName = browserPrefixes[ii] + name;\n    var ext = gl.getExtension(prefixedName);\n    if (ext) {\n      return ext;\n    }\n  }\n};\n\n\n/**\n * Resize a canvas to match the size it's displayed.\n * @param {!Canvas} canvas The canvas to resize.\n */\nvar resizeCanvasToDisplaySize = function(canvas) {\n  if (canvas.width != canvas.clientWidth ||\n      canvas.height != canvas.clientHeight) {\n    canvas.width = canvas.clientWidth;\n    canvas.height = canvas.clientHeight;\n  }\n}\n\n/**\n * Provides requestAnimationFrame in a cross browser way.\n */\nvar requestAnimFrame = (function() {\n  return window.requestAnimationFrame ||\n         window.webkitRequestAnimationFrame ||\n         window.mozRequestAnimationFrame ||\n         window.oRequestAnimationFrame ||\n         window.msRequestAnimationFrame ||\n         function(/* function FrameRequestCallback */ callback, /* DOMElement Element */ element) {\n           return window.setTimeout(callback, 1000/60);\n         };\n})();\n\n/**\n * Provides cancelRequestAnimationFrame in a cross browser way.\n */\nvar cancelRequestAnimFrame = (function() {\n  return window.cancelCancelRequestAnimationFrame ||\n         window.webkitCancelRequestAnimationFrame ||\n         window.mozCancelRequestAnimationFrame ||\n         window.oCancelRequestAnimationFrame ||\n         window.msCancelRequestAnimationFrame ||\n         window.clearTimeout;\n})();\n\nreturn {\n  createProgram: loadProgram,\n  createProgramFromScripts: createProgramFromScripts,\n  createShaderFromScriptElement: createShaderFromScript,\n  getWebGLContext: getWebGLContext,\n  updateCSSIfInIFrame: updateCSSIfInIFrame,\n  getExtensionWithKnownPrefixes: getExtensionWithKnownPrefixes,\n  resizeCanvasToDisplaySize: resizeCanvasToDisplaySize,\n  requestAnimFrame: requestAnimFrame,\n  cancelRequestAnimFrame: cancelRequestAnimFrame\n};\n\n};\n\n},{}]},{},[2]);\n"]}
=======
{"version":3,"sources":["infragram.js"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","module","urlHash","getUrlHashParameter","param","params","getUrlHashParameters","sPageURL","window","location","hash","split","pairs","object","forEach","pair","setUrlHashParameters","keys","Object","values","key","push","join","setUrlHashParameter","value","Infragram","options","uploader","processor","camera","colorized","mode","video_live","webGlSupported","processors","file","logger","Interface","console","log","type","colorize","map","run","save_log","video","initialize","interval","setInterval","image","getSnapshot","download","downloadImage","Camera","Colormaps","greyscale_colormap","segmented_colormap","colormap1","colormap2","JsImage","segments","x","l","len","m","ref","result","x0","x1","xstart","y0","y1","colorify","jsImage","colormap","b","data","g","j","$","addClass","width","height","Uint8ClampedArray","Converters","hsv2rgb","h","s","v","q","rgb","Math","floor","rgb2hsv","d","max","min","FileUpload","socket","serverFilename","isLoadedFromFile","getFilename","setFilename","name","uploadThumbnail","src","callback","img","Image","onload","onImageLoad","canvas","ctx","dataUrl","document","createElement","getContext","drawImage","toString","toDataURL","emit","fromFile","files","upload","reader","prop","FileReader","onReaderLoad","event","size","target","uploaded","readAsDataURL","duplicate","fromBase64","rememberTransport","transports","io","connect","protocol","host","on","newFile","txt","html","round","slice","alert","eval","getUserMedia","webRtcOptions","success","deviceError","videoEl","setAttribute","webcam","getElementById","show","el","extern","append","debug","onCapture","onWebRtcCapture","save","onSave","onSaveGetUserMedia","onLoad","onLoadGetUserMedia","col","tmp","w","pos","parseInt","putImageData","stream","context","navigator","mozGetUserMedia","mozSrcObject","srcObject","onerror","stop","error","getElementsByTagName","updateImage","hide","capture","File","format","lnk","href","getCurrentImage","match","Date","toISOString","replace","createEvent","initMouseEvent","dispatchEvent","fireEvent","fetchImage","filename","substring","val","change","button","click","save_infragrammar_expressions","run_infragrammar","run_colorize","Logger","log_mono","logEntry","log_hsv","log_rgb","javascriptProcessor","b_exp","g_exp","get_channels","converters","ndvi","r_exp","set_mode","update_colorbar","mkImage","Float32Array","nirJsImg","visJsImg","Float64Array","infragrammar","removeClass","infragrammar_mono","render","getImageData","copyToImageData","imageData","k","ref1","style","display","textContent","toFixed","update","ndvi_jsImg","normalize","resultJsImage","save_expressions","save_expressions_hsv","getJsImage","new_mode","imgCanvas","videoWidth","videoHeight","webglProcessor","imgContext","mapContext","inputImage","vertices","waitForShadersToLoad","webglUtils","colormaps","default","stretched","grey","itemSize","shaderVertPath","shaderFragPath","createContext","decolorize","load","glShaderLoaded","selColormap","createBuffer","buffer","gl","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","createTexture","textureUnit","texture","activeTexture","bindTexture","TEXTURE_2D","pixelStorei","UNPACK_FLIP_Y_WEBGL","texImage2D","RGBA","UNSIGNED_BYTE","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","TEXTURE_MAG_FILTER","NEAREST","TEXTURE_MIN_FILTER","slider","canvasName","expression","updateShader","addEventListener","preventDefault","glRestoreContext","getWebGLContext","getExtension","vertexBuffer","framebuffer","createFramebuffer","imageTexture","TEXTURE0","drawScene","returnImage","pColormap","pHsvUniform","pColorizedUniform","pSampler","pSelColormapUniform","pSliderUniform","pVertexPosition","requestAnimationFrame","shaderProgram","generateShader","viewport","useProgram","getAttribLocation","enableVertexAttribArray","vertexAttribPointer","FLOAT","getUniformLocation","uniform1i","uniform1f","drawArrays","TRIANGLE_STRIP","toLowerCase","includes","createProgramFromScripts","setMode","newMode","getInputImage","imageToBase64","dataURL","saveExpression","Analysis","save_infragrammar_inputs","submit","Colorize","css","Fullscreen","fullscreen","innerWidth","imageSelector","fileSelector","Presets","Saving","args","ready","uploadable","idNameMap","localStorage","getItem","setGrid","parametersObject","search","fetch_image","modal","toggle","toggleClass","scale","ratio","setItem","delay","fadeOut","tooltip","popover","saveImage","sendThumbnail","JSON","stringify","data1","width1","height1","channels","imgData","set","maxs","mins","results","lastError","msg","loggingOff","isInIFrame","top","glEnumToString","makeFailHTML","GET_A_WEBGL_BROWSER","OTHER_PROBLEM","setupWebGL","opt_attribs","showLink","str","container","parentNode","innerHTML","WebGLRenderingContext","create3DContext","names","ii","updateCSSIfInIFrame","body","className","clientWidth","clientHeight","loadShader","shaderSource","shaderType","opt_errorCallback","errFn","shader","createShader","compileShader","compiled","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","deleteShader","loadProgram","shaders","opt_locations","program","createProgram","attachShader","bindAttribLocation","linkProgram","linked","getProgramParameter","LINK_STATUS","getProgramInfoLog","deleteProgram","createShaderFromScript","scriptId","opt_shaderType","shaderScript","text","VERTEX_SHADER","FRAGMENT_SHADER","defaultShaderType","shaderScriptIds","browserPrefixes","getExtensionWithKnownPrefixes","prefixedName","ext","resizeCanvasToDisplaySize","requestAnimFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","element","setTimeout","cancelRequestAnimFrame","cancelCancelRequestAnimationFrame","webkitCancelRequestAnimationFrame","mozCancelRequestAnimationFrame","oCancelRequestAnimationFrame","msCancelRequestAnimationFrame","clearTimeout","createShaderFromScriptElement"],"mappings":"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","file":"infragram.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){\nfunction urlHash() {\n\nfunction getUrlHashParameter(param) {\n\n  var params = getUrlHashParameters();\n  return params[param];\n\n}\n\nfunction getUrlHashParameters() {\n\n  var sPageURL = window.location.hash;\n  if (sPageURL) sPageURL = sPageURL.split('#')[1];\n  var pairs = sPageURL.split('&');\n  var object = {};\n  pairs.forEach(function(pair, i) {\n    pair = pair.split('=');\n    if (pair[0] != '') object[pair[0]] = pair[1];\n  });\n  return object;\n}\n\n// accepts an object like { paramName: value, paramName1: value }\n// and transforms to: url.com#paramName=value&paramName1=value\nfunction setUrlHashParameters(params) {\n\n  var keys = Object.keys(params);\n  var values = Object.values(params);\n  var pairs = [];\n  keys.forEach(function(key, i) {\n    if (key != '') pairs.push(keys[i] + '=' + values[i]);\n  });\n  var hash = pairs.join('&');\n  window.location.hash = hash;\n\n}\n\nfunction setUrlHashParameter(param, value) {\n\n  var params = getUrlHashParameters();\n  params[param] = value;\n  setUrlHashParameters(params);\n\n}\n\nreturn {\n  getUrlHashParameter:   getUrlHashParameter,\n  getUrlHashParameters:  getUrlHashParameters,\n  setUrlHashParameter:   setUrlHashParameter,\n  setUrlHashParameters:  setUrlHashParameters\n}\n\n}\n\nmodule.exports = urlHash;\n\n},{}],2:[function(require,module,exports){\nwindow.Infragram = function Infragram(options) {\n  options = options || {};\n  options.uploader = options.uploader || false;\n  options.processor = options.processor || 'javascript';\n  options.camera = require('./io/camera')(options);\n  options.colorized      = options.colorized      || false;\n  options.mode           = options.mode           || \"raw\",\n  options.video_live     = options.video_live     || false,\n  options.webGlSupported = options.webGlSupported || false; // move into processor\n\n  options.processors = {\n    'webgl':           require('./processors/webgl'),\n    'javascript':      require('./processors/javascript'),\n  }\n\n  options.processor = options.processors[options.processor](options);\n  options.file = require('./io/file')(options, options.processor);\n  options.logger = require('./logger')(options);\n\n  var Interface = require('./ui/interface')(options); // this can change processor based on URL hash\n  //options.processor.initialize(options); // double initialize after end of processor code?\n  console.log('processor:', options.processor.type)\n\n  options.colorize = function colorize(map) {\n    options.processor.colorize(map);\n  }\n\n  // this should accept an object with parameters r,g,b,h,s,v,m and mode\n  options.run = function run(mode) {\n    options.logger.save_log();\n    return options.processor.run(mode);\n  }\n\n  // split into processor.video() methods\n  options.video = function video() {\n    options.camera.initialize();\n    var interval;\n    if (options.processor.type == \"webgl\") interval = 15;\n    else interval = 150;\n    setInterval(function() {\n      if (image) options.run(options.mode);\n      options.camera.getSnapshot();\n      //if (options.colorized) return options.colorize();\n    }, interval);\n  }\n\n  // TODO: this doesn't work; it just downloads the unmodified image. \n  // probably a timing issue?\n  function download() {\n    //options.run(options.mode);\n    //if (options.colorized) return options.colorize();\n    options.file.downloadImage();\n  }\n\n  return {\n    Camera: options.camera,\n    Interface: Interface,\n    logger: options.logger,\n    run: options.run,\n    colorize: options.colorize,\n    processors: options.processors,\n    download: download,\n    options: options\n  }\n}\nmodule.exports = Infragram;\n\n},{\"./io/camera\":6,\"./io/file\":7,\"./logger\":8,\"./processors/javascript\":9,\"./processors/webgl\":10,\"./ui/interface\":14}],3:[function(require,module,exports){\n// This file was adapted from infragram-js:\n// http://github.com/p-v-o-s/infragram-js.\n\nmodule.exports = function Colormaps(options) {\n\n  var greyscale_colormap = segmented_colormap([[0, [0,   0,   0  ], [255, 255, 255]], \n                                               [1, [255, 255, 255], [255, 255, 255]]]);\n\n  var colormap1 = segmented_colormap([[0,    [0,   0,   255], [38,  195, 195]],\n                                      [0.5,  [0,   150, 0  ], [255, 255, 0  ]],\n                                      [0.75, [255, 255, 0  ], [255, 50,  50 ]]]);\n\n  var colormap2 = segmented_colormap([[0,   [0,   0,   255], [0,   0,   255]], \n                                      [0.1, [0,   0,   255], [38,  195, 195]],\n                                      [0.5, [0,   150, 0  ], [255, 255, 0  ]],\n                                      [0.7, [255, 255, 0  ], [255, 50,  50 ]],\n                                      [0.9, [255, 50,  50 ], [255, 50,  50 ]]]);\n\n  var JsImage = require('../util/JsImage.js');\n\n  function segmented_colormap(segments) {\n    return function(x) {\n      var i, l, len, m, ref, result, x0, x1, xstart, y0, y1;\n      [y0, y1] = [0, 0];\n      [x0, x1] = [segments[0][0], 1];\n      if (x < x0) {\n        return y0;\n      }\n      for (i = l = 0, len = segments.length; l < len; i = ++l) {\n        [xstart, y0, y1] = segments[i];\n        x0 = xstart;\n        if (i === segments.length - 1) {\n          x1 = 1;\n          break;\n        }\n        x1 = segments[i + 1][0];\n        if ((xstart <= x && x < x1)) {\n          break;\n        }\n      }\n      result = [];\n      for (i = m = 0, ref = y0.length; 0 <= ref ? m < ref : m > ref; i = 0 <= ref ? ++m : --m) {\n        result[i] = (x - x0) / (x1 - x0) * (y1[i] - y0[i]) + y0[i];\n      }\n      return result;\n    }\n  }\n\n  function colorify(jsImage, colormap) {\n    var b, data, g, i, j, l, n, r, ref;\n    $('#btn-colorize').addClass('active');\n    n = jsImage.width * jsImage.height;\n    data = new Uint8ClampedArray(4 * n);\n    j = 0;\n    for (i = l = 0, ref = n; 0 <= ref ? l < ref : l > ref; i = 0 <= ref ? ++l : --l) {\n      [r, g, b] = colormap(jsImage.data[i]);\n      data[j++] = r;\n      data[j++] = g;\n      data[j++] = b;\n      data[j++] = 255;\n    }\n    return new JsImage(data, jsImage.width, jsImage.height, 4);\n  }\n\n  return {\n    colorify: colorify,\n    colormap1: colormap1,\n    colormap2: colormap2,\n    greyscale_colormap: greyscale_colormap,\n    segmented_colormap: segmented_colormap\n  }\n\n}\n\n},{\"../util/JsImage.js\":17}],4:[function(require,module,exports){\n// This file was adapted from infragram-js:\n// http://github.com/p-v-o-s/infragram-js.\n\nmodule.exports = window.Converters = {\n\n  // modified from:\n  // http://axonflux.com/handy-rgb-to-hsl-and-rgb-to-hsv-color-model-c\n  hsv2rgb: function hsv2rgb(h, s, v) {\n    var data, f, i, p, q, rgb, t;\n    data = [];\n    if (s === 0) {\n      rgb = [v, v, v];\n    } else {\n      i = Math.floor(h * 6);\n      f = h * 6 - i;\n      p = v * (1 - s);\n      q = v * (1 - f * s);\n      t = v * (1 - (1 - f) * s);\n      data = [v * (1 - s), v * (1 - s * (h - i)), v * (1 - s * (1 - (h - i)))];\n      switch (i) {\n        case 0:\n          rgb = [v, t, p];\n          break;\n        case 1:\n          rgb = [q, v, p];\n          break;\n        case 2:\n          rgb = [p, v, t];\n          break;\n        case 3:\n          rgb = [p, q, v];\n          break;\n        case 4:\n          rgb = [t, p, v];\n          break;\n        default:\n          rgb = [v, p, q];\n      }\n    }\n    return rgb;\n  },\n\n  rgb2hsv: function rgb2hsv(r, g, b) {\n    var d, h, max, min, s, v;\n    max = Math.max(r, g, b);\n    min = Math.min(r, g, b);\n    h = s = v = max;\n    d = max - min;\n    s = max === 0 ? 0 : d / max;\n    if (max === min) {\n      h = 0; // achromatic\n    } else {\n      switch (max) {\n        case r:\n          h = (g - b) / d + (g < b ? 6 : 0);\n          break;\n        case g:\n          h = (b - r) / d + 2;\n          break;\n        case b:\n          h = (r - g) / d + 4;\n      }\n      h /= 6;\n    }\n    return [h, s, v];\n  }\n\n}\n\n},{}],5:[function(require,module,exports){\n// Generated by CoffeeScript 2.1.0\n// This file was adapted from infragram-js:\n// http://github.com/p-v-o-s/infragram-js.\nmodule.exports = window.FileUpload = {\n\n  socket: null,\n  file: null,\n  serverFilename: \"\",\n\n  isLoadedFromFile: function() {\n    if (FileUpload.file) {\n      return true;\n    } else {\n      return false;\n    }\n  },\n\n  getFilename: function() {\n    return FileUpload.serverFilename;\n  },\n\n  setFilename: function(name) {\n    return FileUpload.serverFilename = name;\n  },\n\n  uploadThumbnail: function(src, callback) {\n    var img;\n    img = new Image();\n    img.onload = function onImageLoad() {\n      var canvas, ctx, dataUrl;\n      canvas = document.createElement(\"canvas\");\n      ctx = canvas.getContext(\"2d\");\n      canvas.width = 260;\n      canvas.height = 195;\n      ctx.drawImage(this, 0, 0, this.width, this.height, 0, 0, canvas.width, canvas.height);\n      callback = callback.toString();\n      dataUrl = canvas.toDataURL(\"image/jpeg\");\n      return FileUpload.socket.emit(\"thumbnail_start\", {\n        \"name\": FileUpload.serverFilename,\n        \"data\": dataUrl,\n        \"callback\": callback\n      });\n    };\n    return img.src = src;\n  },\n\n  fromFile: function(files, callback, upload) {\n    var reader;\n    if (files && files[0]) {\n      $(\"#file-sel\").prop(\"disabled\", true);\n      $(\"#save-modal-btn\").prop(\"disabled\", true);\n      FileUpload.file = files[0];\n      FileUpload.file.reader = new FileReader();\n      if (upload) {\n        FileUpload.file.reader.onload = function onReaderLoad(event) {\n          return FileUpload.socket.emit(\"image_send\", {\n            \"name\": FileUpload.serverFilename,\n            \"size\": FileUpload.file.size,\n            \"data\": event.target.result\n          });\n        };\n        FileUpload.socket.emit(\"image_send\", {\n          \"name\": files[0].name,\n          \"size\": files[0].size\n        });\n      }\n      FileUpload.file.uploaded = 0;\n      reader = new FileReader();\n      reader.onload = function onReaderLoad(event) {\n        var img;\n        img = new Image();\n        img.onload = function onImageLoad() {\n          return callback(this);\n        };\n        return img.src = event.target.result;\n      };\n      return reader.readAsDataURL(files[0]);\n    }\n  },\n\n  duplicate: function(callback) {\n    callback = callback.toString();\n    return FileUpload.socket.emit(\"duplicate_start\", {\n      \"name\": FileUpload.serverFilename,\n      \"callback\": callback\n    });\n  },\n\n  fromBase64: function(name, data, callback) {\n    callback = callback.toString();\n    return FileUpload.socket.emit(\"base64_start\", {\n      \"name\": name,\n      \"data\": data,\n      \"callback\": callback\n    });\n  },\n\n  initialize: function(options) {\n    options = options || {};\n    options.rememberTransport = options.rememberTransport || false;\n    options.transports = options.transports || ['websocket', 'AJAX long-polling'];\n\n    if (options.socket) {\n      FileUpload.socket = io.connect(window.location.protocol + \"//\" + window.location.host, options);\n      FileUpload.socket.on(\"image_request\", function(data) {\n        var file, newFile, txt;\n        file = FileUpload.file;\n        txt = $(\"#save-modal-btn\").html().split(/\\s-\\s/g)[0];\n        txt += \" - \" + Math.round((file.uploaded / file.size) * 100) + \"%\";\n        $(\"#save-modal-btn\").html(txt);\n        newFile = file.slice(file.uploaded, file.uploaded + Math.min(data[\"chunk\"], file.size - file.uploaded));\n        FileUpload.file.uploaded += data[\"chunk\"];\n        FileUpload.serverFilename = data[\"name\"];\n        return file.reader.readAsDataURL(newFile);\n      });\n      FileUpload.socket.on(\"image_done\", function(data) {\n        var txt;\n        if (data[\"error\"]) {\n          alert(data[\"error\"]);\n        } else {\n          FileUpload.serverFilename = data[\"name\"];\n        }\n        txt = $(\"#save-modal-btn\").html().split(/\\s-\\s/g)[0];\n        $(\"#save-modal-btn\").html(txt);\n        $(\"#file-sel\").prop(\"disabled\", false);\n        return $(\"#save-modal-btn\").prop(\"disabled\", false);\n      });\n      FileUpload.socket.on(\"base64_done\", function(data) {\n        FileUpload.serverFilename = data[\"name\"];\n        eval(\"var callback=\" + data[\"callback\"]);\n        return callback();\n      });\n      FileUpload.socket.on(\"duplicate_done\", function(data) {\n        if (data[\"error\"]) {\n          return alert(data[\"error\"]);\n        } else {\n          FileUpload.serverFilename = data[\"name\"];\n          eval(\"var callback=\" + data[\"callback\"]);\n          return callback();\n        }\n      });\n      FileUpload.socket.on(\"thumbnail_done\", function(data) {\n        eval(\"var callback=\" + data[\"callback\"]);\n        return callback();\n      });\n    }\n\n  }\n}\n\n},{}],6:[function(require,module,exports){\n// This file was adapted from infragram-js:\n// http://github.com/p-v-o-s/infragram-js.\nmodule.exports = function Camera(options) {\n  var canvas, \n      ctx;\n\n  // Initialize getUserMedia with options\n  function initialize() {\n    getUserMedia(webRtcOptions, success, deviceError);\n\n    // iOS Safari 11 compatibility: https://github.com/webrtc/adapter/issues/685\n    webRtcOptions.videoEl.setAttribute('autoplay', 'autoplay');\n    webRtcOptions.videoEl.setAttribute('playsinline', 'playsinline');\n\n    window.webcam = webRtcOptions; // this is weird but maybe used for flash fallback?\n    canvas = options.canvas || document.getElementById(\"image\");\n    ctx = canvas.getContext(\"2d\");\n    // Trigger a snapshot w/ button\n    // -- move this to interface.js?\n    $(\"#snapshot\").show();\n    $(\"#live-video\").show();\n    $(\"#webcam\").show();\n  }\n\n  // webRtcOptions contains the configuration information for the shim\n  // it allows us to specify the width and height of the video\n  // output we\"re working with, the location of the fallback swf,\n  // events that are triggered onCapture and onSave (for the fallback)\n  // and so on.\n  var webRtcOptions = options.webRtcOptions || {\n    \"audio\": false,\n    \"video\": true,\n    // the element (by id) you wish to use for \n    // displaying the stream from a camera\n    el: \"webcam\",\n    extern: null,\n    append: true,\n    // height and width of the output stream\n    // container\n    width: 640,\n    height: 480,\n    // the recommended mode to be used is \n    // \"callback \" where a callback is executed \n    // once data is available\n    mode: \"callback\",\n    // a debugger callback is available if needed\n    debug: function() {},\n    // callback for capturing the fallback stream\n    onCapture: function onWebRtcCapture() {\n      return window.webcam.save();\n    },\n    // callback for saving the stream, useful for\n    // relaying data further.\n    onSave: onSaveGetUserMedia,\n    onLoad: function onLoadGetUserMedia() {}\n  }\n\n  function onSaveGetUserMedia(data) {\n    var col, h, i, img, j, ref, tmp, w, pos = 0;\n    col = data.split(\"\");\n    img = camera.image;\n    tmp = null;\n    w = webRtcOptions.width;\n    h = webRtcOptions.height;\n    for (i = j = 0, ref = w - 1; 0 <= ref ? j <= ref : j >= ref; i = 0 <= ref ? ++j : --j) {\n      tmp = parseInt(col[i], 10);\n      img.data[pos + 0] = (tmp >> 16) & 0xff;\n      img.data[pos + 1] = (tmp >> 8) & 0xff;\n      img.data[pos + 2] = tmp & 0xff;\n      img.data[pos + 3] = 0xff;\n      pos += 4;\n    }\n    if (pos >= 4 * w * h) {\n      ctx.putImageData(img, 0, 0);\n      return pos = 0;\n    }\n  }\n\n  function success(stream) {\n    var video;\n    if (webRtcOptions.context === \"webrtc\") {\n      video = webRtcOptions.videoEl;\n      if (navigator.mozGetUserMedia) {\n        video.mozSrcObject = stream;\n        console.log(\"mozilla???\");\n      } else {\n        video.srcObject = stream;\n      }\n      return video.onerror = function(e) {\n        return stream.stop();\n      }\n    } else {\n\n    }\n  }\n\n  function deviceError(error) {\n    alert(\"No camera available.\");\n    console.log(error);\n    return console.error(\"An error occurred: [CODE \" + error.code + \"]\");\n  }\n\n  // not doing anything now... for copying to a 2nd canvas\n  function getSnapshot() {\n    var video;\n    // If the current context is WebRTC/getUserMedia (something\n    // passed back from the shim to avoid doing further feature\n    // detection), we handle getting video/images for our canvas \n    // from our HTML5 <video> element.\n    if (webRtcOptions.context === \"webrtc\") {\n      video = document.getElementsByTagName(\"video\")[0];\n      options.processor.updateImage(video);\n      return $(\"#webcam\").hide();\n    // Otherwise, if the context is Flash, we ask the shim to\n    // directly call window.webcam, where our shim is located\n    // and ask it to capture for us.\n    } else if (webRtcOptions.context === \"flash\") {\n      return window.webcam.capture();\n    } else {\n      console.log(\"No context was supplied to getSnapshot()\");\n    }\n  }\n\n  return {\n    getSnapshot: getSnapshot,\n    initialize: initialize,\n    onSaveGetUserMedia: onSaveGetUserMedia,\n    webRtcOptions: webRtcOptions\n  }\n}\n\n},{}],7:[function(require,module,exports){\n// This file was adapted from infragram-js:\n// http://github.com/p-v-o-s/infragram-js.\n\nmodule.exports = function File(options, processor) {\n\n  function downloadImage() {\n    var event, format, lnk;\n    // create an \"off-screen\" anchor tag\n    lnk = document.createElement(\"a\");\n    // the key here is to set the download attribute of the a tag\n    lnk.href = processor.getCurrentImage();\n    if (lnk.href.match('image/jpeg')) {\n      format = \"jpg\";\n    } else {\n      format = \"png\";\n    }\n    lnk.download = (new Date()).toISOString().replace(/:/g, \"_\") + \".\" + format;\n    // create a \"fake\" click-event to trigger the download\n    if (document.createEvent) {\n      event = document.createEvent(\"MouseEvents\");\n      event.initMouseEvent(\"click\", true, true, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);\n      lnk.dispatchEvent(event);\n    } else if (lnk.fireEvent) {\n      lnk.fireEvent(\"onclick\");\n    }\n    return true;\n  }\n\n  // from a local URL (remote may be against js security rules)\n  function fetchImage(src, mode) {\n    var img;\n    $(\"#save-modal-btn\").show();\n    $(\"#save-zone\").show();\n    img = new Image();\n    if (options.uploader) {\n      img.onload = function() {\n        var filename;\n        filename = src.split('/');\n        filename = filename[filename.length - 1];\n        FileUpload.setFilename(filename);\n        if (mode) {\n          if (mode.substring(0, 5) === \"infra\") {\n            $(\"#modeSwitcher\").val(mode).change();\n          } else {\n            $(\"button#\" + mode).button(\"toggle\");\n            $(\"button#\" + mode).click(); // this should be via a direct call, not a click; the show.jade page should not require buttons!\n          }\n        }\n        options.save_infragrammar_expressions(params);\n        if (mode === \"ndvi\") {\n          options.save_infragrammar_expressions({\n            'm': '(R-B)/(R+B)'\n          });\n          mode = \"infragrammar_mono\";\n        } else if (mode === \"nir\") {\n          options.save_infragrammar_expressions({\n            'm': 'R'\n          });\n          mode = \"infragrammar_mono\";\n        } else if (mode === \"raw\") {\n          options.save_infragrammar_expressions({\n            'r': 'R',\n            'g': 'G',\n            'b': 'B'\n          });\n          mode = \"infragrammar\";\n        }\n\tprocessor.updateImage(this);\n        if (params['color'] === \"true\" || params['c'] === \"true\") {\n          options.colorized = true; // before run_infrag, so it gets logged\n        }\n        run_infragrammar(mode); // this sets colorized to false!\n        if (params['color'] === \"true\" || params['c'] === \"true\") {\n          options.colorized = true; // again, so it gets run \n        }\n        if (options.colorized) {\n          $(\"button#color\").button(\"toggle\");\n          return run_colorize();\n        }\n      }\n    }\n    return img.src = src;\n  }\n\n  return {\n    fetchImage: fetchImage,\n    downloadImage: downloadImage\n  }\n\n}\n\n},{}],8:[function(require,module,exports){\n// refactor to access state, not dom\nmodule.exports = function Logger(options) {\n\n  var log = []; // a record of previous commands run\n\n  function log_mono() {\n    var logEntry;\n    logEntry = \"mode=infragrammar_mono\";\n    logEntry += $(\"#m_exp\").val() ? \"&m=\" + $(\"#m_exp\").val() : \"\";\n    logEntry += options.colorized ? \"&c=true\" : \"\"; // no way to succinctly store the colormap... just offer range of colorizations at view-time?\n    return log.push(logEntry);\n  }\n\n  function log_hsv() {\n    var logEntry;\n    logEntry = \"mode=infragrammar_hsv\";\n    logEntry += $(\"#h_exp\").val() ? \"&h=\" + $(\"#h_exp\").val() : \"\";\n    logEntry += $(\"#s_exp\").val() ? \"&s=\" + $(\"#s_exp\").val() : \"\";\n    logEntry += $(\"#v_exp\").val() ? \"&v=\" + $(\"#v_exp\").val() : \"\";\n    return log.push(logEntry);\n  }\n\n  function log_rgb() {\n    var logEntry;\n    logEntry = \"mode=infragrammar\";\n    logEntry += $(\"#r_exp\").val() ? \"&r=\" + $(\"#r_exp\").val() : \"\";\n    logEntry += $(\"#g_exp\").val() ? \"&g=\" + $(\"#g_exp\").val() : \"\";\n    logEntry += $(\"#b_exp\").val() ? \"&b=\" + $(\"#b_exp\").val() : \"\";\n    return log.push(logEntry);\n  }\n\n  function save_log() {\n    if (options.mode === \"infragrammar_mono\") {\n      return log_mono();\n    } else if (options.mode === \"infragrammar_hsv\") {\n      return log_hsv();\n    } else if (options.mode === \"infragrammar\") {\n      return log_rgb();\n    }\n  }\n\n  return {\n    log: log,\n    log_hsv: log_hsv,\n    log_mono: log_mono,\n    log_rgb: log_rgb,\n    save_log: save_log\n  }\n\n}\n\n},{}],9:[function(require,module,exports){\n// This file was adapted from infragram-js:\n// http://github.com/p-v-o-s/infragram-js.\n\n// not currently being used -- will replace with Image Sequencer perhaps?\n// https://github.com/publiclab/image-sequencer\n\nmodule.exports = function javascriptProcessor() {\n\n  var b_exp = \"\",\n      g_exp = \"\",\n      get_channels,\n      Colormaps = require('../color/colormaps')(JsImage),\n      colormap = Colormaps.colormap1,\n      converters = require('../color/converters'),\n      image = null,\n      mode = \"raw\",\n      ndvi,\n      r_exp = \"\",\n      set_mode,\n      update_colorbar;\n\n  var JsImage = require('../util/JsImage.js');\n\n  function get_channels(jsImage) {\n    var b, g, i, l, mkImage, n, r, ref;\n    n = jsImage.width * jsImage.height;\n    r = new Float32Array(n);\n    g = new Float32Array(n);\n    b = new Float32Array(n);\n    for (i = l = 0, ref = n; 0 <= ref ? l < ref : l > ref; i = 0 <= ref ? ++l : --l) {\n      r[i] = jsImage.data[4 * i + 0];\n      g[i] = jsImage.data[4 * i + 1];\n      b[i] = jsImage.data[4 * i + 2];\n    }\n    function mkImage(d) {\n      return new JsImage(d, jsImage.width, jsImage.height, 1);\n    }\n    return [mkImage(r), mkImage(g), mkImage(b)];\n  }\n\n  // replace with infragrammar expression\n  function ndvi(nirJsImg, visJsImg) {\n    var d, i, l, n, ref;\n    n = nirJsImg.width * nirJsImg.height;\n    d = new Float64Array(n);\n    for (i = l = 0, ref = n; 0 <= ref ? l < ref : l > ref; i = 0 <= ref ? ++l : --l) {\n      d[i] = (nirJsImg.data[i] - visJsImg.data[i]) / (nirJsImg.data[i] + visJsImg.data[i]);\n    }\n    return new JsImage(d, nirJsImg.width, nirJsImg.height, 1);\n  }\n\n  function infragrammar(jsImage) {\n    var b, g, i, l, n, o, r, ref;\n    $('#btn-colorize').removeClass('active');\n    n = jsImage.width * jsImage.height;\n    r = new Float32Array(n);\n    g = new Float32Array(n);\n    b = new Float32Array(n);\n    o = new Float32Array(4 * n);\n    for (i = l = 0, ref = n; 0 <= ref ? l < ref : l > ref; i = 0 <= ref ? ++l : --l) {\n      r[i] = jsImage.data[4 * i + 0] / 255;\n      g[i] = jsImage.data[4 * i + 1] / 255;\n      b[i] = jsImage.data[4 * i + 2] / 255;\n      o[4 * i + 0] = 255 * r_exp(r[i], g[i], b[i]);\n      o[4 * i + 1] = 255 * g_exp(r[i], g[i], b[i]);\n      o[4 * i + 2] = 255 * b_exp(r[i], g[i], b[i]);\n      o[4 * i + 3] = 255;\n    }\n    return new JsImage(o, jsImage.width, jsImage.height, 4);\n  }\n\n  function infragrammar_mono(jsImage) {\n    var b, g, i, l, n, o, r, ref;\n    n = jsImage.width * jsImage.height;\n    r = new Float32Array(n);\n    g = new Float32Array(n);\n    b = new Float32Array(n);\n    o = new Float32Array(n);\n    for (i = l = 0, ref = n; 0 <= ref ? l < ref : l > ref; i = 0 <= ref ? ++l : --l) {\n      r[i] = jsImage.data[4 * i + 0] / 255.0;\n      g[i] = jsImage.data[4 * i + 1] / 255.0;\n      b[i] = jsImage.data[4 * i + 2] / 255.0;\n      o[i] = r_exp(r[i], g[i], b[i]);\n    }\n    return new JsImage(o, jsImage.width, jsImage.height, 1);\n  }\n\n  function render(jsImage) {\n    var ctx, d, e;\n    e = $(\"#image\")[0];\n    e.width = jsImage.width;\n    e.height = jsImage.height;\n    ctx = e.getContext(\"2d\");\n    d = ctx.getImageData(0, 0, jsImage.width, jsImage.height);\n    jsImage.copyToImageData(d);\n    return ctx.putImageData(d, 0, 0);\n  }\n\n  function colorize() {\n    var imageData = getImageData();\n    render(\n      Colormaps.colorify(infragrammar_mono(imageData), function(x) {\n        return colormap((x + 1) / 2);\n      })\n    );\n    return true;\n  }\n\n  update_colorbar = (min, max) => {\n    var b, ctx, d, e, g, i, j, k, l, m, r, ref, ref1;\n    $('#colorbar-container')[0].style.display = 'inline-block';\n    e = $('#colorbar')[0];\n    ctx = e.getContext(\"2d\");\n    d = ctx.getImageData(0, 0, e.width, e.height);\n    for (i = l = 0, ref = e.width; 0 <= ref ? l < ref : l > ref; i = 0 <= ref ? ++l : --l) {\n      for (j = m = 0, ref1 = e.height; 0 <= ref1 ? m < ref1 : m > ref1; j = 0 <= ref1 ? ++m : --m) {\n        [r, g, b] = colormap(i / e.width);\n        k = 4 * (i + j * e.width);\n        d.data[k + 0] = r;\n        d.data[k + 1] = g;\n        d.data[k + 2] = b;\n        d.data[k + 3] = 255;\n      }\n    }\n    ctx.putImageData(d, 0, 0);\n    $(\"#colorbar-min\")[0].textContent = min.toFixed(2);\n    return $(\"#colorbar-max\")[0].textContent = max.toFixed(2);\n  }\n\n  function update(image) {\n    var b, g, max, min, ndvi_jsImg, normalize, r, resultJsImage;\n    $('#colorbar-container')[0].style.display = 'none';\n    if (mode === \"ndvi\") {\n      [r, g, b] = get_channels(image);\n      ndvi_jsImg = ndvi(r, b);\n      // this isn't correct for NDVI; we want values from -1 to 1:\n      // [[min],[max]] = ndvi_img.extrema()\n      min = -1;\n      max = 1;\n      function normalize(x) {\n        return (x - min) / (max - min);\n      };\n      resultJsImage = Colormaps.colorify(ndvi_jsImg, function(x) {\n        return colormap(normalize(x));\n      });\n      update_colorbar(min, max);\n    } else if (mode === \"raw\") {\n      resultJsImage = new JsImage(image.data, image.width, image.height, 4);\n    } else if (mode === \"nir\") {\n      [r, g, b] = get_channels(image);\n      resultJsImage = Colormaps.colorify(r, function(x) {\n        return [x, x, x];\n      });\n    } else {\n      resultJsImage = infragrammar(image);\n    }\n    return render(resultJsImage);\n  }\n\n  function save_expressions(r, g, b) {\n    if (r === \"\") {\n      r = \"R\";\n    }\n    if (g === \"\") {\n      g = \"G\";\n    }\n    if (b === \"\") {\n      b = \"B\";\n    }\n    eval(\"r_exp = function(R,G,B){var r=R,g=G,b=B;return \" + r + \";}\");\n    eval(\"g_exp = function(R,G,B){var r=R,g=G,b=B;return \" + g + \";}\");\n    return eval(\"b_exp = function(R,G,B){var r=R,g=G,b=B;return \" + b + \";}\");\n  };\n\n  function save_expressions_hsv(h, s, v) {\n    if (h === \"\") {\n      h = \"H\";\n    }\n    if (s === \"\") {\n      s = \"S\";\n    }\n    if (v === \"\") {\n      v = \"V\";\n    }\n    eval(\"r_exp = function(R,G,B){var h=H,s=S,v=V,hsv = converters.rgb2hsv(R, G, B), H = hsv[0], S = hsv[1], V = hsv[2]; return converters.hsv2rgb(\" + h + \",\" + s + \",\" + v + \")[0];}\");\n    eval(\"g_exp = function(R,G,B){var h=H,s=S,v=V,hsv = converters.rgb2hsv(R, G, B), H = hsv[0], S = hsv[1], V = hsv[2]; return converters.hsv2rgb(\" + h + \",\" + s + \",\" + v + \")[1];}\");\n    return eval(\"b_exp = function(R,G,B){var h=H,s=S,v=V,hsv = converters.rgb2hsv(R, G, B), H = hsv[0], S = hsv[1], V = hsv[2]; return converters.hsv2rgb(\" + h + \",\" + s + \",\" + v + \")[2];}\");\n  }\n\n  function getImageData() {\n    var ctx = $('#image')[0].getContext(\"2d\");\n// risks being circular def of width/height\n    var width = $('#image').width();\n    var height = $('#image').height();\n// this now just defaults to file-scoped 'image' which we want to avoid\n    return image || ctx.getImageData(0, 0, width, height);\n  }\n\n  function getJsImage() {\n    var imageData = getImageData();\n    return new JsImage(imageData.data, imageData.width, imageData.height, 1);\n  }\n\n  function set_mode(new_mode) {\n    mode = new_mode;\n    update(getImageData());\n    if (mode === \"ndvi\") {\n      // TODO: move this into interface code:\n      return $(\"#colormaps-group\")[0].style.display = \"inline-block\";\n    } else {\n      if ($(\"#colormaps-group\").length > 0) {\n        return $(\"#colormaps-group\")[0].style.display = \"none\";\n      }\n    }\n  }\n\n  // img should be a native JavaScript image obj\n  function updateImage(img) {\n    var ctx, height, imgCanvas, width;\n    imgCanvas = document.getElementById(\"image\");\n    ctx = imgCanvas.getContext(\"2d\");\n    width = img.videoWidth || img.width;\n    height = img.videoHeight || img.height;\n    ctx.drawImage(img, 0, 0, width, height, 0, 0, imgCanvas.width, imgCanvas.height);\n    image = ctx.getImageData(0, 0, imgCanvas.width, imgCanvas.height);\n    return set_mode(mode);\n  }\n\n  function run(mode) {\n    return set_mode(mode);\n  }\n\n  function getCurrentImage() {\n    var ctx, e;\n    e = $(\"#image\")[0];\n    ctx = e.getContext(\"2d\");\n    return ctx.canvas.toDataURL(\"image/jpeg\");\n  }\n\n  return {\n    type: 'javascript',\n    colormap: colormap,\n    getCurrentImage: getCurrentImage,\n    getImageData: getImageData,\n    getJsImage: getJsImage,\n    infragrammar_mono: infragrammar_mono,\n    infragrammar: infragrammar,\n    render: render,\n    run: run,\n    save_expressions: save_expressions,\n    save_expressions_hsv: save_expressions_hsv,\n    update: update,\n    updateImage: updateImage,\n    colorize: colorize,\n    initialize: function() {}\n  }\n\n}\n\n},{\"../color/colormaps\":3,\"../color/converters\":4,\"../util/JsImage.js\":17}],10:[function(require,module,exports){\n// Generated by CoffeeScript 2.1.0\n// This file was adapted from infragram-js:\n// http://github.com/p-v-o-s/infragram-js.\nmodule.exports = function webglProcessor(options) {\n\n  var imgContext = null,\n      mapContext = null,\n      inputImage, // the pre-processed image\n      vertices = [-1.0, -1.0, -1.0, 1.0, 1.0, -1.0, 1.0, 1.0],\n      waitForShadersToLoad = 0,\n      webglUtils = require('../util/webgl-utils')(),\n      colorized = false,\n      colormaps = {\n        default: 0,\n        stretched: 2,\n        grey: 1\n      },\n      colormap = colormaps.default;\n\n  vertices.itemSize = 2;\n\n  function initialize(options) {\nconsole.log(options, 'webgl');\n    options = options || {};\n    options.shaderVertPath = options.shaderVertPath || \"dist/shader.vert\";\n    options.shaderFragPath = options.shaderFragPath || \"dist/shader.frag\";\n    imgContext = createContext(\"raw\", 1, 0, 1.0, \"image\");\n    mapContext = createContext(\"raw\", 1, 1, 1.0, \"colorbar\");\n    decolorize();\n    waitForShadersToLoad = 2;\n    $(\"#shader-vs\").load(options.shaderVertPath, glShaderLoaded);\n    $(\"#shader-fs-template\").load(options.shaderFragPath, glShaderLoaded);\n    if (imgContext && mapContext) {\n      return true;\n    } else {\n      return false;\n    }\n  };\n\n  function colorize(val) {\n    if (val === \"hsv\") run('hsv');\n    else {\n      val = val || colormap;\n      colormap = val;\n      console.log('colorize:' + val);\n      if (typeof val === 'string') val = colormaps[val];\n      imgContext.selColormap = mapContext.selColormap = val;\n      colorized = true;\n    }\n  }\n\n  function decolorize() {\n    colorized = false;\n  }\n\n  function createBuffer(ctx, data) {\n    var buffer, gl;\n    gl = ctx.gl;\n    buffer = gl.createBuffer();\n    gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(data), gl.STATIC_DRAW);\n    buffer.itemSize = data.itemSize;\n    return buffer;\n  };\n\n  function createTexture(ctx, textureUnit) {\n    var gl, texture;\n    gl = ctx.gl;\n    texture = gl.createTexture();\n    gl.activeTexture(textureUnit);\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n    gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, true);\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, ctx.canvas.width, ctx.canvas.height, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n    return texture;\n  };\n\n  function createContext(mode, selColormap, colormap, slider, canvasName) {\n    var ctx;\n    ctx = new Object();\n    ctx.mode = mode;\n    ctx.expression = [\"\", \"\", \"\"];\n    ctx.selColormap = selColormap;\n    ctx.colormap = colormap;\n    ctx.slider = slider;\n    ctx.updateShader = true;\n    ctx.canvas = document.getElementById(canvasName);\n    ctx.canvas.addEventListener(\"webglcontextlost\", (function(event) {\n      return event.preventDefault();\n    }), false);\n    ctx.canvas.addEventListener(\"webglcontextrestored\", glRestoreContext, false);\n    ctx.gl = webglUtils.getWebGLContext(ctx.canvas);\n    if (ctx.gl) {\n      ctx.gl.getExtension(\"OES_texture_float\");\n      ctx.vertexBuffer = createBuffer(ctx, vertices);\n      ctx.framebuffer = ctx.gl.createFramebuffer();\n      ctx.imageTexture = createTexture(ctx, ctx.gl.TEXTURE0);\n      return ctx;\n    } else {\n      return null;\n    }\n  };\n\n  function drawScene(ctx, returnImage) {\n    var gl, pColormap, pHsvUniform, pColorizedUniform, pSampler, pSelColormapUniform, pSliderUniform, pVertexPosition;\n    if (!returnImage) {\n      window.requestAnimationFrame(function() {\n        return drawScene(ctx, false);\n      });\n    }\n    if (ctx.updateShader) {\n      ctx.updateShader = false;\n      ctx.shaderProgram = generateShader(ctx);\n    }\n    gl = ctx.gl;\n    gl.viewport(0, 0, ctx.canvas.width, ctx.canvas.height);\n    gl.useProgram(ctx.shaderProgram);\n    gl.bindBuffer(gl.ARRAY_BUFFER, ctx.vertexBuffer);\n    pVertexPosition = gl.getAttribLocation(ctx.shaderProgram, \"aVertexPosition\");\n    gl.enableVertexAttribArray(pVertexPosition);\n    gl.vertexAttribPointer(pVertexPosition, ctx.vertexBuffer.itemSize, gl.FLOAT, false, 0, 0);\n    pSampler = gl.getUniformLocation(ctx.shaderProgram, \"uSampler\");\n    gl.uniform1i(pSampler, 0);\n    pSliderUniform = gl.getUniformLocation(ctx.shaderProgram, \"uSlider\");\n    gl.uniform1f(pSliderUniform, ctx.slider);\n\n    pColorizedUniform = gl.getUniformLocation(ctx.shaderProgram, \"uColorized\");\n    gl.uniform1i(pColorizedUniform, (colorized || ctx.colormap ? 1 : 0));\n\n    pSelColormapUniform = gl.getUniformLocation(ctx.shaderProgram, \"uSelectColormap\");\n    gl.uniform1i(pSelColormapUniform, ctx.selColormap);\n\n    pHsvUniform = gl.getUniformLocation(ctx.shaderProgram, \"uHsv\");\n    gl.uniform1i(pHsvUniform, (ctx.mode === \"hsv\" ? 1 : 0));\n    pColormap = gl.getUniformLocation(ctx.shaderProgram, \"uColormap\");\n    gl.uniform1i(pColormap, (ctx.colormap ? 1 : 0));\n    gl.drawArrays(gl.TRIANGLE_STRIP, 0, vertices.length / vertices.itemSize);\n\n    if (returnImage) return ctx.canvas.toDataURL(\"image/jpeg\");\n  };\n\n  function generateShader(ctx) {\n    var b, code, g, r;\n    [r, g, b] = ctx.expression;\n    // Map HSV to shader variable names\n    r = r.toLowerCase().replace(/h/g, \"r\").replace(/s/g, \"g\").replace(/v/g, \"b\");\n    g = g.toLowerCase().replace(/h/g, \"r\").replace(/s/g, \"g\").replace(/v/g, \"b\");\n    b = b.toLowerCase().replace(/h/g, \"r\").replace(/s/g, \"g\").replace(/v/g, \"b\");\n    // Sanitize strings\n    r = r.replace(/[^xrgb\\/\\-\\+\\*\\(\\)\\.0-9]*/g, \"\");\n    g = g.replace(/[^xrgb\\/\\-\\+\\*\\(\\)\\.0-9]*/g, \"\");\n    b = b.replace(/[^xrgb\\/\\-\\+\\*\\(\\)\\.0-9]*/g, \"\");\n    // Convert int to float if no decimals are present\n    if (!r.includes('.')) r = r.replace(/([0-9])([^\\.])?/g, \"$1.0$2\");\n    if (!g.includes('.')) g = g.replace(/([0-9])([^\\.])?/g, \"$1.0$2\");\n    if (!b.includes('.')) b = b.replace(/([0-9])([^\\.])?/g, \"$1.0$2\");\n    // adjust NDVI range\n    if (ctx.mode === \"ndvi\") {\n      if (r !== \"\") {\n        r = \"((\" + r + \") + 1.0) / 2.0\";\n      }\n      if (g !== \"\") {\n        g = \"((\" + g + \") + 1.0) / 2.0\";\n      }\n      if (b !== \"\") {\n        b = \"((\" + b + \") + 1.0) / 2.0\";\n      }\n    }\n    if (r === \"\") {\n      r = \"r\";\n    }\n    if (g === \"\") {\n      g = \"g\";\n    }\n    if (b === \"\") {\n      b = \"b\";\n    }\n    code = $(\"#shader-fs-template\").html();\n    code = code.replace(/@1@/g, r);\n    code = code.replace(/@2@/g, g);\n    code = code.replace(/@3@/g, b);\n    $(\"#shader-fs\").html(code);\n    return webglUtils.createProgramFromScripts(ctx.gl, [\"shader-vs\", \"shader-fs\"]);\n  };\n\n  function setMode(ctx, newMode) {\n    if (ctx.mode != newMode) ctx.updateShader = true;\n    ctx.mode = newMode;\n  };\n\n  function glShaderLoaded() {\n    waitForShadersToLoad -= 1;\n    if (!waitForShadersToLoad) {\n      drawScene(imgContext);\n      return drawScene(mapContext);\n    }\n  };\n\n  function glRestoreContext() {\n    var imageData;\n    imageData = imgContext.imageData;\n    imgContext = createContext(imgContext.mode, imgContext.selColormap, imgContext.colormap, imgContext.slider, \"image\");\n    mapContext = createContext(mapContext.mode, mapContext.selColormap, mapContext.colormap, mapContext.slider, \"colorbar\");\n    if (imgContext && mapContext) {\n      return updateImage(imageData);\n    }\n  };\n\n  function updateImage(img) {\n    var gl;\n    gl = imgContext.gl;\n    inputImage = img;\n    imgContext.imageData = img;\n    gl.activeTexture(gl.TEXTURE0);\n    return gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, img);\n  };\n\n  function getInputImage() {\n    function imageToBase64(img) {\n      let canvas = document.createElement('CANVAS');\n      const ctx = canvas.getContext('2d');\n      canvas.height = img.height;\n      canvas.width = img.width;\n      ctx.drawImage(img, 0, 0);\n      const dataURL = canvas.toDataURL('image/png|gif|jpg');\n      canvas = null;\n      return dataURL;\n    }\n    return imageToBase64(inputImage);\n  };\n\n  function getCurrentImage() {\n    return drawScene(imgContext, true);\n  };\n\n  function getImageData() {\n    return imgContext.imageData;\n  };\n\n  function saveExpression(a, b, c) {\n    return imgContext.expression = [a, b, c];\n  };\n\n  function run(mode) {\n    return setMode(imgContext, mode);\n  };\n\n  initialize(options);\n\n  return {\n    type: 'webgl',\n    initialize: initialize,\n    getInputImage: getInputImage,\n    getCurrentImage: getCurrentImage,\n    getImageData: getImageData,\n    run: run,\n    save_expressions: saveExpression,\n    setMode: setMode,\n    updateImage: updateImage,\n    decolorize: decolorize,\n    colorize: colorize\n  }\n\n}\n\n},{\"../util/webgl-utils\":18}],11:[function(require,module,exports){\nmodule.exports = function Analysis(options, save_infragrammar_inputs) {\n\n  // buttons to run Analysis steps\n  $(\"#infragrammar_hsv\").submit(function() {\n    console.log('hsv mode');\n    options.mode = \"infragrammar_hsv\";\n    options.logger.log_hsv();\n    save_infragrammar_inputs();\n    options.run(options.mode);\n    options.run();\n    return true;\n  });\n\n  $(\"#infragrammar\").submit(function() {\n    console.log('infragrammar mode');\n    options.mode = \"infragrammar\";\n    options.logger.log_rgb();\n    save_infragrammar_inputs();\n    options.run(options.mode);\n    options.run();\n    return true;\n  });\n\n  $(\"#infragrammar_mono\").submit(function() {\n    console.log('infragrammar mono mode');\n    options.mode = \"infragrammar_mono\";\n    options.logger.log_mono();\n    save_infragrammar_inputs();\n    options.run(options.mode);\n    options.run();\n    return true;\n  });\n\n}\n\n},{}],12:[function(require,module,exports){\nmodule.exports = function Colorize(options) {\n\n  $(\".btn-colorize\").click(function() {\n    if (options.colorized) {\n      decolorize();\n      options.run(options.mode);\n      return options.processor.decolorize();\n    } else {\n      colorize();\n      options.run(options.mode);\n      return options.colorize();\n    }\n  });\n\n  $(\"#default_colormap\").click(function() {\n    console.log('default colormap');\n    colorize();\n    options.colorize('default');\n    options.run(options.mode);\n    return $(\"#btn-colorize\").addClass(\"active\");\n  });\n\n  $(\"#stretched_colormap\").click(function() {\n    console.log('stretched colormap');\n    colorize();\n    options.colorize('stretched');\n    options.run(options.mode);\n    return $(\"#btn-colorize\").addClass(\"active\");\n  });\n\n  // duplicated in presets.js\n  function colorize() {\n    console.log('colorized on');\n    options.colorized = true;\n    $(\"#btn-colorize\").addClass(\"active\");\n    $(\"#colorbar-container\").css('display', 'inline-block');\n    $(\"#colormaps-group\").css('display', 'inline-block');\n  }\n\n  function decolorize() {\n    console.log('colorized off');\n    options.colorized = false;\n    $(\"#btn-colorize\").removeClass(\"active\");\n    $(\"#colorbar-container\").css('display', 'none');\n    $(\"#colormaps-group\").css('display', 'none');\n  }\n\n}\n\n},{}],13:[function(require,module,exports){\nmodule.exports = function Fullscreen(options) {\n    var fullscreen = false;\n\n    $(\".fullscreen\").click(function() {\n      if (fullscreen) {\n        $(\"#image\").css(\"display\", \"inline\");\n        $(\"#image\").css(\"position\", \"relative\");\n        $(\"#image\").css(\"height\", \"auto\");\n        $(\"#image\").css(\"left\", 0);\n        $(\"#backdrop\").hide();\n        $(\".btn.fullscreen\").show();\n        fullscreen = false;\n      } else {\n        $(\"#image\").css(\"display\", \"block\");\n        $(\"#image\").css(\"height\", \"100%\");\n        $(\"#image\").css(\"width\", \"auto\");\n        $(\"#image\").css(\"position\", \"absolute\");\n        $(\"#image\").css(\"top\", \"0px\");\n        $(\"#image\").css(\"left\", parseInt((window.innerWidth - $(\"#image\").width()) / 2) + \"px\");\n        $(\"#image\").css(\"z-index\", \"2\");\n        $(\"#backdrop\").show();\n        $(\".btn.fullscreen\").hide();\n        fullscreen = true;\n      }\n      return fullscreen;\n    });\n\n}\n\n},{}],14:[function(require,module,exports){\nmodule.exports = function Interface(options) {\n\n  options.imageSelector = options.imageSelector || \"#image-container\";\n  options.fileSelector = options.fileSelector || \"#file-sel\";\n\n  var urlHash = require('urlhash')();\n  var FileUpload = require('../file-upload');\n  var logger = options.logger;\n  var Colormaps = require('../color/colormaps');\n  var Fullscreen, Presets, Analysis, Colorize, Saving;\n\n  // saving inputs/expressions:\n\n  function save_infragrammar_inputs() {\n    options.mode = $('#modeSwitcher').val();\n    return save_infragrammar_expressions({\n      'r': $('#r_exp').val(),\n      'g': $('#g_exp').val(),\n      'b': $('#b_exp').val(),\n      'm': $('#m_exp').val(),\n      'h': $('#h_exp').val(),\n      's': $('#s_exp').val(),\n      'v': $('#v_exp').val()\n    });\n  }\n\n  function save_infragrammar_expressions(args) {\n    console.log(args);\n    if (options.mode === \"infragrammar\") {\n      options.processor.save_expressions(args['r'], args['g'], args['b']);\n    } else if (options.mode === \"infragrammar_mono\") {\n      options.processor.save_expressions(args['m'], args['m'], args['m']);\n    } else if (options.mode === \"infragrammar_hsv\") {\n      return options.processor.save_expressions_hsv(args['h'], args['s'], args['v']);\n    }\n  }\n\n  $(document).ready(function() {\n\n    Fullscreen = require('./fullscreen')(options);\n    Presets = require('../ui/presets')(options, save_infragrammar_inputs);\n    Analysis = require('../ui/analysis')(options, save_infragrammar_inputs);\n    Colorize = require('../ui/colorize')(options);\n    Saving = require('../ui/saving')(options);\n\n    if (options.uploadable) FileUpload.initialize({ socket: options.uploadable });\n\n    $(options.imageSelector).ready(function() {\n\n      var src, idNameMap = {\n        \"#m_exp\": \"m\",\n        \"#r_exp\": \"r\",\n        \"#g_exp\": \"g\",\n        \"#b_exp\": \"b\",\n        \"#h_exp\": \"h\",\n        \"#s_exp\": \"s\",\n        \"#v_exp\": \"v\"\n      };\n \n      $(\"#overlay-slider\").val(localStorage.getItem(\"overlaySize\"));\n      console.log('grid ' + localStorage.getItem(\"overlaySize\"));\n      setGrid($(\"#overlay-slider\").val());\n\n      // TODO: broken:  \n      //urlHash.setUrlHashParameter(JSON.stringify(idNameMap));\n      src = urlHash.getUrlHashParameter('src');\n      if (src) {\n        params = parametersObject(location.search.split('?')[1]);\n        options.mode = params['mode'];\n        fetch_image(src);\n      }\n      return true;\n    });\n\n    $(options.fileSelector).change(function() {\n      $('.choose-prompt').hide();\n      $(\"#save-modal-btn\").show();\n      $(\"#save-zone\").show();\n      FileUpload.fromFile(this.files, options.processor.updateImage, options.uploadable);\n      $('#preset-modal').modal('show');\n      return true;\n    });\n\n    $(\"#webcam-activate\").click(function() {\n      $('.choose-prompt').hide();\n      $(\"#save-modal-btn\").show();\n      $(\"#save-zone\").show();\n      save_infragrammar_inputs();\n      options.video();\n      $('#preset-modal').modal('show');\n      return true;\n    });\n\n    $(\"#snapshot\").click(function() {\n      options.camera.getSnapshot();\n      return true;\n    });\n\n    $(\"#modeSwitcher\").change(function() {\n      $(\"#infragrammar, #infragrammar_mono, #infragrammar_hsv\").hide();\n      $(\"#\" + $(\"#modeSwitcher\").val()).css(\"display\", \"inline\");\n      return true;\n    });\n\n    $(\"#overlay-btn\").click(function() {\n      $(\"#overlay-container\").toggle();\n      $(\"#overlay-btn\").toggleClass(\"btn-success\");\n    });\n\n    $(\"#overlay-slider\").on(\"input\", function() {\n      setGrid($(\"#overlay-slider\").val());\n    });\n\n    function setGrid(size) {\n      var scale = 80, // roughly, not smaller than the viewport\n          ratio = 1250/2000; // size of svg\n      $(\"#overlay-img\").width(size * scale);\n      $(\"#overlay-img\").height(size * scale * ratio);\n      $(\"#overlay-size\").html(size);\n      console.log('saved grid ' + localStorage.getItem(\"overlaySize\"));\n    }\n\n    $(\"#overlay-save-btn\").click(function() {\n      localStorage.setItem(\"overlaySize\", $(\"#overlay-slider\").val());\n      $(\"#overlay-save-info\").show().delay(2000).fadeOut();\n    });\n    \n    $(\"[rel=tooltip]\").tooltip()\n    $(\"[rel=popover]\").popover()\n    return true;\n  });\n}\n\n},{\"../color/colormaps\":3,\"../file-upload\":5,\"../ui/analysis\":11,\"../ui/colorize\":12,\"../ui/presets\":15,\"../ui/saving\":16,\"./fullscreen\":13,\"urlhash\":1}],15:[function(require,module,exports){\nmodule.exports = function Presets(options, save_infragrammar_inputs) {\n\n  // preset button\n  $(\"#preset_raw\").click(function() {\n    $('#modeSwitcher').val(\"infragrammar\").change();\n    $('#r_exp').val(\"R\");\n    $('#g_exp').val(\"G\");\n    $('#b_exp').val(\"B\");\n    $('#preset-modal').modal('hide');\n    options.colorized = false;\n    options.processor.decolorize();\n    save_infragrammar_inputs();\n    decolorize();\n    return options.run(options.mode);\n  });\n\n  // preset button\n  $(\"#preset_ndvi_blue\").click(function() {\n    $('#modeSwitcher').val(\"infragrammar_mono\").change();\n    $('#m_exp').val(\"(R-B)/(R+B)\");\n    $('#preset-modal').modal('hide');\n    options.colorized = false;\n    options.processor.decolorize();\n    save_infragrammar_inputs();\n    decolorize();\n    return options.run(options.mode);\n  });\n\n  // preset button\n  $(\"#preset_ndvi_blue_color\").click(function() {\n    $('#modeSwitcher').val(\"infragrammar_mono\").change();\n    $('#m_exp').val(\"(R-B)/(R+B)\");\n    $('#preset-modal').modal('hide');\n    save_infragrammar_inputs();\n    options.colorized = true;\n    options.run(options.mode);\n    options.colorize();\n    colorize();\n    return options.run();\n  });\n\n  // preset button\n  $(\"#preset_ndvi_red\").click(function() {\n    $('#modeSwitcher').val(\"infragrammar_mono\").change();\n    $('#m_exp').val(\"(B-R)/(B+R)\");\n    $('#preset-modal').modal('hide');\n    options.colorized = false;\n    options.processor.decolorize();\n    save_infragrammar_inputs();\n    decolorize();\n    return options.run(options.mode);\n  });\n\n  // preset button\n  $(\"#preset_ndvi_red_color\").click(function() {\n    $('#modeSwitcher').val(\"infragrammar_mono\").change();\n    $('#m_exp').val(\"(B-R)/(B+R)\");\n    $('#preset-modal').modal('hide');\n    save_infragrammar_inputs();\n    colorize();\n    options.run(options.mode);\n    options.colorize();\n    return options.run();\n  });\n\n  function colorize() {\n    console.log('colorized on');\n    options.colorized = true;\n    $(\"#btn-colorize\").addClass(\"active\");\n    $(\"#colorbar-container\").css('display', 'inline-block');\n    $(\"#colormaps-group\").css('display', 'inline-block');\n  }\n\n  function decolorize() {\n    console.log('colorized off');\n    options.colorized = false;\n    $(\"#btn-colorize\").removeClass(\"active\");\n    $(\"#colorbar-container\").css('display', 'none');\n    $(\"#colormaps-group\").css('display', 'none');\n  }\n\n}\n\n},{}],16:[function(require,module,exports){\nmodule.exports = function Saving(options) {\n\n  // This is all unused...\n\n  $(\"#download\").click(function() {\n    downloadImage();\n    return true;\n  });\n\n  // refactor this, it's a mess:\n  $(\"#save\").click(saveImage);\n\n  function saveImage() {\n    var img;\n    function sendThumbnail() {\n      img = options.processor.getCurrentImage();\n      return FileUpload.uploadThumbnail(img, function() {\n        $(\"#form-filename\").val(FileUpload.getFilename());\n        $(\"#form-log\").val(JSON.stringify(logger.log));\n        return $(\"#save-form\").submit();\n      });\n    };\n    $(\"#save\").prop(\"disabled\", true);\n    $(\"#save\").html(\"Saving...\");\n    if (FileUpload.getFilename() === \"\") {\n      img = options.processor.getCurrentImage();\n      FileUpload.fromBase64(\"camera\", img, sendThumbnail);\n    } else if (FileUpload.isLoadedFromFile() === false) {\n      FileUpload.duplicate(sendThumbnail);\n    } else {\n      sendThumbnail();\n    }\n    return img;\n  }\n\n  return {\n    saveImage: saveImage\n  }\n\n}\n\n},{}],17:[function(require,module,exports){\nmodule.exports = class JsImage {\n  constructor(data1, width1, height1, channels) {\n    this.data = data1;\n    this.width = width1;\n    this.height = height1;\n    this.channels = channels;\n  }\n\n  copyToImageData(imgData) {\n    return imgData.data.set(this.data);\n  }\n\n  extrema() {\n    var c, i, j, l, m, maxs, mins, n, ref, ref1;\n    n = this.width * this.height;\n    mins = (function() {\n      var l, ref, results;\n      results = [];\n      for (i = l = 0, ref = this.channels; 0 <= ref ? l < ref : l > ref; i = 0 <= ref ? ++l : --l) {\n        results.push(this.data[i]);\n      }\n      return results;\n    }).call(this);\n    maxs = (function() {\n      var l, ref, results;\n      results = [];\n      for (i = l = 0, ref = this.channels; 0 <= ref ? l < ref : l > ref; i = 0 <= ref ? ++l : --l) {\n        results.push(this.data[i]);\n      }\n      return results;\n    }).call(this);\n    j = 0;\n    for (i = l = 0, ref = n; 0 <= ref ? l < ref : l > ref; i = 0 <= ref ? ++l : --l) {\n      for (c = m = 0, ref1 = this.channels; 0 <= ref1 ? m < ref1 : m > ref1; c = 0 <= ref1 ? ++m : --m) {\n        if (this.data[j] > maxs[c]) {\n          maxs[c] = this.data[j];\n        }\n        if (this.data[j] < mins[c]) {\n          mins[c] = this.data[j];\n        }\n        j++;\n      }\n    }\n    return [mins, maxs];\n  }\n\n}\n\n},{}],18:[function(require,module,exports){\n/*\n * Copyright 2012, Gregg Tavares.\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are\n * met:\n *\n *     * Redistributions of source code must retain the above copyright\n * notice, this list of conditions and the following disclaimer.\n *     * Redistributions in binary form must reproduce the above\n * copyright notice, this list of conditions and the following disclaimer\n * in the documentation and/or other materials provided with the\n * distribution.\n *     * Neither the name of Gregg Tavares. nor the names of his\n * contributors may be used to endorse or promote products derived from\n * this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n * \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n// These funcitions are meant solely to help unclutter the tutorials.\n// They are not meant as production type functions.\n\n// This file was adapted from the above author for Node.js use.\n\nmodule.exports = function webglUtils() {\n\nvar lastError;\n\n/**\n * Wrapped logging function.\n * @param {string} msg The message to log.\n */\nvar log = function(msg) {\n  if (window.console && window.console.log) {\n    window.console.log(msg);\n  }\n};\n\n/**\n * Wrapped logging function.\n * @param {string} msg The message to log.\n */\nvar error = function(msg) {\n  if (window.console) {\n    if (window.console.error) {\n      window.console.error(msg);\n    }\n    else if (window.console.log) {\n      window.console.log(msg);\n    }\n  }\n};\n\n/**\n * Turn off all logging.\n */\nvar loggingOff = function() {\n  log = function() {};\n  error = function() {};\n};\n\n/**\n * Check if the page is embedded.\n * @return {boolean} True of we are in an iframe\n */\nvar isInIFrame = function() {\n  return window != window.top;\n};\n\n/**\n * Converts a WebGL enum to a string\n * @param {!WebGLContext} gl The WebGLContext to use.\n * @param {number} value The enum value.\n * @return {string} The enum as a string.\n */\nvar glEnumToString = function(gl, value) {\n  for (var p in gl) {\n    if (gl[p] == value) {\n      return p;\n    }\n  }\n  return \"0x\" + value.toString(16);\n};\n\n/**\n * Creates the HTLM for a failure message\n * @param {string} canvasContainerId id of container of th\n *        canvas.\n * @return {string} The html.\n */\nvar makeFailHTML = function(msg) {\n  return '' +\n    '<table style=\"background-color: #8CE; width: 100%; height: 100%;\"><tr>' +\n    '<td align=\"center\">' +\n    '<div style=\"display: table-cell; vertical-align: middle;\">' +\n    '<div style=\"\">' + msg + '</div>' +\n    '</div>' +\n    '</td></tr></table>';\n};\n\n/**\n * Mesasge for getting a webgl browser\n * @type {string}\n */\nvar GET_A_WEBGL_BROWSER = '' +\n  'This page requires a browser that supports WebGL.<br/>' +\n  '<a href=\"http://get.webgl.org\">Click here to upgrade your browser.</a>';\n\n/**\n * Mesasge for need better hardware\n * @type {string}\n */\nvar OTHER_PROBLEM = '' +\n  \"It doesn't appear your computer can support WebGL.<br/>\" +\n  '<a href=\"http://get.webgl.org/troubleshooting/\">Click here for more information.</a>';\n\n/**\n * Creates a webgl context. If creation fails it will\n * change the contents of the container of the <canvas>\n * tag to an error message with the correct links for WebGL.\n * @param {Element} canvas. The canvas element to create a\n *     context from.\n * @param {WebGLContextCreationAttirbutes} opt_attribs Any\n *     creation attributes you want to pass in.\n * @return {WebGLRenderingContext} The created context.\n */\nvar setupWebGL = function(canvas, opt_attribs) {\n  function showLink(str) {\n    var container = canvas.parentNode;\n    if (container) {\n      container.innerHTML = makeFailHTML(str);\n    }\n  };\n\n  if (!window.WebGLRenderingContext) {\n    //showLink(GET_A_WEBGL_BROWSER);\n    return null;\n  }\n\n  var context = create3DContext(canvas, opt_attribs);\n  if (!context) {\n    //showLink(OTHER_PROBLEM);\n  }\n  return context;\n};\n\n/**\n * Creates a webgl context.\n * @param {!Canvas} canvas The canvas tag to get context\n *     from. If one is not passed in one will be created.\n * @return {!WebGLContext} The created context.\n */\nvar create3DContext = function(canvas, opt_attribs) {\n  var names = [\"webgl\", \"experimental-webgl\"];\n  var context = null;\n  for (var ii = 0; ii < names.length; ++ii) {\n    try {\n      context = canvas.getContext(names[ii], opt_attribs);\n    } catch(e) {}\n    if (context) {\n      break;\n    }\n  }\n  return context;\n}\n\nvar updateCSSIfInIFrame = function() {\n  if (isInIFrame()) {\n    document.body.className = \"iframe\";\n  }\n};\n\n/**\n * Gets a WebGL context.\n * makes its backing store the size it is displayed.\n */\nvar getWebGLContext = function(canvas, opt_attribs) {\n  if (isInIFrame()) {\n    updateCSSIfInIFrame();\n\n    // make the canvas backing store the size it's displayed.\n    canvas.width = canvas.clientWidth;\n    canvas.height = canvas.clientHeight;\n  }\n\n  var gl = setupWebGL(canvas, opt_attribs);\n  return gl;\n};\n\n/**\n * Loads a shader.\n * @param {!WebGLContext} gl The WebGLContext to use.\n * @param {string} shaderSource The shader source.\n * @param {number} shaderType The type of shader.\n * @param {function(string): void) opt_errorCallback callback for errors.\n * @return {!WebGLShader} The created shader.\n */\nvar loadShader = function(gl, shaderSource, shaderType, opt_errorCallback) {\n  var errFn = opt_errorCallback || error;\n  // Create the shader object\n  var shader = gl.createShader(shaderType);\n\n  // Load the shader source\n  gl.shaderSource(shader, shaderSource);\n\n  // Compile the shader\n  gl.compileShader(shader);\n\n  // Check the compile status\n  var compiled = gl.getShaderParameter(shader, gl.COMPILE_STATUS);\n  if (!compiled) {\n    // Something went wrong during compilation; get the error\n    lastError = gl.getShaderInfoLog(shader);\n    errFn(\"*** Error compiling shader '\" + shader + \"':\" + lastError);\n    gl.deleteShader(shader);\n    return null;\n  }\n\n  return shader;\n}\n\n/**\n * Creates a program, attaches shaders, binds attrib locations, links the\n * program and calls useProgram.\n * @param {!Array.<!WebGLShader>} shaders The shaders to attach\n * @param {!Array.<string>} opt_attribs The attribs names.\n * @param {!Array.<number>} opt_locations The locations for the attribs.\n * @param {function(string): void) opt_errorCallback callback for errors.\n */\nvar loadProgram = function(\n    gl, shaders, opt_attribs, opt_locations, opt_errorCallback) {\n  var errFn = opt_errorCallback || error;\n  var program = gl.createProgram();\n  for (var ii = 0; ii < shaders.length; ++ii) {\n    gl.attachShader(program, shaders[ii]);\n  }\n  if (opt_attribs) {\n    for (var ii = 0; ii < opt_attribs.length; ++ii) {\n      gl.bindAttribLocation(\n          program,\n          opt_locations ? opt_locations[ii] : ii,\n          opt_attribs[ii]);\n    }\n  }\n  gl.linkProgram(program);\n\n  // Check the link status\n  var linked = gl.getProgramParameter(program, gl.LINK_STATUS);\n  if (!linked) {\n      // something went wrong with the link\n      lastError = gl.getProgramInfoLog (program);\n      errFn(\"Error in program linking:\" + lastError);\n\n      gl.deleteProgram(program);\n      return null;\n  }\n  return program;\n};\n\n/**\n * Loads a shader from a script tag.\n * @param {!WebGLContext} gl The WebGLContext to use.\n * @param {string} scriptId The id of the script tag.\n * @param {number} opt_shaderType The type of shader. If not passed in it will\n *     be derived from the type of the script tag.\n * @param {function(string): void) opt_errorCallback callback for errors.\n * @return {!WebGLShader} The created shader.\n */\nvar createShaderFromScript = function(\n    gl, scriptId, opt_shaderType, opt_errorCallback) {\n  var shaderSource = \"\";\n  var shaderType;\n  var shaderScript = document.getElementById(scriptId);\n  if (!shaderScript) {\n    throw(\"*** Error: unknown script element\" + scriptId);\n  }\n  shaderSource = shaderScript.text;\n\n  if (!opt_shaderType) {\n    if (shaderScript.type == \"x-shader/x-vertex\") {\n      shaderType = gl.VERTEX_SHADER;\n    } else if (shaderScript.type == \"x-shader/x-fragment\") {\n      shaderType = gl.FRAGMENT_SHADER;\n    } else if (shaderType != gl.VERTEX_SHADER && shaderType != gl.FRAGMENT_SHADER) {\n      throw(\"*** Error: unknown shader type\");\n      return null;\n    }\n  }\n\n  return loadShader(\n      gl, shaderSource, opt_shaderType ? opt_shaderType : shaderType,\n      opt_errorCallback);\n};\n\nvar defaultShaderType = [\n  \"VERTEX_SHADER\",\n  \"FRAGMENT_SHADER\"\n];\n\n/**\n * Creates a program from 2 script tags.\n *\n * @param {!WebGLContext} gl The WebGLContext to use.\n * @param {!Array.<string>} shaderScriptIds Array of ids of the\n *        script tags for the shaders. The first is assumed to\n *        be the vertex shader, the second the fragment shader.\n * @param {!Array.<string>} opt_attribs The attribs names.\n * @param {!Array.<number>} opt_locations The locations for the attribs.\n * @param {function(string): void) opt_errorCallback callback for errors.\n * @return {!WebGLProgram} The created program.\n */\nvar createProgramFromScripts = function(\n    gl, shaderScriptIds, opt_attribs, opt_locations, opt_errorCallback) {\n  var shaders = [];\n  for (var ii = 0; ii < shaderScriptIds.length; ++ii) {\n    shaders.push(createShaderFromScript(\n        gl, shaderScriptIds[ii], gl[defaultShaderType[ii]], opt_errorCallback));\n  }\n  return loadProgram(gl, shaders, opt_attribs, opt_locations, opt_errorCallback);\n};\n\n\n// Add your prefix here.\nvar browserPrefixes = [\n  \"\",\n  \"MOZ_\",\n  \"OP_\",\n  \"WEBKIT_\"\n];\n\n/**\n * Given an extension name like WEBGL_compressed_texture_s3tc\n * returns the supported version extension, like\n * WEBKIT_WEBGL_compressed_teture_s3tc\n * @param {string} name Name of extension to look for\n * @return {WebGLExtension} The extension or undefined if not\n *     found.\n */\nvar getExtensionWithKnownPrefixes = function(gl, name) {\n  for (var ii = 0; ii < browserPrefixes.length; ++ii) {\n    var prefixedName = browserPrefixes[ii] + name;\n    var ext = gl.getExtension(prefixedName);\n    if (ext) {\n      return ext;\n    }\n  }\n};\n\n\n/**\n * Resize a canvas to match the size it's displayed.\n * @param {!Canvas} canvas The canvas to resize.\n */\nvar resizeCanvasToDisplaySize = function(canvas) {\n  if (canvas.width != canvas.clientWidth ||\n      canvas.height != canvas.clientHeight) {\n    canvas.width = canvas.clientWidth;\n    canvas.height = canvas.clientHeight;\n  }\n}\n\n/**\n * Provides requestAnimationFrame in a cross browser way.\n */\nvar requestAnimFrame = (function() {\n  return window.requestAnimationFrame ||\n         window.webkitRequestAnimationFrame ||\n         window.mozRequestAnimationFrame ||\n         window.oRequestAnimationFrame ||\n         window.msRequestAnimationFrame ||\n         function(/* function FrameRequestCallback */ callback, /* DOMElement Element */ element) {\n           return window.setTimeout(callback, 1000/60);\n         };\n})();\n\n/**\n * Provides cancelRequestAnimationFrame in a cross browser way.\n */\nvar cancelRequestAnimFrame = (function() {\n  return window.cancelCancelRequestAnimationFrame ||\n         window.webkitCancelRequestAnimationFrame ||\n         window.mozCancelRequestAnimationFrame ||\n         window.oCancelRequestAnimationFrame ||\n         window.msCancelRequestAnimationFrame ||\n         window.clearTimeout;\n})();\n\nreturn {\n  createProgram: loadProgram,\n  createProgramFromScripts: createProgramFromScripts,\n  createShaderFromScriptElement: createShaderFromScript,\n  getWebGLContext: getWebGLContext,\n  updateCSSIfInIFrame: updateCSSIfInIFrame,\n  getExtensionWithKnownPrefixes: getExtensionWithKnownPrefixes,\n  resizeCanvasToDisplaySize: resizeCanvasToDisplaySize,\n  requestAnimFrame: requestAnimFrame,\n  cancelRequestAnimFrame: cancelRequestAnimFrame\n};\n\n};\n\n},{}]},{},[2]);\n"]}
>>>>>>> working grid
